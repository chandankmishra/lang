# PPFE ADD FROM EVO-AFTMAN/AFTSERVER
zephyrPpfeCfgSet
    |
    zephyrPpfeChangeCfg
        |
        zephyr_viqm_pfe_add


# CDA INIT
BtAsicInstance::asicFabricInit
    |
    zephyr_local_ppfe_add
        |
        zephyr_viqm_pfe_add
        zephyr_zfo_ppfe_add
        zephyr_zfi_ppfe_add
        zephyr_fpc_all_remote_ppfe_add
            |
            zephyr_viqm_pfe_add
            zephyr_zfo_ppfe_add
            zephyr_zfi_ppfe_add

# CLI
CdaFo2foSwitch::cmdHandler
    |
    zephyr_fo2fo_switch_mode_config
        |
        zephyr_peer_datapath_remote_ppfe_add
            |
            zephyr_viqm_pfe_add
        zephyr_zfo_fo2fo_switch_init
        zephyr_zfi_fo2fo_switch_init
        zephyr_ccl_fo2fo_switch_init


# NOT CALLED FROM ANYWHERE
zephyr_viqm_fo2fo_switch_init
    |
    zephyr_viqm_loop_add_ppfes
        |
        zephyr_viqm_pfe_add

##########################
zephyr_port_add_cfg
zephyr_port_del_cfg
zephyr_change_port_link_state
    |
    zephyr_cos_ifd_config
        |
        expr_cos_ifd_notify
zephyr_change_port_cfg_state
    |
    zephyr_mac_remote_fault_gen


cdaZephyrPortCfgSet
    |
    zephyr_port_cfg_set
        |
        zephyr_port_change_cfg
            |
            zephyr_change_port_cfg_state
            zephyr_change_port_link_state




### ZX #########
exprIfPhysicalSet
    |
    exprIfPhysicalChange
        |
        IF_PHYSICAL_CHANGE_CFG_STATE  #3
        IF_PHYSICAL_CHANGE_LINK_STATE #4



################################################
NhAddIflListMsgHandler::process
NhChangeIflListMsgHandler::process

EmSandbox::receive
    |
    EmSandbox::insertEntry
        |
        EmEngine::performAction
            |
            EmEngineCoreGroupManager::performAction
                |
                EmExprTree::insertEntry
                    |
                    JexprHandleIpRtCreate
                        |
                        JzphrHandleIpRt::create
                            |
                            jexpr_fdb_ht_ent_add #l3v_ip l3vpn = 2,  params.key.l3v_ip
                                |
                                jexpr_dlu_alpha_process_result
                                    |
                                    jexpr_dlu_alpha_kht_process_result
                                        |
                                        jexpr_chash_process_result
                                            |
                                            jexpr_dlu_alpha_kht_process_result_entry
                                                |
                                                jzphr_fdb_chash_proc_res
                                                    |
                                                    JexprCdaHashTblWrite
## ??
EmSandbox::receive
    |
    EmSandbox::insertEntry
        |
        EmEngine::performAction
            |
            EmEngineCoreGroupManager::performAction
                |
                EmEngineCoreInsertEntryContext::action
                    |
                    EmExprIfLogical::insertEntry
                        |
                        JexprHandleIfLogical::insertEntry
                            |
                            JexprHandleIfLogical::l2DomainConfigUpdate
                                |
                                JexprPfeApiIf::jexprPfeApiIfL2dCfg

# IFL ADD
EmExprIfLogical::_bind
    |
    JexprHandleIfLogical::_create
        |
        JexprHandleIfLogical::create
            |
            JexprHandleIfLogical::l2DomainConfigAdd
                |
                JexprPfeApiIf::jexprPfeApiIfL2dCfg
                    |
                    JexprCdaIfL2dCfg
                        |
                        CdaExprAsicGrpc::exprL2dCfgSet

JexprHandleIfLogical::insertEntry
    |
    JexprHandleIfLogical::l2DomainConfigUpdate
        |
        JexprPfeApiIf::jexprPfeApiIfL2dCfg
JexprHandleIfLogical::removeEntry
    |
    JexprHandleIfLogical::l2DomainConfigUpdate
        |
        JexprPfeApiIf::jexprPfeApiIfL2dCfg
JexprHandleIfLogical::_change
    |
    JexprHandleIfLogical::l2DomainConfigUpdate
        |
        JexprPfeApiIf::jexprPfeApiIfL2dCfg
JexprHandleIfLogical::_update
    |
    JexprHandleIfLogical::l2DomainConfigUpdate
        |
        JexprPfeApiIf::jexprPfeApiIfL2dCfg

# cda
CdaExprZephyrApi::exprL2dCfgSet
    |
    cdaZephyrL2dConfig
        |
        zephyr_set_slu_l2d_cfg1
            |
            zephyr_slu_regs_l2_domain_config1_table_set #l3_vpn_index

##### AFT CODE FLOW ######
AfiServerSandboxRequest::handler
    |
    EmServer::alloc
        |
        EmExprEngine::alloc
            |
            EmExprSandbox::create
                |
                EmExprSandbox::createHardware
                    |
                    JexprSandbox::create
                        |
                        JexprPlus::hwInit
                            |
                            JexprPfeHwInit
                                |
                                JexprFdbModuleInit
                                    |
                                    jexpr_fdb_global_module_init
                                    jexpr_fdb_group_module_init
                                        |
                                        jexpr_fdb_init
                                            |
                                            hash_ent_pile = pile_create


######
JzphrHandleMplsLkupEntry::defaultEntryInstall
    |
    getFdbMplsEntKeyAndAction
    jexpr_fdb_ht_ent_add
        |
        jexpr_dlu_alpha_add
            |
            jexpr_dlu_alpha_bft_add
            jexpr_dlu_alpha_kht_add
                |
                asic_fdb_chash_ent_num_cells_get
                jexpr_chash_add
                    |
                    jexpr_chash_lookup
                    jexpr_chash_tbl_add
            jexpr_dlu_alpha_plt_add
        jexpr_dlu_alpha_process_result
        jexpr_dlu_alpha_release_result

JzphrHandleMplsLkupEntry::defaultEntryDelete
    |
    getFdbMplsEntKeyAndAction
    jexpr_fdb_ht_ent_del
        |
        jexpr_dlu_alpha_delete
            |
            jexpr_dlu_alpha_kht_delete
                |
                jexpr_chash_delete
                    |
                    jexpr_chash_lookup
                    jexpr_chash_tbl_delete
        jexpr_dlu_alpha_process_result
        #JexprCdaRouteBulkCommit
        jexpr_dlu_alpha_release_result


##################### BEFORE JUNE 2018 ###################################################
#1 BD ADD                                       opus/mojito
    - SP/EP VLAN hw programming
#2 IF_MSG_IFD_ADD                               opus/mojito
    - pfe_ifd_chip_setup basic vlan config
    - Vlan key as disabled
    - Some difference in opus vs mojito
#3 IF_MSG_IFD_IOCTL                             opus/mojito
    - TPID program
    - Look for some other TPID options
#4 IF_MSG_IFL_MADDR_ADD                         opus/mojito
    - Store vlan ip/op map in DB
#5 IF_MSG_IFL_FAMILY_ADD
    - bd_platform_ifbd_attach same for both mojito/opus
    - pfe_ifl_family_platform_attach            mojito
    - pfe_ifl_family_change                     opus
#6 IF_MSG_IFL_FAMILY_DELETE
    - TBD  Need to check for diff
#7 IF_MSG_IFD_STATS
    - TBD Need to explore
#8 IF_MSG_IFL_STATS
    - TBD Need to explore
### P2MP ####
nh_add_helper
    |
    nh_unilist_add
        |
        nh_unilist_element_add (520)
        expr_nh_unilist_install (561)
            |
            nh_unilist_sel_get
                |
                unilist_sel_get
                    |
                    nh_unilist_sel_mask_generate (5156)
                        |
                        unilist_calc_mask_value
                    nh_unilist_sel_add_topos (5318)
                        |

ifrt_ifd_bulk_mup_down_vector
    |
    pfe_ifd_link_up_down
        |
        pfe_ifd_reroute
            |
            ifl_walk
                |
                pfe_reroute_propagate_ifl_up_down
                    |
                    pfe_reroute_propagate_ifl_up_down_helper
                        |
                        nh_ifl_reroute
                            |
                            expr_ifl_reroute
                                |
                                nh_recompute_all_selectors
                                    |
                                    nh_unilist_sel_recompute
                                        |
                                        nh_unilist_sel_mask_update
                                            |
                                            unilist_calc_mask_value

ifrt_command_handler
    |
    ifrt_command_handler
        |
        ifrt_command_handler
            |
            pfe_ifl_family_attach
                |
                jam_expr_pfe_ifl_family_platform_attach
                    |
                    expr_if_iff_proto_add
                        |
                        prds_if_lsi_iff_add
                            |
                            expr_rtt_mpls_insert_lsi_label_rt_proto
                                |
                                prds_rt_mpls_create_lsi_label_proto
                                    |
                                    prds_rt_mpls_lsi_program_entries
                                        |
                                        jprds_fdb_dir_base_ent_add
                                            |
                                            jprds_fdb_action_data_get
                                                |
                                                expr_nh_embed_nh_build
                                                    |
                                                    expr_nh_build_nh_for_lsi_rt
                                                        |
                                                        prds_nh_embed_nh_for_lsi_rt #expr_nh_vec.nh_embed_nh_for_lsi_rt
                                                            |
                                                            prds_nh_get_lsi_rt_actions
                                                                |
                                                                jprds_nh_action_l3vpn_set
                                                                jprds_nh_action_gl2dom_set

nh_msg_handler
    |
    nh_add_helper
        |
        nh_composite_add
            |
            nh_composite_install
                |
                expr_nh_composite_install
                    |
                    expr_nh_chain_add
                        |
                        jprds_nh_act_set
(gdb) p/x *act_param
$19 = {act_type = 0x6, u = {egnh = {eg_nhid = 0x8000021}, egport = {nt_valid = 0x21, nt_type = 0x0, egport = 0x0}, cnt = {is_tc_indexed = 0x21,
      qbit_idx = 0x0, counter_idx = 0x0}, plct = {dp = 0x21, set_dp = 0x0, is_tc_indexed = 0x0, qbit_idx = 0x8, policer_idx = 0x0}, qos = {
      discard = 0x21, st_valid = 0x0, is_sample = 0x0, st_code = 0x8, update_tc = 0x0, tc = 0x0, update_dp = 0x0, dp = 0x0}, desc = {
      desc_value = 0x8000021}, rep = {nt = 0x21, nt_valid = 0x0, rep_count = 0x0}, label = {mpls_info = 0x8000021, fromstack = 0x0, opcode = 0x0},
    qos_trap = {trap_code = 0x8000021}, pkt_type = {vlan_rewrite = 0x21, opt_hdr_dsc_valid = 0x0, strip_lay_2_valid = 0x0, allow_vlan_rewrite = 0x0,
      opt_hdr_dsc = 0x0, notif_type = 0x0, notif_type_valid = 0x0, layer2_type = 0x0, layer2_type_valid = 0x0, layer3_type = 0x0,
      layer3_type_valid = 0x0, lkup_type = 0x8, lkup_type_valid = 0x0, strip_layer2 = 0x0}, ref = {op = {ref_op = {zone_base = 0x21,
          update_notif = 0x0, zone_frac = 0x8, zone_size = 0x0}, ref_op1 = {chk_srcid = 0x8000021, refbits_index = 0x0}, ref_op2 = {
          refbits_index = 0x8000021}}, opcode = 0x0}, voq_calc = {base_queue_override = 0x21, base_queue_override_value = 0x0,
      tc_to_queue_ptr_override = 0x0, tc_to_queue_ptr_override_value = 0x8}, voq_offset = {voq_offset0 = 0x21, voq_offset1 = 0x0,
      voq_offset2 = 0x0}, alt_egnh = {eg_nhid = 0x8000021}, st_bytes = {op1 = 0x21, target_byte1 = 0x0, update_data1 = 0x0, op0 = 0x8,
      target_byte0 = 0x0, update_data0 = 0x0}, ig_gport = {update_ig_gport = 0x21, ig_gport = 0x0}, offset = {op_code = 0x21, mode = 0x0,
      update_value = 0x0}, gl2dom = {sh_check = 0x1, modify_gl2dom = 0x0, modify_lkup = 0x0, vlan_pruning = 0x0, gl2dom = 0x2}, sourceid = {
      update_sourceid = 0x21, sourceid = 0x800}, lport = {lport_class_valid = 0x21, lport_class = 0x0, lport_valid = 0x0, lport = 0x0}}}

$21 = {nh_id = {w = 575}, nh_flags = 1, nh_pfe_internal_flags = {value = 0}, nh_type = 24 '\030' (RNH_COMPOSITE), proto = 5 '\005', bd_index = 0, opaque_len = 0,
nh_type = PROTO_TAG(5)
comp_func = EXPR_NH_COMP_NH_CHAIN(5)
nh_type = RNH_COMPOSITE(24)

(gdb) p/x *act_param
$22 = {act_type = 0x6, u = {egnh = {eg_nhid = 0x21}, egport = {nt_valid = 0x21, nt_type = 0x0, egport = 0xf1a8d3c0}, cnt = {is_tc_indexed = 0x21,
      qbit_idx = 0x0, counter_idx = 0xf1a8d3c0}, plct = {dp = 0x21, set_dp = 0x0, is_tc_indexed = 0x0, qbit_idx = 0x0, policer_idx = 0xf1a8d3c0},
    qos = {discard = 0x21, st_valid = 0x0, is_sample = 0x0, st_code = 0x0, update_tc = 0xc0, tc = 0xd3, update_dp = 0xa8, dp = 0xf1}, desc = {
      desc_value = 0x21}, rep = {nt = 0x21, nt_valid = 0x0, rep_count = 0x0}, label = {mpls_info = 0x21, fromstack = 0xf1a8d3c0, opcode = 0xc8},
    qos_trap = {trap_code = 0x21}, pkt_type = {vlan_rewrite = 0x21, opt_hdr_dsc_valid = 0x0, strip_lay_2_valid = 0x0, allow_vlan_rewrite = 0x0,
      opt_hdr_dsc = 0x0, notif_type = 0x0, notif_type_valid = 0x0, layer2_type = 0x0, layer2_type_valid = 0x0, layer3_type = 0x0,
      layer3_type_valid = 0x0, lkup_type = 0x0, lkup_type_valid = 0x0, strip_layer2 = 0x0}, ref = {op = {ref_op = {zone_base = 0x21,
          update_notif = 0x0, zone_frac = 0x0, zone_size = 0xd3c0}, ref_op1 = {chk_srcid = 0x21, refbits_index = 0xf1a8d3c0}, ref_op2 = {
          refbits_index = 0x21}}, opcode = 0xc8}, voq_calc = {base_queue_override = 0x21, base_queue_override_value = 0x0,
      tc_to_queue_ptr_override = 0x0, tc_to_queue_ptr_override_value = 0x0}, voq_offset = {voq_offset0 = 0x21, voq_offset1 = 0x0,
      voq_offset2 = 0x0}, alt_egnh = {eg_nhid = 0x21}, st_bytes = {op1 = 0x21, target_byte1 = 0x0, update_data1 = 0x0, op0 = 0x0,
      target_byte0 = 0xc0, update_data0 = 0xd3}, ig_gport = {update_ig_gport = 0x21, ig_gport = 0xf1a8d3c0}, offset = {op_code = 0x21, mode = 0x0,
      update_value = 0x0}, gl2dom = {sh_check = 0x1, modify_gl2dom = 0x0, modify_lkup = 0x0, vlan_pruning = 0x0, gl2dom = 0x2}, sourceid = {
      update_sourceid = 0x21, sourceid = 0x0}, lport = {lport_class_valid = 0x21, lport_class = 0x0, lport_valid = 0x0, lport = 0xd3c0}}}



rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        expr_rt_create
            |
            prds_rt_create_ipvx_ucast_route
                |
                prds_rt_create_fdb
                    |
                    jprds_fdb_ht_ent_add
                        |
                        jprds_dlu_alpha_prg_by_idx
                            |
                            jprds_fdb_chash_install_by_idx
                                |
                                jprds_fdb_htent_pack
                                    |
                                    jprds_fdb_action_data_get
                                        |
                                        expr_nh_embed_nh_build
                                            |
                                            prds_nh_get_handle
                                                |
                                                expr_nh_ingress_get_handle
                                                    |
                                                    expr_nh_get_per_app_ptr
                                                    nh_per_app_ptr->nh_handle[fe_id]
                                            jprds_nh_ext_format_get

nh_msg_handler
    |
    nh_change
        |
        nh_change_helper
            |
            nh_composite_change
                |
                nh_add_helper
                    |
                    nh_composite_add
                        |
                        nh_composite_install
                            |
                            expr_nh_composite_install
                                |
                                expr_nh_mcast_composite_install
                                    |
                                    expr_nh_comp_mcast_hw_process
                                        |
                                        expr_nh_ingress_set_handle

nh_msg_handler
    |
    nh_add_helper
        |
        nh_composite_add
            |
            nh_composite_install
                |
                expr_nh_composite_install
                    |
                    expr_nh_mcast_composite_install
                        |
                        expr_nh_mcast_composite_install_internal
                            |
                            prds_rt_create_rep_tree
                            |   |
                            |   prds_rt_create_dir_mode_entry
                            |       |
                            |       prds_get_dlb0_egport
                            |   prds_nh_mcast_root_hdl_eqlist_install
                            |       |
                            |       prds_get_dlb0_egport
                            |   prds_nh_mcast_root_hdl_install #single PFE
                            |       |
                            |       prds_get_dlb0_egport
                            |   jprds_fdb_dirzn_ent_mod
                            |       |
                            |       jprds_fdb_action_data_get
                            |           |
                            |           expr_nh_embed_nh_build              (IFBD ADD #4)
                            expr_nh_ingress_set_handle


#### FLABEL ###

expr_flabel_node_add #
expr_flabel_node_del #
expr_fv_node_add # voq
expr_fv_node_del # voq

expr_nh_mcast_composite_install_internal
    |
    expr_fv_node_add

expr_nh_mcast_composite_uninstall_internal
    |
    expr_fv_node_del

expr_nh_set_platform_tokens
    |
    expr_nh_add_fvnode
        |
        expr_flabel_node_add
        expr_flabel_node_del
        expr_fv_node_add
        expr_fv_node_del

expr_nh_agg_egress_uninstall
expr_nh_agg_install
expr_nh_ucast_install
expr_nh_ucast_uninstall
    |
    expr_nh_del_fvnode
        |
        expr_flabel_node_del
        expr_fv_node_del

##### GOOGLE CX ######
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifd_stats_vector
            |
            ifrt_ifdmsg2fpc
                |
                pfeman_msg2fpc
                    |
                    iffpc_msg_handler
                        |
                        iffpc_ifd_stats_vector
                            |
                            iffpc_reply2master
                                |
                                ifrt_combined_msg_handler
                                    |
                                    ifrt_fpc_command_handler
                                        |
                                        ifrt_ifd_stats_reply_vector
                                            |
                                            pfe_ifd_ifdstats
                                                |
                                                ifl_walk
                                                    |
                                                    pfe_ifd_stats_from_ifls
                                                        |
                                                        pfe_ifd_get_ifl_stats
                                                            |
                                                            pfe_get_ifl_stats
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_stats_vector
            |
            ifrt_ifl_stats_get
                |
                pfe_ifl_iflstats
                    |
                    pfe_get_ifl_stats
                        |
                        jam_expr_pfe_ifl_ipv6_stats_get #jc_if_vec->pfe_ifl_ipv6_stats_get
                            |
                            prds_rt_ifl_ipv6_stats_get #expr_if_pf_vec->ifl_ipv6_counter_get
                                |
                                prds_rt_ifl_ipv6_stats_struct_lookup
                        jam_expr_pfe_ifl_l2d_stats_get #jc_if_vec->pfe_ifl_l2d_stats_get
                            |
                            pfe_ifl_l2d_stats_get
                                |
                                expr_ifl->expr_if_l2d_stats

pfe_stats_background
    |
    pfe_2sec_stats_update
        |
        ifd_walk
            |
            jam_expr_pfe_stats_express_chip_poll
                |
                pfe_ifd_stats_poll
                    |
                    jam_expr_ifd_get_pkt_byte_cnt
                jam_expr_ifl_walk
                    |
                    ifl_walk
                        |
                        pfe_ifl_stats_poll
                            |
                            prds_if_ifd_lport_counter_get
                            prds_if_ifl_l2d_counter_get

ELIT
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x0, ret_handle=0x16d995cc, rtt_index=1)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x16d98c8c, ret_handle=0x1c4db7a8, rtt_index=1)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0x1c4db818, rtt_index=1, nh_proto=2)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x0, ret_handle=0x16d995cc, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x16d98c8c, ret_handle=0x16bf0078, rtt_index=0)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0x16bf00e8, rtt_index=0, nh_proto=2)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0x0, ret_handle=0x16d995cc, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0x16d98bcc, ret_handle=0x16bf0d38, rtt_index=0)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0x16bf0da8, rtt_index=0, nh_proto=6)

PTX NEW
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x0, ret_handle=0xeb143c48, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0xeb1436f4, ret_handle=0xd7e938d8, rtt_index=0)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0xef650b40, rtt_index=0, nh_proto=2)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0x0, ret_handle=0xeb143c48, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0xeb1436f4, ret_handle=0xd7e93818, rtt_index=0)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0xf0d06e58, rtt_index=0, nh_proto=6)

PTX
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=2, recirc_params=0x0, ret_handle=0xeb143c48, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0x0, ret_handle=0xeb143c48, rtt_index=0)
#0  prds_nh_host_create_recirc_handle (fe_id=0, nh_proto=6, recirc_params=0xeb143784, ret_handle=0xd7e93878, rtt_index=0)
#0  prds_nh_host_update_recirc_handle (fe_id=0, recirc_nh_handle=0xef652ae8, rtt_index=0, nh_proto=6)

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    rt_iff_attach
                        |
                        expr_rt_iff_attach
                            |
                            expr_rt_iff_attach_internal
                                |
                                expr_rt_iff_lo_attach
                                |   |
                                |   prds_nh_host_create_recirc_handle
                                |   expr_dfw_lo0_implicit_flt_attach
                                |       |
                                |       expr_dfw_lo0_v6_impl_flt_create
                                |       expr_dfw_bind_app
                                |           |
                                |           expr_dfw_bp_topo_connect
                                |               |
                                |               expr_dfw_topo_item_insert
                                |                   |
                                |                   topo_push_front
                                |                       |
                                |                       topo_connect
                                |                           |
                                |                           topo_action
                                |                               |
                                |                               rt_iff_topo_handler
                                |                                   |
                                |                                   expr_rt_iff_topo_handler
                                |                                       |
                                |                                       expr_rt_iff_lo_flt_update
                                |                                           |
                                |                                           prds_nh_host_create_recirc_handle
                                |                                           prds_nh_host_update_recirc_handle
                                expr_dfw_lo0_ddos_implicit_flt_attach
                                    |
                                    expr_dfw_lo0_ddos_v6_impl_flt_create
                                        |
                                        expr_dfw_bind_app
                                            |
                                            expr_dfw_bp_topo_connect
                                                |
                                                expr_dfw_topo_item_insert
                                                    |
                                                    expr_dfw_topo_push_front
                                                        |
                                                        topo_push_front
                                                            |
                                                            topo_connect
                                                                |
                                                                topo_action
                                                                    |
                                                                    rt_iff_topo_handler
                                                                        |
                                                                        expr_rt_iff_topo_handler
                                                                            |
                                                                            expr_rt_iff_topo_handler_internal
                                                                                |
                                                                                expr_rt_iff_lo_flt_update
                                                                                    |
                                                                                    prds_nh_host_create_recirc_handle
                                                                                    prds_nh_host_update_recirc_handle

####################
# ETHER TYPE
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifdmsg2fpc
            |
            pfeman_msg2fpc
                |
                iffpc_msg_handler
                    |
                    iffpc_ifd_ioctl_vector
                        |
                        t6e_cr_ifdioctl
                            |
                            expr_if_ifd_tpid_config
                                |
                                prds_if_tpid_install
                                    |
                                    cmsngfpc_pechip_tpid_install
                                        |
                                        pechip_egp_etype_rule_init
cmsngfpc_asic_init_pfe_thread
    |
    cmsngfpc_asic_init_pfe
        |
        cmsngfpc_hwinfo_pfe_asic_init
            |
            cmsngfpc_gld_pfe_asic_pechip_init
                |
                cmsngfpc_pechip_init
                    |
                    jexpr_asic_halp_init_cr_tr
                        |
                        jexpr_asic_halp_init
                        |   |
                        |   jprds_halp_asic_ready_notify
                        |       |
                        |       jprds_halp_pe_ready_notify
                        |           |
                        |           jprds_etype_init
                        |               |
                        |               pechip_egp_term_etype_rule_set
                        |   jprds_if_ai_rules_hw_init
                        |       |
                        |       pechip_igp_aipr_rule_set
                        prds_if_lb_stream_create
                            |
                            prds_if_dlb_ifd_pechip_setup
                                |
                                prds_if_ifd_eth_ruleset_def_cfg
                                    |
                                    prds_if_ifd_install_eth_ruleset
                                        |
                                        jprds_if_tag_pattern_add
                                            |
                                            pechip_egp_ai_etype_rule_set
                                            jprds_if_ai_pattern_add
                                                |
                                                jprds_if_ai_etypes_set
                                                    |
                                                    pechip_igp_ai_etype_rule_set
                                                    jprds_if_ai_install_rule
                                                        |
                                                        pechip_igp_aipr_rule_set
# STP CONFIG
    cmsngfpc_asic_init_pfe_thread
        |
        cmsngfpc_hwinfo_pfe_asic_init
            |
            cmsngfpc_gld_pfe_asic_pechip_init
                |
                cmsngfpc_pechip_init
                    |
                    jexpr_asic_halp_init_cr_tr
                        |
                        jexpr_asic_halp_init
                            |
                            expr_l2_hw_init
                                |
                                expr_l2_ifbd_hw_init
                                    |
                                    expr_l2_stg_dev_init
                                        |
                                        jprds_if_stp_id_reserve_by_port_state
                                            |
                                            pechip_slu_stp_tbl_set
cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            jexpr_asic_halp_init_qfx
                |
                jexpr_asic_halp_init
                    |
                    expr_l2_hw_init
                        |
                        expr_l2_ifbd_hw_init
                            |
                            expr_l2_stg_dev_init
                                |
                                jprds_if_stp_id_reserve_by_port_state
                                    |
                                    pechip_slu_stp_tbl_set
bd_msg_handler
    |
    ifbd_msg_handler
        |
        ifbd_create_msg
            |
            ifbd_create_if_msg
                |
                bd_ifbd_notify
                    |
                    stp_process_ifbd
                        |
                        stp_platform_ifbd_update_hw
                            |
                            expr_l2_stg_add_vlan_stg_entry
                                |
                                expr_l2_stg_port_stg_update_by_bd
                                    |
                                    expr_l2_stg_port_stp_tbl_n_l2d_cfg_update
                                        |
                                        jprds_if_stp_id_alloc_by_port_state
                                            |
                                            jprds_if_stp_id_alloc_by_port_state_helper
                                                |
                                                pechip_slu_stp_tbl_set

# ETHER TYPE CONFIG
jexpr_asic_halp_init_qfx
    |
    expr_if_lcpu_port_init
        |
        expr_if_init_LCPU_10GE_interface
            |
            prds_port_eth_ruleset_def_cfg

pfe_ifd_chip_setup
    |
    expr_port_init
        |
        expr_port_ifd_attach

prds_if_iff_proto_chg
    |
    prds_port_family_get_pl2_iff
        |
        expr_port_ifl_attach
            |
            expr_port_ifd_attach
                |
                expr_if_lb_ifd_init
                |   |
                |   prds_port_eth_ruleset_def_cfg
                prds_port_eth_ruleset_def_cfg

prds_if_ifd_tpid_add
    |
    pechip_igp_ai_etype_rule_set
    pechip_egp_ai_etype_rule_set

cmlc_msg_handler
    |
    cmsngfpc_fpc_pic_online_ack_vector
        |
        cmsngfpc_pic_online
            |
            cmsngfpc_pic_init
                |
                cmsngfpc_pechip_pic_attach
                    |
                    cmsngfpc_pechip_igp_pic_attach
                        |
                        cmsngfpc_pechip_igp_pic_aipr_setup
                            |
                            pechip_igp_aipr_rule_se
expr_port_ifd_attach
    |
    pechip_igp_port_gp_set
    prds_port_ptgt_params_def_cfg
    |   |
    |   pechip_igp_eth_ptpg_params_set
    prds_port_edf_def_cfg
    |   |
    |   pechip_edf_port_cfg_set
    prds_port_eth_params_def_set
    |   |
    |   pechip_igp_eth_params_set
    |   pechip_egp_port_gp_set
    prds_port_eth_ruleset_def_cfg
        |
        pechip_igp_ai_etype_rule_enable
        expr_nh_egress_add_etypes
        |   |
        |   jprds_encap_etype_tbl_install #jencap_vec.etype_tbl_install
        |       |
        |       jprds_encap_gen_install
        |           | #jprds_encap_gen_write JPRDS_ENCAP_GEN_TBL_WRITE
        |           jprds_encap_vlan_etype_write
        |               |
        |               pechip_mem_write
        |                   |
        |                   pechip_erw_mem_write #pechip_edf_mem_write #pechp_irp_mem_write
        |                       |
        |                       pechip_edf_vlan_sel_tbl_write #pechip_irp_shadow_write_to_pe
        expr_nh_egress_set_egp_etype_map
        |   |
        |   jprds_encap_set_egp_etype_map #jencap_vec.set_egp_etype_map
        |       |
        |       pechip_edf_set_egp_etype_map  #edf.cfg.egp_etype[index]
        jprds_if_port_vlan_trust_set
        expr_port_install_eth_ruleset
            |
            jprds_if_tag_pattern_add
                |
                pechip_egp_ai_etype_rule_set #egp eth_ruleset
                jprds_if_ai_pattern_add
                    |
                    jprds_if_ai_etypes_set
                        |
                        jprds_if_ai_install_rule
                            |
                            pechip_igp_aipr_rule_set     #igp eth_ai_ruleset
                            pechip_igp_ai_etype_rule_set #igp eth_ruleset
                        jprds_if_ai_add_pattern
                        jprds_etype_idx_add
                        pechip_igp_ai_etype_rule_set
                        jprds_if_ai_add_pattern

#delete tag is not getting called now. Tags never gets deleted.
jprds_if_tag_pattern_delete
    |
    pechip_egp_ai_etype_rule_set
    jprds_if_ai_pattern_delete
        |
        jprds_if_ai_uninstall_rule
            |
            pechip_igp_aipr_rule_set
            pechip_igp_etype_rule_init

jprds_if_ai_rules_hw_init
    |
    pechip_igp_aipr_rule_set #invalid eth_ai_ruleset

#########
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifd_add_vector
        |   |
        |   pfe_ifd_attach
        |       |
        |       pfe_ifd_chip_setup
        |           |
        |           ifd->pfe_ifd_chip_data = kzalloc(sizeof(pfe_ifd_data_expr_t)
        |           expr_port_init
        |               |
        |               expr_port_ifd_attach
        |                   |
        |                   pechip_igp_port_gp_set
        |                   ifd->ifd_net = kzalloc(sizeof(expr_l2_ifd_entry_t))
        |                   expr_if_lb_ifd_init
        |                   pechip_igp_port_gp_set
        |                   prds_port_ptgt_params_def_cfg
        |                   prds_port_edf_def_cfg
        |                   prds_port_eth_params_def_set
        |                   prds_port_ptp_init
        |                   prds_port_irp_setup
        |                   prds_port_ipw_setup
        |                   prds_port_iqm_setup
        |                   jprds_if_port_ifd_map
        |                   pfe_if_gport_ifd_map_add
        |                   expr_if_map_ifd_idx_gport
        |       pfe_ifd_chip_setup
        |           |
        |           jam_expr_pfe_ifd_chip_setup #jp_pfe_if_vec->pfe_ifd_chip_setup
        |               |
        |               pfe_ifd_chip_data_alloc
        |                   |
        |                   kzalloc(sizeof(pfe_ifd_data_expr_t));
        |                   jam_expr_ifd_set_chip_data
        |                       |
        |                       ifd->pfe_ifd_chip_data = chip_data;
        |               pfe_ifd_net_alloc
        |               expr_if_ifd_chip_setup
        |                   |
        |                   prds_if_ifd_chip_setup #(*expr_if_pf_vec->ifd_chip_setup)(ifd, multi_ifd)
        |                       |
        |                       prds_if_ifd_pechip_ipw_setup
        |                       prds_if_ifd_pechip_iqm_setup
        |                       prds_if_ifd_pechip_igp_setup
        |                       prds_if_ifd_pechip_slu_setup
        |                       prds_if_ifd_pechip_dlu_setup
        |                       prds_if_ifd_pechip_irp_setup
        |                       prds_if_ifd_pechip_egp_setup
        |                       prds_if_ifd_pechip_edf_setup
        |                       prds_if_ifd_pechip_epr_setup
        |                       prds_if_ifd_pechip_irm_setup
        |                       prds_if_ifd_pechip_erm_setup
        |                       expr_cos_halp_ifd_setup
        |                       prds_if_ifd_lport_stats_clear
        |                       pfe_ifd_set_lkup_chip_number
        |                       pfe_ifd_set_lkup_chip_stream
        ifrt_ifl_add_vector
        |   |
        |   ifrt_ifl_create
        |       |
        |       pfe_ifl_attach
        |           |
        |           pfe_ifl_platform_attach #ptx
        |               |
        |               jam_expr_pfe_ifl_platform_attach #jc_if_vec->pfe_ifl_platform_attach
        |                   |
        |                   pfe_ifl_chip_data_alloc
        |                   expr_if_ifl_l2d_alloc
        |                       |
        |                       prds_if_ifl_l2d_alloc
        |                           |
        |                           jprds_if_l2d_id_alloc
        |                   expr_if_l2d_pfe_int_alloc_inc
        |                   pfe_ifl_local_l2d_set
        |                   pfe_ifl_tpid_idx_set
        |                   pfe_ifl_inner_tpid_idx_set
        |                   jam_expr_pfe_ifd_updown
        |           pfe_ifl_platform_attach #elit
        |               |
        |               expr_port_ifl_attach
        |                   |
        |                   prds_port_hw_wr_gport_id
        |                   |   |
        |                   |   expr_if_map_ifd_idx_gport
        |                   |       |
        |                   |       jprds_fdb_ht_ent_add
        |                   |           |
        |                   |           jprds_dlu_alpha_prg_by_idx
        |                   |               |
        |                   |               jprds_fdb_chash_install_by_idx
        |                   |                   |
        |                   |                   jprds_fdb_hash_tbl_write
        |                   |                       |
        |                   |                       pechip_dlu_hash_tbl_rw                  (IFBD ADD #1)
        |                   |
        |                   expr_port_ifd_attach
        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_platform_attach  #ptx
                    |   |
                    |   jam_expr_pfe_ifl_family_platform_attach
                    |       |
                    |       expr_if_iff_proto_add
                    |           |
                    |           prds_if_iff_proto_add
                    pfe_ifl_family_change           #elit
                        |
                        expr_port_family_change
                            |
                            prds_port_family_get_pl2_iff
                                |
                                expr_port_ifl_attach
                                    |
                                    prds_port_hw_wr_gport_id
                                        |
                                        expr_if_map_ifd_idx_gport
                                            |
                                            jprds_fdb_ht_ent_add
                                                |
                                                jprds_dlu_alpha_prg_by_idx
                                                    |
                                                    jprds_fdb_chash_install_by_idx
                                                        |
                                                        jprds_fdb_hash_tbl_write
                                                            |
                                                            pechip_dlu_hash_tbl_rw
                                                                |
                                                                case PECHIP_DLU_HASH_TBL_ELP_SW0
                                                                pechip_dlu_elp_hash_tbl_rw      (IFBD ADD #2)

bd_msg_handler
    |
    ifbd_msg_handler
        |
        ifbd_create_if_msg
            |
            expr_update_route_ifbd
                |
                jprds_fdb_ht_ent_add
                    |
                    jprds_dlu_alpha_prg_by_idx
                        |
                        jprds_fdb_chash_install_by_idx
                            |
                            jprds_fdb_hash_tbl_write
                                |
                                pechip_dlu_hash_tbl_rw                      (IFBD ADD #3)
nh_msg_handler
    |
    nh_add_helper
        |
        nh_composite_add
            |
            nh_composite_install
                |
                expr_nh_composite_install
                    |
                    expr_nh_mcast_composite_install
                        |
                        expr_nh_mcast_composite_install_internal
                            |
                            prds_rt_create_rep_tree
                            |   |
                            |   prds_rt_create_dir_mode_entry
                            |       |
                            |       prds_get_dlb0_egport
                            |   prds_nh_mcast_root_hdl_eqlist_install
                            |       |
                            |       prds_get_dlb0_egport
                            |   prds_nh_mcast_root_hdl_install #single PFE
                            |       |
                            |       prds_get_dlb0_egport
                            |   jprds_fdb_dirzn_ent_mod
                            |       |
                            |       jprds_fdb_action_data_get
                            |           |
                            |           expr_nh_embed_nh_build              (IFBD ADD #4)
                            expr_nh_ingress_set_handle


rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        expr_rt_create
            |
            prds_rt_update_l2
                |
                prds_rt_update_bd
                    |
                    expr_update_route_bd
                        |
                        expr_l2_fdb_set_fdbent_params
                            |
                            case JPRDS_FDB_KEY_TYPE_GL2D_DMAC
                            case JPRDS_FDB_KEY_TYPE_GL2D
                        jprds_fdb_slowcnt_zero_stats
                        jprds_fdb_ht_ent_add
                            |
                            jprds_dlu_alpha_prg_by_idx
                                |
                                jprds_fdb_chash_install_by_idx
                                    |
                                    jprds_fdb_htent_pack
                                        |
                                        jprds_fdb_action_data_get
                                            |
                                            expr_nh_embed_nh_build          (IFBD ADD #5)
                                                |
                                                prds_nh_get_handle #expr_nh_vec.nh_get_handle
                                                jprds_nh_ext_format_get #jnh_vec.nh_ext_format_get
                                    jprds_fdb_hash_tbl_write #PRDS_DLU_EDB0
                                        |
                                        pechip_hash_tbl_write
                                            |
                                            pechip_dlu_hash_tbl_rw
                    expr_update_route_gl2d_to_vlan
nh_msg_handler
    |
    nh_change
        |
        nh_change_helper
            |
            nh_change_major
                |
                topo_migrate
                    |
                    topo_action
                        |
                        nh_topo_handler
                            |
                            nh_composite_change_platform
                                |
                                nh_composite_topo_child_change
                                    |
                                    nh_composite_change
                                        |
                                        topo_migrate
                                            |
                                            topo_action
                                                |
                                                rt_entry_topo_handler
                                                    |
                                                    expr_rt_rebake
                                                        |
                                                        expr_rt_can_hw_install
                                                        prds_rt_update_layer2
                                                            |
                                                            prds_rt_update_l2
                                                                |
                                                                expr_update_route_bd
                                                                    |
                                                                    expr_l2_fdb_set_fdbent_params
                                                                    jprds_fdb_ht_ent_change
                                                                        |
                                                                        jprds_fdb_ht_ent_change
                                                                            |
                                                                            jprds_fdb_chash_proc_res
                                                                                |
                                                                                jprds_fdb_common_chash_proc_res
                                                                                    |
                                                                                    jprds_fdb_chash_install_by_idx
                                                                                        |
                                                                                        jprds_fdb_hash_tbl_write
                                                                                            |
                                                                                            pechip_dlu_hash_tbl_rw (IFBD ADD #4x2)

        ifrt_ifl_agg_add_ifl_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_change
                        |
                        pfe_ifl_family_platform_change
                            |
                            expr_port_family_change
                                |
                                prds_port_family_get_pl2_iff
                                    |
                                    expr_port_ifl_attach
                                        |
                                        expr_port_ifd_attach

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_add_vector
        |   |
        |   pfe_ifl_attach
        |       |
        |       pfe_ifl_platform_attach
        |           expr_port_ifl_attach                                                    #QFX
        |               |
        |           jam_expr_pfe_ifl_platform_attach #jc_if_vec->pfe_ifl_platform_attach    #PTX
        |               |
        |               pfe_ifl_chip_data_alloc
        |               expr_if_ifl_l2d_alloc
        |                   |
        |                   prds_if_ifl_l2d_alloc
        |                       |
        |                       jprds_if_l2d_id_alloc
        |               expr_if_l2d_pfe_int_alloc_inc
        |               pfe_ifl_local_l2d_set
        |               pfe_ifl_tpid_idx_set
        |               pfe_ifl_inner_tpid_idx_set
        |               jam_expr_pfe_ifd_updown
        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_change
                        |
                        pfe_ifl_family_platform_change
                            |
                            expr_port_family_change
                                |
                                prds_port_family_get_pl2_iff
                                    |
                                    expr_port_ifl_attach
        ifrt_ifl_agg_add_ifl_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_platform_attach
                        |
                        expr_port_family_attach

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifd_add_vector
        |   |
        |   ifd_create
        |   ifd_ifh_attach
        |   ifd_attach
        |   pfe_ifd_attach
        |   |   |
        |   |   ifgether_init
        |   |   if_pfe_set_ifd_local
        |   |   pfe_ifd_chip_setup
        |   |       |
        |   |       pic_port_get_pechip_port_info
        |   |       expr_port_init
        |   |           |
        |   |           expr_port_init_def
        |   |               |
        |   |               expr_port_init_def_eth
        |   |               pechip_igp_sample_vec_set
        |   |               expr_port_cpclass_init
        |   |           expr_port_ifd_attach
        |   |               |
        |   |               pechip_igp_port_gp_set
        |   |               ifd->ifd_net = kzalloc(sizeof(expr_l2_ifd_entry_t))
        |   |               expr_if_lb_ifd_init
        |   |               pechip_igp_port_gp_set
        |   |               prds_port_ptgt_params_def_cfg
        |   |               prds_port_edf_def_cfg
        |   |               prds_port_eth_params_def_set
        |   |               prds_port_ptp_init
        |   |               prds_port_irp_setup
        |   |               prds_port_ipw_setup
        |   |               prds_port_iqm_setup
        |   |               jprds_if_port_ifd_map
        |   |               pfe_if_gport_ifd_map_add
        |   |               expr_if_map_ifd_idx_gport
        |   ifrt_ifdmsg2fpc
        |       |
        |       pfeman_msg2fpc
        |           |
        |           iffpc_msg_handler
        |               |
        |               iffpc_ifd_add_vector
        |                   |
        |                   iffpc_ifd_attach
        |                       |
        |                       pepic_ifd_attach (pic->pic_ifd)
        |                           |
        |                           pepic_ifd_eth_attach
        |                               |
        |                               pepic_ifd_eth_attach
        |                                   |
        |                                   eth_ifd_bind
        |                                       |
        |                                       eth_phy_cfg
        |                                           |
        |                                           pepic_ifd_eth_phy_conf
        |

#####################

nh_msg_handler (NEW - NON AE)
    |
    nh_add_helper
        |
        nh_ucast_add
            |
            nh_ucast_install
                |
                expr_nh_fwd_nh_install
                    |
                    expr_nh_ucast_install
                        |
                        expr_nh_ucast_create_ingress_handles
                            |
                            expr_nh_fwd_update_ifbd_descr
                                |
                                expr_l2_create_sp_ifdb_entry
                                    |
                                    expr_l2_flex_vlan_lkup_entry_add
                                        |
                                        expr_l2_gport_ovlan_add_fdb
                                        expr_l2_gl2d_gport_add_fdb
nh_msg_handler (AE NEW)
    |
    nh_add_helper
        |
        nh_unilist_add
            |
            expr_nh_unilist_install
                |
                expr_nh_agg_install
                    |
                    expr_nh_agg_ingress_install
                        |
                        expr_nh_ifbd_agg_ingress_update
                            |
                            expr_l2_create_sp_agg_ifbd_entry
                                |
                                expr_l2_flex_vlan_lkup_entry_add
                                    |
                                    expr_l2_gport_ovlan_add_fdb
                                    expr_l2_gl2d_gport_add_fdb

#--------------------------
TAG Change (NON AE)
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifd_ioctl_vector
            |
            pfe_ifd_ge_ioctl
                |
                pfe_ifd_ge_platform_ioctl
                    |
                    expr_l2_bridge_port_tpid_set
                        |
                        ifl_walk
                            |
                            expr_l2_config_ifd_tpid_set
                                |
                                expr_l2_update_ifbd_egr_desc
                                    |
                                    expr_l2_change_vlan_xlat
nh_msg_handler (OLD - NON AE)
    |
    nh_add_helper
        |
        nh_ucast_add
            |
            nh_ucast_install
                |
                expr_nh_fwd_nh_install
                    |
                    expr_nh_ucast_install
                        |
                        expr_nh_ucast_create_ingress_handles
                            |
                            expr_nh_fwd_update_ifbd_descr
                                |
                                expr_l2_ifbd_egress_walk
                                    |
                                    expr_l2_flex_vlan_lkup_entry_add
                                        |
                                        expr_l2_gport_ovlan_add_fdb
                                        expr_l2_gl2d_gport_add_fdb
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_delete_vector
            |
            ifrt_ifl_family_deleter
                |
                ifbd_delete_internal_msg
                    |
                    ifbd_delete_msg
                        |
                        ifbd_delete_if_msg
                            |
                            expr_l2_sp_bd_ifbd_detach
                                |
                                expr_l2_common_bd_ifbd_detach
                                    |
                                    expr_l2_flex_vlan_lkup_entry_del
                                        |
                                        expr_l2_gport_ovlan_del_fdb
                                            |
                                            expr_l2_gport_ovlan_del_fdb_helper


nh_msg_handler (AE OLD)
    |
    nh_add_helper
        |
        nh_unilist_add
            |
            expr_nh_unilist_install
                |
                expr_nh_agg_install
                    |
                    expr_nh_agg_ingress_install
                        |
                        expr_nh_ifbd_agg_ingress_update
                            |
                            expr_l2_agg_ifbd_ingress_walk
                                |
                                aggregate_bundle_ifl_walk
                                    |
                                    expr_l2_aggr_flex_vlan_lkup_entry_add
                                        |
                                        expr_l2_flex_vlan_lkup_entry_add
                                            |
                                            expr_l2_gport_ovlan_add_fdb
                                            expr_l2_gl2d_gport_add_fdb
#####################
ifrt_msg_handler
    |
    ifrt_command_handler
        |
        | IF_MSG_IFD_ADD
        ifrt_ifd_add_vector #pfe/common/toolkits/if/ifrt_ifd.c
        |   |
        |   ifd_create
        |       |
        |       ifd = (cm_ifd_t *)task_mem_malloc(NULL, sizeof(cm_ifd_t));
        |       ifd_validate
        |       |
        |   ifd_ifh_attach
        |   ifd_attach
        |       |
        |       ifd_add
        |           |
        |           patricia_root_init, patricia_node_init, patricia_add
        |           cm_ifd_to_add->ifd_child_list = list_create("AE child members")
        |   ifd_set_pic_xcvr_port_chan_from_name
        |   pfe_ifd_attach #pfe/common/toolkits/pfe/pfe_if.c
        |   ifrt_invoke_ifd_callbacks
        |   if_notify_ifd_cmd
        |   pfe_ifd_attach #pfe/common/toolkits/pfe/pfe_if.c
        |       |
        |       ifd->ifd_mcast_stats_config = pfe_if_mcast_stats_config;
        |       ifd_mark_capability_flag
        |       pfe_ifd_reroute_setup
        |       ifd->macsec_settings = kzalloc(sizeof(ifd_macsec_t));
        |       ifml_ifd_init
        |       pfe_stats_ifd_attach
        |       ifservices_init
        |       ifvp_init #init for different type of ifds
        |       ifgether_init
        |       ifd_needs_chip_setup #if chip setup not required then return
        |       bd_irb_lc_attach #If this is a local learning-chip IFD, let the IRB module know about it.
        |       pfe_ifd_chan_config
        |       pfe_ifd_chip_setup #pfe/common/toolkits/pfe/pfe_if_expr_argus.c
        |       |   |
        |       |   jam_expr_pfe_ifd_chip_setup (*jc_if_vec->pfe_ifd_chip_setup) #applications/if/jp_if_api_cr_tr.c
        |       |   |   |
        |       |   |   expr_if_ifd_chip_setup #express/applications/if/if_halp_cr_tr.c:597
        |       |   |       |
        |       |   |       zphr_if_ifd_chip_setup #expr_if_pf_vec->ifd_chip_setup #applications/if/if_halp_zphr.c
        |       |   |           |
        |       |   |           pic_port_get_zephyr_port_info
        |       |   |           pfe_ifd_set_lkup_chip_number
        |       |   |           pfe_ifd_set_lkup_chip_stream
        |       |   |           pfe_ifd_set_lkup_chip_intf
        |       |   |           pfe_ifd_set_queueing_chip_number
        |       |   |           zephyr_port_add #pfe/common/drivers/zephyr/common/zephyr_port_init.c
        |       |   |           |   |
        |       |   |           |   zephyr_pg_quad_set_type
        |       |   |           |       |
        |       |   |           |   zephyr_pfe_pg_add
        |       |   |           |       |
        |       |   |           |   zephyr_pfe_slu_add
        |       |   |           |       |
        |       |   |           |       zephyr_slu_regs_portgroup_config_set                #HW
        |       |   |           |   zephyr_port_pgcore_init
        |       |   |           |       |
        |       |   |           |   zephyr_port_pg_init
        |       |   |           |       |
        |       |   |           |   zephyr_port_pgio_init
        |       |   |           |       |
        |       |   |           |   zephyr_port_igp_init
        |       |   |           |       |
        |       |   |           |       zephyr_port_igp_config_init
        |       |   |           |           |
        |       |   |           |           zh.igp[0].port_config                           #HW
        |       |   |           zphr_if_ifd_zephyr_igp_setup #applications/if/if_halp_zphr.c
        |       |   |           |   |
        |       |   |           |   zephyr_igp_regs_eth_ptgt_params_set                     #HW
        |       |   |           zphr_if_ifd_zephyr_slu_setup #applications/if/if_halp_zphr.c
        |       |   |           |   |
        |       |   |           |   zephyr_slu_regs_port_config1_table_set                  #HW
        |       |   |           |   zephyr_slu_regs_port_config2_table_set                  #HW
        |       |   |           |   zephyr_slu_regs_logical_port_config_table_set           #HW
        |       |   |           zphr_if_ifd_zephyr_irp_setup
        |       |   |           |   |
        |       |   |           |   zephyr_irp_regs_core_ipp_mem_physport_table_set         #HW
        |       |   |           zphr_if_ifd_zephyr_epp_setup
        |       |   |           |   |
        |       |   |           |   zephyr_epp_regs_epc_cfg_common_port_config_set          #HW
        |       |   |           |   zephyr_epp_regs_epc_cfg_parse_eth_ruleset_set           #HW
        |       |   |           zephyr_port_pgmac_enable_traffic #pfe/common/drivers/zephyr/pg/zephyr_port_pg_init.c
        |       |   |               |
        |       |   expr_port_init
        |       |       |
        |       |       expr_port_ifd_attach
        |       |       |   |
        |       |       |   jexpr_port_ifd_map_set
        |       |       |       |
        |       |       |       jzphr_if_port_ifd_map #vec->jexpr_jif_port_ifd_map_set
        |       |       |           |
        |       |       |           port_to_ifd_map[dev][port] = ifd
        |       |       |   jexpr_port_ethrule_def_cfg
        |       |       |       jzphr_if_port_eth_ruleset_def_cfg #vec->jexpr_jif_port_ethrule_def_cfg
        |       |       |           |
        |       |       |           expr_nh_egress_add_etypes
        |       |       |               |
        |       |       |               jencap_vec.etype_tbl_install
        |       |       |           expr_nh_egress_set_egp_etype_map
        |       |       |               |
        |       |       |               jencap_vec.set_egp_etype_map
        |       |       |           jzphr_prepare_ethernet_rule_set
        |       |       |           zephyr_set_ingress_eth_rule #jif_vec->asic_set_ingress_eth_rule
        |       |       |               |
        |       |       |               zephyr_igp_regs_eth_ruleset_set_set                 #HW
        |       |       |           zephyr_set_egress_eth_rule #jif_vec->asic_set_egress_eth_rule
        |       |       |               |
        |       |       |               zephyr_epp_regs_epc_cfg_parse_eth_ruleset_set       #HW
        |       |       |           zephyr_set_egress_eth_type
        |       |       |               |
        |       |       |               zephyr_epp_regs_epc_cfg_parse_etype_cam_set         #HW
        |       |       jexpr_port_init_def
        |       |       |   |
        |       |       |   jexpr_port_init_def_eth
        |       |       |       |
        |       |       |       jzphr_if_port_eth_def_cfg #vec->jexpr_jif_port_eth_def_cfg
        |       |       |           |
        |       |       |           jexpr_if_set_port_ingress_cfg
        |       |       |               |
        |       |       |               zephyr_set_slu_port_cfg1 #jif_vec->asic_set_slu_port_cfg1
        |       |       |                   |
        |       |       |                   zephyr_slu_regs_port_config1_table_set          #HW
        |       |       |               zephyr_set_slu_port_cfg2 #jif_vec->asic_set_slu_port_cfg2
        |       |       |                   |
        |       |       |                   zephyr_slu_regs_port_config2_table_set          #HW
        |       |       |           jexpr_if_set_port_egress_cfg
        |       |       |               |
        |       |       |               zephyr_set_edf_port_cfg #jif_vec->asic_set_edf_port_cfg
        |       |       |                   |
        |       |       |                   zephyr_epp_regs_epc_cfg_common_port_config_set  #HW
        |       |       |       expr_port_cpclass_init  #FIXME
        |       |       expr_cos_halp_ifd_setup_qfx     #FIXME
        |       |       |   |
        |       |       |   expr_cos_halp_ifd_common_init
        |       |       |       |
        |       |       |       expr_ifd_port_chn_to_local_conv
        |       |       |       expr_cos_sched_sp_ifd_init
        |       |       |       expr_cos_cm_sp_bind
        |       |       |       Lpva->ifd_setup
        |       |       |       expr_cos_pgq_scheduler_map_bind
        |       |       |       expr_cos_cm_voq_ifd_set
        |       |       |   expr_cos_halp_ifd_egress_init
        |       |       expr_if_port_ubfd_setup         #FIXME
        |       pfe_input_stream_attach_ifd
        |       |   |
        |       |   pfe_input_stream_get
        |       |       |
        |       |       stream_index_get
        |       |           |
        |       |           pfe_ifd_get_chip_input_stream
        |       |               |
        |       |               pfe_ifd_get_lkup_chip_stream
        |       pfe_stats_ifd_attach
        |           |
        |           ifd->ifd_pfe_stats = ifd_stats
        |       pfe_res_qstats_ifd_attach
        |           |
        |       pfe_ifd_irb_add
        |           |
        |           irb_callout_vector.ifd_irb_add
        |
        |   zephyr_slu_regs_l2_domain_hash_table_tbl_set
        |   zephyr_slu_regs_my_mac_hash_table_table_set
        |   zephyr_slu_regs_l2_domain_config1_table_set
        |   zephyr_slu_regs_l2_domain_config0_table_set
        |   zephyr_slu_regs_l3_vpn_lookup_table_set
        |   zephyr_slu_regs_l2_domain_config0_table_set
        |   zephyr_slu_regs_l2_domain_config1_table_set
        |   zephyr_slu_regs_logical_port_config_table_set
        |   zephyr_slu_regs_logical_port_config_table_set
        |   zephyr_epp_regs_epc_cfg_common_port_config_set
        |
        | IF_MSG_IFL_ADD
        ifrt_ifl_add_vector #ifl add
        |   |
        |   pfe_ifl_attach
        |       |
        |       pfe_ifl_platform_attach
        |           |
        |           jam_expr_pfe_ifl_platform_attach
        |               |
        |               pfe_ifl_chip_data_alloc
        |               pfe_ifd_get_lkup_chip_number
        |               expr_if_ifl_l2d_alloc
        |               pfe_ifl_local_l2d_set
        |                   |
        |                   zphr_if_ifl_l2d_alloc #applications/if/if_halp_zphr.c
        |                       |
        |                       jexpr_if_l2d_id_alloc  #express/toolkits/jif/jzphr_if_l2d.c
        |               pfe_ifl_tpid_idx_set
        |               pfe_ifl_inner_tpid_idx_set
        |               jam_expr_pfe_ifd_updown
        | IF_MSG_IFL_CONFIG_FLAGS
        ifrt_ifl_config_flags_vector #ifl change
        |   |
        |   pfe_iflconfig
        |       |
        |       pfe_ifl_cup
        |           |
        |           jam_expr_pfe_ifl_updown
        |               |
        |               pfe_ifl_local_l2d_ht_ent_get
        |               expr_if_ifd_channel_add #jp_pfe_if_vec->pfe_ifl_updown
        |                   |
        |                   expr_if_ifl_vtags_get
        |                   pfe_ifl_local_l2d_get
        |                   zphr_if_ifd_channel_add  #expr_if_pf_vec->ifd_channel_add
        |                       |
        |                       prds_if_ifl_pechip_slu_setup
        |                       prds_if_ifl_pechip_dlu_setup
        |                       prds_if_ifl_pechip_irw_setup
        |                       expr_add_ifl_ifcp_table
        |                       expr_if_ifl_l2d_ht_add
        |                           |
        |                           pfe_ifl_local_l2d_ht_ent_get
        |                           zphr_if_ifl_l2d_ht_add (*expr_if_pf_vec->ifl_l2d_ht_add)
        |                           |   |
        |                           |   jexpr_if_l2d_ht_insert
        |                           |       |
        |                           |       jexpr_if_l2d_ht_hash_fn
        |                           |       jexpr_if_l2d_ht_insert_multiple
        |                           |           |
        |                           |           jexpr_if_l2d_ht_chg_commit
        |                           |               |
        |                           |               jbwy_chash_process_result
        |                           |                   |
        |                           |                   jexpr_if_l2d_ht_chg_commit
        |                           |                       |
        |                           |                       zephyr_hash_tbl_write #chip_num=0, blk_info={blk = ZEPHYR_SLU, sub_blk = ZEPHYR_SLU_MIN
        |                           |                           |
        |                           |                           zephyr_slu_hash_tbl_rw
        |                           |                               |
        |                           |                               zephyr_slu_l2d_hash_tbl_rw
        |                           |                                   |
        |                           |                                   zephyr_slu_regs_l2_domain_hash_table_tbl_set    #HW
        |                           pfe_ifl_local_l2d_ht_ent_set
        |               expr_if_ifd_channel_enable_disable
        |                   |
        |                   pfe_ifl_local_l2d_ht_ent_get
        | IF_MSG_IFL_FAMILY_ADD
        ifrt_ifl_family_add_vector #iff add
        |   |
        |   ifrt_ifl_family_adder
        |       |
        |       pfe_ifl_family_attach
        |           |
        |           rt_iff_attach     //Deal with any route changes
        |           nh_iff_attach
        |           bd_iff_attach //Attach the Bridge Domain and create the L2IFF on the IFF only for PROTO_L2_BRIDGE
        |           |   |
        |           |   ifbd_add_internal_msg
        |           |       |
        |           |       ifbd_msg_handler
        |           |           |
        |           |           ifbd_create_msg
        |           |               |
        |           |               ifbd_create_if_msg
        |           |                   |
        |           |                   bd_ifbd_attach
        |           |                   pfe_irb_l2ifl_attach_detach
        |           |                   bd_platform_ifbd_attach
        |           |                       |
        |           |                       expr_l2_bd_ifbd_attach
        |           |                           |
        |           |                           expr_l2_sp_bd_ifbd_attach
        |           |                               |
        |           |                               expr_l2_common_bd_ifbd_attach
        |           |                                   |
        |           |                                   expr_l2_ifbd_lport_vid_add
        |           |                                       |
        |           |                                       expr_if_l2_ifl_add_lport
        |           |                                           |
        |           |                                           expr_if_l2_ifl_add_lport_helper
        |           |                                               |
        |           |                                               jprds_if_lport_for_ifd_alloc #Lport alloc for L2
        |           cosman_iff_attach
        |           pfe_ifl_family_platform_attach
        |           |   |
        |           |   #expr_port_family_attach
        |           |   #|   |
        |           |   #|   expr_port_family_change
        |           |   jam_expr_pfe_ifl_family_platform_attach #jc_if_vec->pfe_ifl_family_platform_attach
        |           |       |
        |           |       expr_if_ipv6_stats_switch
        |           |       expr_if_iff_proto_add #l3vpn applications/if/if_halp_cr_tr.c
        |           |           |
        |           |           prds_if_lsi_iff_add #expr_if_pf_vec->lsi_iff_add
        |           |           zphr_if_iff_proto_add #expr_if_pf_vec->iff_proto_add  #express/applications/if/if_halp_zphr.c
        |           |               |
        |           |               expr_if_mfilter_mymac_entry_set #express/applications/if/if_mfilter.c
        |           |               |   |
        |           |               |   prds_if_mymac_entry_add
        |           |               |       |
        |           |               |       jzphr_mymac_ht_insert
        |           |               |           |
        |           |               |           jbwy_chash_process_result
        |           |               |               |
        |           |               |              jzphr_mymac_ht_chg_commit
        |           |               |                   |
        |           |               |                   zephyr_slu_hash_tbl_rw
        |           |               |                       |
        |           |               |                       zephyr_slu_mymac_hash_tbl_rw
        |           |               |                           |
        |           |               |                           zephyr_slu_regs_my_mac_hash_table_table_set                     #HW
        |           |               jexpr_if_l2d_attr_set   #express/toolkits/jif/zephyr_if_api.c
        |           |               |   |
        |           |               |   zephyr_set_slu_l2d_attr #jif_vec->asic_set_l2d_attr
        |           |               |       |
        |           |               |       zephyr_slu_regs_l2_domain_config1_table_set                                         #HW
        |           |               |       zephyr_slu_regs_l2_domain_config0_table_set                                         #HW
        |           |               prds_rt_table_rtt_idx_to_l3vpn
        |           |               jexpr_if_l3_vpn_set  #express/toolkits/jif/jzphr_if_l2d.c
        |           |               |   |
        |           |               |   zephyr_set_slu_l3_vpn_lkup_tbl #jif_vec->asic_set_l3_vpn_cfg
        |           |               |       |
        |           |               |       zephyr_slu_regs_l3_vpn_lookup_table_set                                             #HW
        |           |               jexpr_if_l2domain_cfg_set #express/toolkits/jif/jzphr_if_l2d.c
        |           |               |   |
        |           |               |   zephyr_set_l2d_cfg #jif_vec->asic_set_l2d_cfg
        |           |               |       |
        |           |               |       zephyr_set_slu_l2d_cfg0  #express/toolkits/jif/zephyr_if_api.c
        |           |               |           |
        |           |               |           zephyr_slu_regs_l2_domain_config0_table_set                                     #HW
        |           |               |       zephyr_set_slu_l2d_cfg1
        |           |               |           |
        |           |               |           zephyr_slu_regs_l2_domain_config1_table_set                                     #HW
        |           |               |       zephyr_set_irw_l2d_cfg
        |           |               |           |
        |           |               |           zephyr_irp_regs_core_glomem_dual_l2dom_mem_set                                  #HW
        |           |               jexpr_if_lport_update_hw_vctxt #express/toolkits/jif/zephyr_if_api.c
        |           |               |   |
        |           |               |   zephyr_set_lport_cfg
        |           |               |       |
        |           |               |       zephyr_slu_regs_logical_port_config_table_set                                       #HW
        |           |               jexpr_if_set_igp_dflt_lport_id  #express/toolkits/jif/zephyr_if_api.c
        |           |               |   |
        |           |               |   zephyr_set_dflt_lport_id  #zephyr_if_vec_tbl->asic_set_igp_dflt_lport
        |           |               |       |
        |           |               |       zephyr_slu_dflt_lport_set
        |           |               |           |
        |           |               |           zephyr_slu_regs_logical_port_config_table_set                                   #HW
        |           |               jexpr_if_set_edf_port_dflt_lport_id  #express/toolkits/jif/zephyr_if_api.c
        |           |                   |
        |           |                   zephyr_set_edf_port_cfg #zephyr_if_vec_tbl->asic_set_edf_port_cfg
        |           |                       |
        |           |                       zephyr_epp_regs_epc_cfg_common_port_config_set                                      #HW
        |           pfe_llo_enable
        |           pfe_ifl_family_change
        |               |
        |               bd_iff_change
        |               pfe_ifl_family_platform_change
        |               |   |
        |               |   expr_port_family_change #applications/if/if_port_cmn.c
        |               |       |
        |               |       expr_vlan_interface_set
        |               |       expr_port_l2_ifl_init
        |               |           |
        |               |           expr_if_l2_ifl_add_lport_helper
        |               |               |
        |               |               jprds_if_lport_for_ifd_alloc ##???
        |               |       #expr_port_l3_ifl_init
        |               |       #    |
        |               |       #    prds_if_l3_ifd_init
        |               |       #        |
        |               |       #        jprds_if_lport_for_ifd_alloc    #Lport alloc for L3
        |               |       #expr_ccc_family_attach
        |               |       #expr_l3ifl_l2d_mpls_vpn_cfg_set
        |               rt_dest_class_add_iff
        |               rt_dest_class_delete_iff
        |               pfe_ifl_family_pop_in_filters
        |               pfe_ifl_family_push_in_filters
        |               rt_iff_change_src_lookup
        |               rt_iff_add_iff
        |               rt_iff_remove_iff
        |               rt_mac_validate_add_iff
        |               rt_mac_validate_remove_iff
        |               rt_iff_modify_sampling
        |               rt_iff_harddown_change
        ifrt_ifl_family_change_vector #iff change
        |   |
        |   ifrt_ifl_family_changer
        |       |
        |       pfe_ifl_family_change
        ifrt_ifl_family_delete_vector #iff remove
        |   |
        |   ifrt_ifl_family_deleter
        |       |
        |       pfe_ifl_family_detach
        |           |
        |           expr_if_iff_proto_del
        |               |
        |               zphr_if_iff_proto_del
        |                   |
        |                   expr_if_mfilter_mymac_entry_unset
        |               pfe_ifl_local_l2d_get
        ifrt_ifl_remove_vector #ifl remove
            |
            ifrt_ifl_destroy
                |
                if_notify_ifl_cmd
                |   |
                |   cos_ifl_cmd
                |       |
                |       cos_ifl_cleanup_features
                |           |
                |           cos_classifier_do_unbind_action
                |               |
                |               expr_cos_halpv_classifier_unbind
                |                   |
                |                   expr_cos_classifier_ifl_attach_ba
                |                       |
                |                       expr_l2_l3ifl_baidx_set
                |                           |
                |                           expr_if_ifl_l2d_ht_val_change #if/if_halp_cr_tr.c:249
                |                               |
                |                               pfe_ifl_local_l2d_get
                |                               pfe_ifl_local_l2d_ht_ent_get
                |
                pfe_ifl_detach
                    |
                    jam_expr_pfe_ifl_platform_detach
                        |
                        expr_if_ifd_channel_delete
                        |   |
                        |   zphr_if_ifl_l2d_ht_del
                        |       |
                        |       jexpr_if_l2d_ht_remove
                        |           |
                        |           jexpr_if_l2d_ht_remove_multiple
                        |               |
                        |               jexpr_if_l2d_ht_chg_commit
                        |                   |
                        |                   jbwy_chash_process_result
                        |                       |
                        |                       jexpr_if_l2d_ht_chg_commit
                        |                           |
                        |                           zephyr_hash_tbl_write
                        |                               |
                        |                               zephyr_slu_hash_tbl_rw
                        |                                   |
                        |                                   zephyr_slu_regs_l2_domain_hash_table_tbl_set #HW
                        expr_del_ifl_ifcp_table
                        |   |
                        |   prds_ifcp_del_fdb
                        |       |
                        |       pfe_ifl_local_l2d_get
                        expr_if_ifl_vtags_get
                        pfe_ifl_local_l2d_get
                        pfe_ifl_inner_tpid_idx_set

expr_if_ifl_l2d_ht_del
    |
    jif_l2d_ht_ent = pfe_ifl_local_l2d_ht_ent_get(chip_num, ifl);
    zphr_if_ifl_l2d_ht_del(ifl, jif_l2d_ht_ent) #ifl_l2d_ht_del
        |
        jexpr_if_l2d_ht_remove(jif_l2d_ht_ent)
    pfe_ifl_local_l2d_ht_ent_set(chip_num, ifl, NULL);

expr_if_ifl_l2d_ht_add
    |
    jif_l2d_ht_ent = zphr_if_ifl_l2d_ht_add #ifl_l2d_ht_add
        |
        jif_l2d_ht_ent = jexpr_if_l2d_ht_insert
    pfe_ifl_local_l2d_ht_ent_set(chip_num, ifl, jif_l2d_ht_ent);

#expr_if_ifl_l2d_ht_del
#    |
#    jif_l2d_ht_ent = pfe_ifl_local_l2d_ht_ent_get(chip_num, ifl);
#    jexpr_if_l2d_ht_remove(ifl, jif_l2d_ht_ent) #ifl_l2d_ht_del
#    pfe_ifl_local_l2d_ht_ent_set(chip_num, ifl, NULL);
#
#expr_if_ifl_l2d_ht_add
#    |
#    jif_l2d_ht_ent = jexpr_if_l2d_ht_insert #ifl_l2d_ht_add
#    pfe_ifl_local_l2d_ht_ent_set(chip_num, ifl, jif_l2d_ht_ent);

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifd_add_vector
        |   |
        |   ifd_create
        |   ifd_ifh_attach
        |   ifd_attach
        |   pfe_ifd_attach
        |   |   |
        |   |   ifgether_init
        |   |   if_pfe_set_ifd_local
        |   |   pfe_ifd_chip_setup
        |   |       |
        |   |       pic_port_get_pechip_port_info
        |   |       expr_port_init
        |   |           |
        |   |           expr_port_init_def
        |   |               |
        |   |               expr_port_init_def_eth
        |   |               pechip_igp_sample_vec_set
        |   |               expr_port_cpclass_init
        |   |           expr_port_ifd_attach
        |   |               |
        |   |               pechip_igp_port_gp_set
        |   ifrt_ifdmsg2fpc
        |       |
        |       pfeman_msg2fpc
        |           |
        |           iffpc_msg_handler
        |               |
        |               iffpc_ifd_add_vector
        |                   |
        |                   iffpc_ifd_attach
        |                       |
        |                       pepic_ifd_attach (pic->pic_ifd)
        |                           |
        |                           pepic_ifd_eth_attach
        |                               |
        |                               pepic_ifd_eth_attach
        |                                   |
        |                                   eth_ifd_bind
        |                                       |
        |                                       eth_phy_cfg
        |                                           |
        |                                           pepic_ifd_eth_phy_conf
        |
        ifrt_ifd_add_vector
        |   |
        |   ifd_create
        |   ifd_ifh_attach
        |   ifd_attach
        |   pfe_ifd_attach
        |       |
        |       pfe_ifd_chip_setup                                                      (common)
        |           |
        |           #MOJITO INIT
        |           pfe_bcm_ifd_port_init                                               (mojito)
        |               |
        |               bcm_port_vlan_member_set //BCM_PORT_VLAN_MEMBER_INGRESS/EGRESS
        |               bcm_port_untagged_vlan_set//Port-VID for handling untagged traffic
        |                   |
        |                   bcm_esw_port_untagged_vlan_set
        |               bcmPortControlL2Learn
        |               bcmPortControlL2Move
        |               bcmVlanTranslateIngressEnable
        |               bcmVlanTranslateEgressEnable
        |               bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyInvalid
        |               bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyInvalid
        |               bcm_port_tpid_delete_all
        |               bcm_port_tpid_set //ETHER_TYPE_VLAN
        |               pfe_bcm_port_ifd_evt_port_classid_set //L2_EVT_PORT_CLASS_INVALID
        |           pfe_bcm_cos_halp_ifd_init
        |           #OPUS INIT
        |           brcm_port_init                                                      (opus)  expr_port_init
        |               |
        |               brcm_port_ifd_attach //Allocate the shim portion in IFD                 expr_port_ifd_attach
        |                   |                                                                       expr_if_lb_ifd_init
        |                   brcm_port_ifd_evt_port_class_set //JBRCM_IF_EVT_PORT_CLASS_INVALID      pechip_igp_port_gp_set
        |                   brcm_port_ifd_evt_ctag_entry                                            prds_port_ptgt_params_def_cfg
        |                   pfe_shm_ifd_dev_portnum_map_add                                         prds_port_edf_def_cfg
        |                   brcm_trunk_local_bias_config                                            prds_port_eth_params_def_set
        |               brcm_port_fc_init_def
        |               brcm_port_init_def                                                      expr_port_init_def
        |                   |                                                                       expr_port_init_def_eth
        |                   brcm_port_igmp_snooping_set                                                 pechip_slu_port_cfg1_set
        |                   bcmPortClassFieldIngress                                                    pechip_slu_port_cfg2_set
        |                   bcmPortClassFieldLookup
        |                   brcm_port_mld_snooping_set
        |                   bcmPortControlDoNotCheckVlan
        |                   bcm_port_vlan_member_set //BCM_PORT_VLAN_MEMBER_INGRESS/EGRESS
        |                   brcm_bcm_port_discard_set
        |                   brcm_bcm_stk_port_set
        |                   brcm_bcm_port_encap_set BCM_PORT_ENCAP_IEEE
        |                   bcm_stg_stp_set  BCM_STG_STP_BLOCK
        |                   bcm_port_untagged_vlan_set BRCM_L2_VLAN_ID_DEFAULT
        |                   bcmPortControlL2Learn
        |                   bcmPortControlL2Move
        |                   bcmVlanTranslateIngressEnable
        |                   bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyInvalid
        |                   bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyInvalid
        |                   brcm_bcm_port_tpid_delete_all //0x8100
        |                   bcm_port_tpid_set //ETHER_TYPE_VLAN
        |               l2_port_ifd_evt_port_classid_set = pfe_bcm_port_ifd_evt_port_classid_set
        |               brcm_cos_halp_ifd_setup
        |               l2_evt_port_classid_dealloc_ifd = pfe_bcm_l2_evt_port_classid_dealloc_ifd
        ifrt_ifd_ioctl_vector   IF_MSG_IFD_IOCTL                                                                    //NO_PROBLEM!!
        |   |
        |   pfe_ifd_ge_ioctl
        |       |  //IF_MSG_IOCTL_ESW_TPID_DATA MORE WORK!!!
        |       pfe_ifd_ge_platform_ioctl (pfe_if_expr_qfx.c)
        |           |
        |           case IF_MSG_IOCTL_VLAN_DLCI_CHAN_ADD                                ASK_KAMAL ??
        |           case IF_MSG_IOCTL_QIFL_CHAN_DEL                                     ASK_KAMAL ??
        |           case IF_MSG_IOCTL_ESW_TPID_DATA
        |           pfe_bcm_l2_bridge_port_tpid_set                                     expr_l2_bridge_port_tpid_set
        |               |
        |               pfe_bcm_l2_config_ifd_tpid_set                                  expr_l2_config_ifd_tpid_set
        |                   |                                                               |
        |                   bcm_port_tpid_set                                               //Figure out this first!!!
        ifrt_ifl_maddr_add_vector  IF_MSG_IFL_MADDR_ADD                                                             //NO_PROBLEM!!
        |   |
        |   pfe_iflconfig
        |       |
        |       pfe_ifl_platform_maddr_config
        |           |
        |           pfe_bcm_l2_ifl_maddr_config                                         expr_l2_ifl_maddr_config    //ALL_DONE (stored config)
        ifrt_ifl_family_add_vector  IF_MSG_IFL_FAMILY_ADD
        |   |
        |   ifrt_ifl_family_adder
        |       |
        |       pfe_ifl_family_attach
        |           |
        |           rt_iff_attach     //Deal with any route changes
        |           nh_iff_attach
        |           bd_iff_attach //Attach the Bridge Domain and create the L2IFF on the IFF only for PROTO_L2_BRIDGE
        |           |   |
        |           |   ifbd_add_internal_msg
        |           |       |
        |           |       ifbd_msg_handler
        |           |           |
        |           |           ifbd_create_msg
        |           |               |
        |           |               ifbd_create_if_msg
        |           |                   |
        |           |                   bd_ifbd_attach
        |           |                   pfe_irb_l2ifl_attach_detach
        |           |                   bd_platform_ifbd_attach
        |           |                       |
        |           |                       pfe_bcm_l2_bd_ifbd_attach                                       (mojito/opus)   expr_l2_bd_ifbd_attach
        |           |                           |
        |           |                           pfe_bcm_l2_get_bd_mode                                                      expr_l2_get_bd_mode
        |           |                           pfe_bcm_l2_ifl_is_sp
        |           |                           pfe_bcm_l2_sp_bd_ifbd_attach                                (sp)            expr_l2_sp_bd_ifbd_attach
        |           |                           |   |                                                                           |
        |           |                           |   pfe_bcm_l2_sp_port_set                                                      expr_l2_common_bd_ifbd_attach
        |           |                           |       |
        |           |                           |       pfe_bcm_l2_host_itable_map_add
        |           |                           |       BCM_PBMP_PORT_ADD
        |           |                           |       pfe_bcm_l2_ifl_has_native_vid
        |           |                           |       pfe_bcm_l2_ifl_is_sp_untagged
        |           |                           |       bcm_port_untagged_vlan_set
        |           |                           |           |
        |           |                           |           bcm_esw_port_untagged_vlan_set
        |           |                           |       BCM_PBMP_PORT_ADD
        |           |                           |       bcm_vlan_port_add
        |           |                           |           |
        |           |                           |           pfe_if_vlan_tag_hwtoken_map_add
        |           |                           |           pfe_if_vlan_hw_token_ifl_map_add
        |           |                           |   pfe_bcm_l2_ifl_is_sp_untagged
        |           |                           |   pfe_bcm_l2_sp_ing_vlan_xlat_set                         (sp)
        |           |                           |       |
        |           |                           |       pfe_bcm_l2_ifl_is_nni
        |           |                           |       pfe_bcm_l2_ing_xlat_key_prepare
        |           |                           |       pfe_bcm_l2_ing_xlat_program
        |           |                           |           |
        |           |                           |           bcm_vlan_translate_action_add
        |           |                           |           pfe_bcm_l2_sp_ifl_ingress_cntr_attach           (sp)
        |           |                           |       pfe_bcm_l2_ing_vlanid_list_xlat_set //vlan-id-list
        |           |                           |           |
        |           |                           |           pfe_bcm_l2_ifl_is_nni
        |           |                           |           pfe_bcm_l2_ing_vlanid_list_xlat_program
        |           |                           |               |
        |           |                           |               bcm_vlan_translate_action_range_add
        |           |                           |               pfe_bcm_l2_sp_ifl_ingress_cntr_attach
        |           |                           |               pfe_bcm_l2_vfp_vlanid_list_program
        |           |                           |   pfe_bcm_l2_sp_egr_vlan_xlat_set                         (sp)
        |           |                           |       |
        |           |                           |       pfe_bcm_l2_ifl_is_nni
        |           |                           |       pfe_bcm_l2_egr_xlat_vlanid_prepare
        |           |                           |       pfe_bcm_l2_egr_vlan_xlat_program
        |           |                           |           |
        |           |                           |           pfe_bcm_l2_evt_port_classid_alloc
        |           |                           |               |
        |           |                           |               pfe_bcm_l2_evt_port_classid_ifd_map_del
        |           |                           |               pfe_bcm_port_ifd_evt_port_classid_set
        |           |                           |               pfe_bcm_port_ifd_evt_port_classid_ref_cnt_inc
        |           |                           |               pfe_bcm_l2_evt_vlan_xlat_entry_add_ifd
        |           |                           |               pfe_bcm_l2_evt_port_classid_ifd_map_add
        |           |                           |                   |
        |           |                           |                   pfe_bcm_l2_evt_port_classid_set_used
        |           |                           |           pfe_bcm_l2_evt_entry_set
        |           |                           |               |
        |           |                           |               bcm_vlan_translate_egress_action_add
        |           |                           |               pfe_bcm_l2_sp_ifl_egress_cntr_attach
        |           |                           |           bcm_port_class_set bcmPortClassVlanTranslateEgress
        |           |                           |           pfe_bcm_l2_evt_walk_update
        |           |                           pfe_bcm_l2_ep_bd_ifbd_attach                            (ep)                expr_l2_ep_bd_ifbd_attach      TOO MUCH DIFF!!!
        |           |                           |   |
        |           |                           |   pfe_if_vlan_tag_hwtoken_map_add                     (mojito)            pfe_if_vlan_tag_hwtoken_map_add
        |           |                           |   pfe_if_vlan_hw_token_ifl_map_add                                        pfe_if_vlan_hw_token_ifl_map_add
        |           |                           |   pfe_bcm_dfw_bind_irb_port
        |           |                           |   pfe_bcm_dfw_rebind_bd_ifd
        |           |                           |   BCM_PBMP_PORT_ADD
        |           |                           |   pfe_bcm_pvlan_ifbd_add
        |           |                           |       |
        |           |                           |   pfe_bcm_l2_ep_bd_ifbd_attach_cmn
        |           |                           |       |
        |           |                           |       BCM_PBMP_PORT_ADD
        |           |                           |       bcm_vlan_port_add
        |           |                           |       pfe_bcm_l2_egr_vlan_xlat_program
        |           |                           |   bcm_port_untagged_vlan_set
        |           |                           |   bd_has_igmp_snooping_enabled
        |           |                           |   pfe_bcm_brg_port_unreg_mcast_fwd_set
        |           |                           |   pfe_bcm_dfw_update_pbmp
        |           |                           |   pfe_bcm_l2_process_uuf_on_ifbd
        |           |                           |
        |           |                           |   brcm_virtual_port_add                               (opus)
        |           |                           |   brcm_bdvlan_vlan_class_port_set
        |           |                           |   brcm_l2_process_uuf_on_ifbd
        |           |               ifbd_change_msg
        |           |               ifbd_delete_msg
        |           |                   |
        |           |                   ifbd_delete_if_msg
        |           |                       |
        |           |                       bd_platform_ifbd_detach
        |           |                           |
        |           |                           pfe_bcm_l2_bd_ifbd_detach
        |           |                               |
        |           |                               pfe_bcm_l2_ifl_is_sp
        |           |                               pfe_bcm_l2_sp_bd_ifbd_detach                  (sp)
        |           |                                   |
        |           |                                   pfe_bcm_l2_sp_port_unset
        |           |                                   pfe_bcm_l2_ifl_is_sp_untagged
        |           |                                   pfe_bcm_l2_sp_ing_vlan_xlat_unset
        |           |                                   pfe_bcm_l2_sp_egr_vlan_xlat_unset
        |           |                               pfe_bcm_l2_ep_bd_ifbd_detach                  (ep)                  expr_l2_ep_bd_ifbd_detach
        |           |                                   |
        |           |                                   pfe_bcm_l2_process_uuf_on_ifbd                                      expr_l2_ifbd_nh_del
        |           |                                   pfe_if_vlan_untagged_hwtoken_map_get
        |           |                                   pfe_if_vlan_tag_hwtoken_map_delete
        |           |                                   pfe_if_vlan_hw_token_ifl_map_delete
        |           |                                   pfe_bcm_dfw_unbind_irb_port
        |           |                                   bd_has_igmp_snooping_enabled
        |           |                                   pfe_bcm_brg_port_unreg_mcast_fwd_set
        |           |                                   pfe_bcm_pvlan_ifbd_del
        |           |                                   pfe_bcm_l2_ep_bd_ifdb_detach_cmn
        |           |                                   bcm_port_untagged_vlan_set
        |           |                                   bcm_l2_addr_delete_by_vlan_port
        |           |                                   pfe_bcm_l2_set_mac_flush_in_progress
        |           |                                   pfe_bcm_dfw_update_pbmp
        |           cosman_iff_attach
        |           pfe_ifl_family_platform_attach (ONLY MOJITO & NO OPUS)                              (common)
        |           |   |
        |           |   pfe_if_l3ifl_tag_hwtoken_map_add                                                (all)
        |           |   pfe_shm_ifl_map_add                                                             (all)
        |           |   brcm_port_family_attach                                                         (opus)
        |           |   pfe_bcm_internal_ifl_family_attach                                              (mojito)
        |           |   pfe_ifl_platform_attach
        |           |   case PROTO_L2_BRIDGE:
        |           |   pfe_bcm_l2_bridge_family_intf_init
        |           |       |
        |           |       pfe_bcm_l2_ifl_is_sp
        |           |       pfe_bcm_l2_ifl_is_nni
        |           |       pfe_bcm_l2_sp_uni_ifd_ifl_cnt_update
        |           |       pfe_bcm_l2_sp_uni_ifd_tpid_set                                              (m-sp)
        |           |       pfe_bcm_l2_config_ifd_tpid_set                                              (m-ep)
        |           |       pfe_bcm_l2_bridge_ifl_common_set
        |           |           |
        |           |           bcmPortControlL2Learn
        |           |           bcmPortControlL2Move
        |           |           bcmVlanTranslateIngressEnable
        |           |           bcmVlanTranslateIngressMissDrop
        |           |           bcmVlanTranslateEgressEnable
        |           |           bcmVlanTranslateEgressMissDrop
        |           |       pfe_bcm_l2_ifl_is_sp
        |           |       pfe_bcm_l2_bridge_sp_ifl_set                                                (m-sp)
        |           |           |
        |           |           pfe_bcm_l2_ifl_is_nni
        |           |           bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |           |           bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyPortOuter
        |           |       pfe_bcm_l2_bridge_ep_ifl_set                                                (m-ep)
        |           |           |
        |           |           bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |           |           bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyOuter
        |           |   case PROTO_IPV6/V4
        |           |   pfe_bcm_l3_family_intf_init
        |           |       |
        |           |       pfe_bcm_l2_cache_program
        |           |       pfe_bcm_trunk_member_ifl_add
        |           |       pfe_bcm_l2_port_l3_vlan_set
        |           |           |
        |           |           pfe_bcm_l3_vlan_create
        |           |           pfe_bcm_l2_vlan_ing_xlat_table_entry_set //Ingress VLAN XLAT rule for L3 subinterface
        |           |           pfe_bcm_l2_vlan_egr_xlat_table_entry_set //Egress VLAN XLAT rule for L3 subinterface
        |           |               |
        |           |               pfe_bcm_l2_evt_port_classid_alloc
        |           |                   |
        |           |                   pfe_bcm_l2_evt_port_classid_ifd_map_del
        |           |                   pfe_bcm_port_ifd_evt_port_classid_set
        |           |                   pfe_bcm_port_ifd_evt_port_classid_ref_cnt_inc
        |           |                   pfe_bcm_l2_evt_vlan_xlat_entry_add_ifd
        |           |                   pfe_bcm_l2_evt_port_classid_ifd_map_add
        |           |                       |
        |           |                       pfe_bcm_l2_evt_port_classid_set_used
        |           |               bcm_port_class_set bcmPortClassVlanTranslateEgress
        |           |               pfe_bcm_l2_evt_entry_set
        |           |               pfe_bcm_l2_evt_walk_update
        |           |           bcm_port_untagged_vlan_set
        |           |           bcm_stg_stp_set
        |           |       pfe_bcm_l3_vlan_routing_enable
        |           |       bcm_l3_intf_t_init
        |           |       bcm_l3_intf_create
        |           |       bcm_l3_ingress_t_init
        |           |       bcm_l3_ingress_create
        |           |       pfe_bcm_l3_cntr_attach
        |           |       pfe_bcm_l2_port_l3_xlation_set
        |           |           |
        |           |           pfe_bcm_l2_port_ethertype_set
        |           |               |
        |           |               bcm_port_tpid_add = ETHER_TYPE_VLAN//Set the new ether-type
        |           |               bcm_port_tpid_set //Set port default ether-type also
        |           |           bcmVlanTranslateIngressEnable
        |           |           bcmVlanTranslateEgressEnable
        |           |           bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |           |           bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyPortOuter
        |           |       pfe_bcm_l3_forwarding_set
        |           |           |
        |           |           bcmPortControlL2Learn
        |           |           bcmPortControlL2Move
        |           pfe_ifl_family_change (ONLY OPUS & NO MOJITO)                                               (common)
        |               |
        |               bd_iff_change
        |               pfe_redirect_update_iff
        |               pfe_ifl_family_platform_change                                                          (common)
        |                   |
        |                   case PROTO_IPV4|PROTO_IPV6                                                          (mojito)
        |                   pfe_bcm_l3_irb_family_intf_init
        |                   pfe_bcm_l3_family_intf_change
        |                       |
        |                       pfe_bcm_l3_family_set_mtu
        |                   case PROTO_L2_BRIDGE
        |                   //DO NOTHING
        |                   brcm_port_family_change                                                             (opus)  expr_port_family_change
        |                       |
        |                       brcm_port_ifl_attach
        |                       brcm_irb_intf_init                                                                      expr_vlan_interface_set
        |                       case PROTO_L2_BRIDGE
        |                       brcm_ifl_l2_init                                                                        expr_port_l2_ifl_init
        |                       |   |
        |                       |   brcm_iff_ref_first                                                                  expr_iff_ref_first
        |                       |   brcm_ifl_proto_ref_first                                                            expr_ifl_proto_ref_first
        |                       |   brcm_ifd_ifl_ref_first                                                             !expr_if_l2_ifl_add_lport_helper
        |                       |   brcm_iff_ref_inc                                                                    expr_iff_ref_inc
        |                       |   brcm_ifl_proto_ref_inc                                                              expr_ifl_proto_ref_inc
        |                       |   brcm_iff_ref_first
        |                       |   brcm_iff_ref_first
        |                       |   brcm_l2_ifl_is_sp = pfe_bcm_l2_ifl_is_sp                                    (o-sp)
        |                       |   brcm_l2_bridge_ifl_common_set     = pfe_bcm_l2_bridge_ifl_common_set
        |                       |       |
        |                       |       pfe_bcm_agg_ifl_sp_set                                                  (o-sp-agg)
        |                       |       bcmPortControlL2Learn
        |                       |       bcmPortControlL2Move
        |                       |       bcmVlanTranslateIngressEnable
        |                       |       bcmVlanTranslateIngressMissDrop
        |                       |       bcmVlanTranslateEgressEnable
        |                       |       bcmVlanTranslateEgressMissDrop
        |                       |       pfe_bcm_agg_ifl_sp_set
        |                       |   brcm_l2_bridge_sp_ifl_set         = pfe_bcm_l2_bridge_sp_ifl_set            (o-sp)
        |                       |       |
        |                       |       bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |                       |       bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyPortOuter
        |                       |   brcm_bcm_port_discard_set
        |                       |   brcm_l2_ifl_is_nni                = pfe_bcm_l2_ifl_is_nni
        |                       |   brcm_l2_sp_uni_ifd_ifl_cnt_update = pfe_bcm_l2_sp_uni_ifd_ifl_cnt_update    (o-sp)
        |                       |   brcm_l2_sp_uni_ifd_ifl_first      = pfe_bcm_l2_sp_uni_ifd_ifl_first         (o-sp)
        |                       |   brcm_l2_sp_uni_ifd_tpid_set       = pfe_bcm_l2_sp_uni_ifd_tpid_set          (o-sp)
        |                       |   brcm_l2_sp_uni_ifd_ifl_cnt_get    = pfe_bcm_l2_sp_uni_ifd_ifl_cnt_get       (o-sp)
        |                       |   brcm_l2_config_ifd_tpid_set       = pfe_bcm_l2_config_ifd_tpid_set          (o-ep)
        |                       |   brcm_l2_ifl_is_sp = pfe_bcm_l2_ifl_is_sp                                    (o-sp)
        |                       |   brcm_l2_port_mode_get
        |                       |   brcm_l2_port_qinqEtherType_tlv
        |                       |   brcm_port_ethertype_set(ETHERTYPE_VLAN)
        |                       |   bcmVlanTranslateIngressEnable
        |                       |   bcmVlanTranslateIngressMissDrop
        |                       |   bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyOuter
        |                       |   bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyOuter
        |                       |   brcm_ifd_port_ctags_match_reinit (if not trunk mode)
        |                       |       |
        |                       |       bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |                       |       bcmVlanPortTranslateKeySecond = bcmVlanTranslateKeyPortInner
        |                       |   bcmVlanTranslateEgressEnable
        |                       |   brcm_trunk_member_ifl_add
        |                       |   brcm_dfw_bind_child
        |                       |   brcm_brg_port_inherit_stg_state
        |                       |   ptr_brcm_analyzer_notify_ifl_modify
        |                       |   brcm_vlan_class_port_program
        |                       |   pfe_shm_port_flag_table_ifd_update
        |                       |   brcm_brg_port_stg_hw_update
        |                       |   bcm_port_pause_addr_set
        |                       |   brcm_port_learning_config
        |                       |   bcmPortClassFieldIngress
        |                       |   bcmPortClassFieldLookup
        |                       |   bcmPortControlBridge
        |                       |   brcm_l2ifl_index_insert
        |                       |   brcm_cos_rate_limit_init
        |                       |   brcm_mcast_update_l2pt_customer_group
        |                       |   brcm_mcast_update_l2pt_provider_group
        |                       |   brcm_check_for_mclag_icl
        |                       case PROTO_IPV4/PROTO_IPV6/PROTO_TAG
        |                       brcm_port_l3_intf_init                                                                      expr_port_l3_ifl_init
        |                       |   |
        |                       |   brcm_port_l3_xlation_set
        |                       |       |
        |                       |       bcmVlanTranslateIngressEnable
        |                       |       bcmVlanTranslateEgressEnable
        |                       |       jbrcm_if_evt_port_class_alloc
        |                       |       bcmPortClassVlanTranslateEgress
        |                       |       brcm_vlan_egr_xlat_table_entry_set
        |                       |       bcmVlanPortTranslateKeyFirst = bcmVlanTranslateKeyPortOuter
        |                       |       bcmVlanPortTranslateKeySecond =  bcmVlanTranslateKeyPortOuter
        |                       |   brcm_port_l3_forwarding_set
        |                       |       |
        |                       |       brcm_port_ethertype_set
        |                       |           |
        |                       |           bcm_port_tpid_add = ETHER_TYPE_VLAN
        |                       |           bcm_port_tpid_set //Set port default ether-type also
        |                       |       bcmPortControlL2Learn
        |                       |       bcmPortControlL2Move
        |                       |       brcm_port_igmp_snooping_set
        |                       |       brcm_port_mld_snooping_set
        |                       |       //Enable ARP/DHCP capturing
        |                       |       bcmSwitchDhcpPktToCpu
        |                       |       bcmSwitchDhcpPktDrop
        |                       |       bcmSwitchArpRequestToCpu
        |                       |       bcmSwitchArpReplyToCpu
        |                       |       bcmSwitchNdPktToCpu
        |                       |       l2_bdvlan_port_stp_set_default
        |                       case PROTO_FIBRECHANNEL
        |                       brcm_port_l3_intf_fc_init
        ifrt_ifl_family_change_vector       IF_MSG_IFL_FAMILY_CHANGE
        |   |
        |   ifrt_ifl_family_changer
        |       |
        |       pfe_ifl_family_attach
        ifrt_ifl_family_delete_vector       IF_MSG_IFL_FAMILY_DELETE
        |   |
        |   ifrt_ifl_family_deleter
        |       |
        |       pfe_ifl_family_detach
        |           |
        |           pfe_ifl_family_platform_detach
        |               |
        |               pfe_if_l3ifl_tag_hwtoken_map_delete     (mojito)
        |               pfe_bcm_l3_irb_family_intf_uninit
        |               pfe_bcm_internal_ifl_family_detach
        |               pfe_bcm_l2_bridge_family_intf_uninit
        |                   |
        |                   pfe_bcm_l2_default_ifd_tpid_set
        |               pfe_bcm_l3_family_intf_uninit
        |               pfe_bcm_iff_ref_none
        |
        |               pfe_if_l3ifl_tag_hwtoken_map_delete     (opus)
        |               pfe_brcm_internal_ifl_family_detach
        |               brcm_port_family_detach
        |                   |
        |                   brcm_ifl_l2_uninit
        |                       |
        |                       pfe_bcm_l2_sp_uni_ifd_ifl_cnt_update
        |               pfe_shm_ifl_map_add
        ifrt_ifd_stats_vector       IF_MSG_IFD_STATS
        |   |
        |   ifrt_ifdmsg2fpc
        |       |
        |       pfeman_msg2fpc
        |           |
        |           iffpc_msg_handler
        |               |
        |               iffpc_ifd_stats_vector
        |                   |
        |                   iffpc_reply2master
        |                       |
        |                       ifrt_combined_msg_handler
        |                           |
        |                           ifrt_ifd_stats_reply_vector
        |                               |
        |                               pfe_ifd_ifdstats
        |                                   |
        |                                   ifl_walk
        |                                       |
        |                                       pfe_ifd_stats_from_ifls
        |                                           |
        |                                           pfe_ifd_get_ifl_stats
        |                                               |
        |                                               pfe_get_ifl_stats
        |                                                   |
        |                                                   pfe_ifl_iflstats
        ifrt_ifl_stats_vector       IF_MSG_IFL_STATS
            |
            ifrt_ifl_stats_get
                |
                ifrt_ifl_agg_stats_get_internal
                pfe_ifl_iflstats

pfeman_process_bulkget_requests
    |
    pfeman_stats_proc_ifls_fullstats
        |
        ifrt_ifl_stats_get
            |
            ifrt_ifl_agg_stats_get_internal
                |
                pfe_ifl_iflstats
                    |
                    pfe_get_ifl_stats

ifrt_command_handler
    |
    ifrt_ifl_family_add_vector
        |
        ifrt_ifl_family_adder
            |
            pfe_ifl_family_attach
                |
                pfe_ifl_family_change
                    |
                    expr_port_family_change
                        |
                        expr_port_l3_ifl_init
                            |
                            pfe_if_vlan_hw_token_ifl_map_add #<Port:VLAN-HW-Token>->IFL
                            expr_l3_ifl_tag_hwtoken_map_add #(ifd,vlan-tag) --> vlan-hw-token
                            prds_if_l3_ifd_init
                            expr_if_port_ubfd_setup
                            prds_if_l3_ifl_entry_set
                            prds_if_l3_ifl_l2d_ht_add
                                |
                                jprds_if_l2d_ht_insert
                                    |
                                    jprds_if_l2d_ht_insert_multiple
                            prds_if_l3_ifl_l2d_cfg_set
                                |
                                pechip_slu_l2d_cfg0_set
                                pechip_slu_l2d_cfg1_set
                                pechip_irw_l2domain_cfg_set
    ifrt_ifl_family_change_vector
        |
        ifrt_ifl_family_changer
            |
            pfe_ifl_family_change
                |
                expr_port_family_change
                    |
                    expr_port_l3_ifl_init
                        |
                        expr_if_l3_ifl_l2d_cfg_update
                            |
                            prds_if_l3_ifl_l2d_cfg_set
                                |
                                pechip_slu_l2d_cfg0_set
                                pechip_slu_l2d_cfg1_set
                                pechip_irw_l2domain_cfg_set
ifrt_ifl_remove_vector
    |
    ifrt_ifl_destroy
        |
        if_notify_ifl_cmd
            |
            cos_ifl_cmd
                |
                cos_ifl_cleanup_features
                    |
                    cos_classifier_do_unbind_action
                        |
                        expr_cos_halpv_classifier_unbind
                            |
                            expr_cos_classifier_ifl_attach_ba
                                |
                                expr_l2_l3ifl_baidx_set
                                    |
                                    expr_if_l3_ifl_get_l2d_ht
                                    expr_if_ifl_l2d_ht_val_change

ifrt_ifl_family_add_vector
    |
    ifrt_ifl_family_adder
        |
        ifrt_ifl_family_adder
            |
            ifrt_ifl_family_adder
                |
                bd_iff_attach
                    |
                    ifbd_add_internal_msg
                        |
                        ifbd_msg_handler
                            |
                            expr_l2_sp_bd_ifbd_attach
                                |


ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_delete_vector
            |
            ifrt_ifl_family_deleter
                |
                ifbd_delete_internal_msg
                    |
                    ifbd_msg_handler
                        |
                        ifbd_delete_msg
                            |
                            expr_l2_common_bd_ifbd_detach
                                |
                                jprds_if_l2d_ht_remove
                                    |
                                    jprds_if_l2d_ht_remove_multiple
                                        |
                                        jprds_chash_delete
                                            |
                                            jprds_chash_tbl_delete

#LPORT
ifrt_msg_handler
    |
    ifrt_command_handler
        |
expr_port_ifd_attach
    |

ifrt_ifl_family_add_vector  #IF_MSG_IFL_FAMILY_ADD
    |
    ifrt_ifl_family_adder
        |
ifrt_ifl_agg_remove_ifl_helper
    |
    pfe_ifl_platform_detach

ifrt_slot_ifl_cleanup
    |
    pfe_ifl_detach

pfe_ifl_family_detach
    |
    pfe_ifl_family_platform_detach
        |
        expr_port_family_detach
            |
            expr_port_l2_ifl_uninit
                |
                prds_if_l2_ifl_lport_free_contemplate
                    |
                    prds_if_l2_lport_free
                        |
                        jprds_if_lport_ifd_unmap
                        jprds_if_lport_for_ifl_free
                    jprds_if_port_dflt_lport_set


ifrt_ifl_destroy
    |
    pfe_ifl_detach
        |
        pfe_ifl_platform_detach
            |
            expr_port_ifl_detach
                |
                expr_if_l2_ifl_detach
                    |
                    prds_if_l2_ifl_lport_free_contemplate
                        |
                        prds_if_l2_lport_free
                            |
                            jprds_if_lport_ifd_unmap
                            jprds_if_lport_for_ifl_free
                        jprds_if_port_dflt_lport_set

ifrt_ifl_family_delete_vector
    |
    ifrt_ifl_family_deleter
        |
        pfe_ifl_family_detach
            |
            expr_port_family_detach
                |
                expr_port_l3_ifl_uninit
                    |
                    prds_if_l3_ifd_vctxt_free
                        |
                        jprds_if_lport_vctxt_free #l3 xe-0/0/0 vlan context delete

ifrt_ifl_family_add_vector
    |
    ifrt_ifl_family_adder
        |
        pfe_ifl_family_attach
            |
            pfe_ifl_family_change
                |
                expr_port_l3_ifl_init
                    |
                    prds_if_l3_ifd_init
                        |
                        jprds_if_lport_ifd_vctxt_alloc
                            |
                            jprds_if_lport_vctxt_assign #l3 xe-0/0/0 vlan context alloc
ifrt_ifl_agg_add_ifl_vector
    |
    ifrt_ifl_family_adder
        |
        pfe_ifl_family_attach
            |
            pfe_ifl_family_change
                |
                expr_port_l2_ifl_init
                    |
                    expr_if_l2_ifl_add_lport_helper
                        |
                        jprds_if_lport_for_ifd_alloc
                            |
                            jprds_if_lport_alloc #Lport alloc for xe-0/0/2 (child of ae1)
        bd_iff_attach
            |
            iff_ifbd_walk
                |
                ifbd_add_internal_msg
                    |
                    expr_l2_common_bd_ifbd_attach
                        |
                        expr_l2_ifbd_lport_vid_add
                            |
                            jprds_if_lport_ifd_vctxt_alloc2
                                |
                                jprds_if_lport_vctxt_assign #Vlan context for xe-0/0/2 (child of ae1)


prds_if_l3_ifd_uninit
    |
    prds_if_l3_ifd_vctxt_free
        |
        jprds_if_lport_ifd_vctxt_free
            |
            jprds_if_lport_vctxt_free



#ETHERTYPE RULE & TPID
#TPID Configuration
ifrt_ifd_ioctl_vector   IF_MSG_IFD_IOCTL                                                                    //NO_PROBLEM!!
    |
    pfe_ifd_ge_ioctl
        |  //IF_MSG_IOCTL_ESW_TPID_DATA MORE WORK!!!
        pfe_ifd_ge_platform_ioctl (pfe_if_expr_qfx.c)
            |
            case IF_MSG_IOCTL_VLAN_DLCI_CHAN_ADD                                ASK_KAMAL ??
            case IF_MSG_IOCTL_QIFL_CHAN_DEL                                     ASK_KAMAL ??
            case IF_MSG_IOCTL_ESW_TPID_DATA
            pfe_bcm_l2_bridge_port_tpid_set                                     expr_l2_bridge_port_tpid_set
                |
                pfe_bcm_l2_config_ifd_tpid_set                                  expr_l2_config_ifd_tpid_set
                    |                                                               |
                    bcm_port_tpid_set                                               //Figure out this first!!!

ifrt_ifd_ioctl_vector   IF_MSG_IFD_IOCTL                                                                    //NO_PROBLEM!!
    |
expr_if_test_ui_etype_ptgt_lport
    |
jprds_if_port_etype_set
    |
    pechip_igp_etype_set
        |
    pechip_egp_etype_set
        |
        PE_EGP_MAIN_ETH_KNOWNETYPES_ENTRY_ETYPE_SET

expr_port_add_tag_support
    |
    expr_igp_ai_etype_rule_enable
        |
        jprds_etype_idx_add
            |
            pechip_egp_etype_set
                |
                PE_EGP_MAIN_ETH_KNOWNETYPES_ENTRY_ETYPE_SET
        pechip_igp_ai_etype_rule_enable


expr_if_lb_stream_create
    |
    pfe_ifd_chip_setup
        |
        expr_port_init
            |
            pfe_ifd_chip_setup
                |
                expr_port_init
                    |
                    expr_port_ifd_attach
                        |
                        expr_if_lb_ifd_init
                            |
                            jprds_if_tag_pattern_add
                                |
                                jprds_if_ai_pattern_add
                                    |
                                    jprds_if_ai_etypes_set
                                        |
                                        pechip_igp_ai_etype_rule_set
                            expr_nh_egress_add_etypes
                                |
                                jprds_encap_etype_tbl_install
                                    |
                                    jprds_encap_gen_install
                                        |
                                        jprds_encap_vlan_etype_write



ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_change_vector
            |
            ifrt_ifl_family_changer
                |
                pfe_ifl_family_change
                    |
                    expr_port_l2_ifl_init
                        |
                        expr_port_add_tag_support
                            |
                            expr_nh_egress_add_etypes
                                |
                                jprds_encap_etype_tbl_install = etype_tbl_install
                                    |
                                    jprds_encap_gen_install
                                        |
                                        jprds_encap_vlan_etype_write jprds_encap_gen_write JPRDS_ENCAP_GEN_TBL_WRITE
                                            |
                                            pechip_erw_vlan_etype_tbl_fmt
                                                |
                                                PE_ERW_VLAN_ETYPE_TBL_ETYPE_SET
ifrt_ifl_maddr_add_vector
    |
    if_notify_ifl_config_maddr
        |
        expr_if_ifl_maddr_config #notify_block.ifl_config_maddr
            |
            expr_if_ifl_vtags_get
                |
                pfe_ether_ifl_vtags_get
            case RTM_ADD
            prds_if_ifl_maddr_config #expr_if_pf_vec->ifl_maddr_config
                |
                expr_nh_egress_add_etypes #add tpid
                    |
                    jprds_encap_etype_tbl_install
                        |
                        jprds_encap_gen_install
            pfe_ifl_tpid_idx_set
            pfe_ifl_inner_tpid_idx_set


ifrt_ifd_ioctl_vector
    |
    pfe_ifd_ge_ioctl
        |
        pfe_ifd_ge_platform_ioctl
            |
            expr_l2_bridge_port_tpid_set
                |
                expr_l2_config_ifd_tpid_set
                    |
                    expr_port_add_tag_support
                    expr_l2_update_ifbd_egr_desc
                        |
                        iff_ifbd_walk
                            |
                            expr_l2_ifbd_walk
                                |
                                expr_l2_ifbd_nh_add

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_change
                        |
                        expr_port_l2_ifl_init
                            |
                            expr_port_add_tag_support
                                |
                                jprds_if_tag_pattern_add
                                    |
                                    jprds_if_ai_pattern_add
                                        |
                                        jprds_if_ai_etypes_set
                                            |
                                            #jprds_if_ai_rules already have rule!!!
                                            jprds_get_port_class_info_from_tag
                                                |
                                                pechip_igp_ai_etype_rule_get (chip=0, port=1, idx=10, port_class="", cls="")
                                            jprds_if_ai_install_rule
                                                |
                                                pechip_igp_aipr_rule_set
                                                    |
                                                    start_idx=2640, num_rules=1 IFL_IDX=550
                                                    start_idx=2641, num_rules=1 IFL_IDX=551
                                                bit_set(port_id, jprds_if_ai_rules[chip_num][ai_rule_index]->port_bmap)
                                                bit_set(ai_rule_index, jprds_if_ai_tag_rules_bmap[chip_num]) #jprds_if_ai_tag_rules_bmap
                                                pechip_igp_ai_etype_rule_set (chip=0, port=1, idx=10, port_class=0, cls=1)
                                                pechip_igp_ai_etype_rule_set (chip=0, port=1, idx=10, port_class=0, cls=2)
#LOOPBACK IFD
cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            expr_if_lb_stream_create
                |
                pfe_ifd_chip_setup
                    |
                    expr_port_init
                        |
                        expr_port_ifd_attach
                            |
                            expr_if_lb_ifd_init
                                |
                                pechip_igp_ai_etype_rule_set (chip=0, port=119, idx=10, port_class=0, cls=0)
                                jprds_if_tag_pattern_add
                                    |
                                    jprds_if_ai_pattern_add
                                        |
                                        jprds_if_ai_etypes_set
                                            |
                                            jprds_get_port_class_info_from_tag
                                                |
                                                pechip_igp_ai_etype_rule_get (chip=0, port=119, idx=10, port_class="", cls="")
                                            jprds_if_ai_install_rule
                                                |
                                                pechip_igp_ai_etype_rule_set (chip=0, port=119, idx=10, port_class=0, cls=0)


ifrt_ifl_family_delete_vector       IF_MSG_IFL_FAMILY_DELETE
    |
    ifrt_ifl_family_deleter
        |
        pfe_ifl_family_detach
            |
            pfe_ifl_family_platform_detach
                |
                expr_port_family_detach
                    |
                    expr_port_l2_ifl_uninit
                        |
                        expr_port_init_def
                            |
                            expr_port_init_def_eth
                            pechip_igp_sample_vec_set
                            expr_port_cpclass_init

ifrt_ifd_remove_vector
    |
    pfe_ifd_detach
        |
        pfe_ifd_chip_detach
            |
            expr_port_uninit
                |
                expr_port_init_def

ifrt_ifl_add_vector
    |
    pfe_ifl_attach
        |
        expr_port_ifl_attach
            |
            prds_port_hw_wr_gport_id
                |
                pechip_edf_port_cfg_set

ifrt_ifl_family_add_vector
    |
    ifrt_ifl_family_adder
        |
        pfe_ifl_family_attach
            |
            pfe_ifl_family_change
                |
                expr_port_family_change
                |   |
                |   prds_port_family_get_pl2_iff
                |       |
                |       expr_port_ifl_attach
                |           |
                |           prds_port_hw_wr_gport_id
                |               |
                |               pechip_edf_port_cfg_set
                |
                expr_port_l2_ifl_init
                    |
                    jprds_if_port_dflt_lport_set
                        |
                        pechip_edf_port_cfg_set

expr_port_ifl_attach
    |
    expr_port_untagged_vlan_set
        |
        jprds_if_port_dflt_vlan_set
prds_if_l3_ifd_init
    |
    expr_port_untagged_vlan_set
        |
        jprds_if_port_dflt_vlan_set

expr_port_def_vlan_reset
    |
    jprds_if_port_dflt_vlan_set


#IF_MSG_IFD_IOCTL   -- TPID
ifrt_ifd_ioctl_vector
    |
    pfe_ifd_ge_ioctl
        |
        pfe_ifd_ge_platform_ioctl
            |
            expr_l2_bridge_port_tpid_set
                |
                expr_l2_config_ifd_tpid_set
                    |
                    expr_port_add_tag_support
                    expr_l2_update_ifbd_egr_desc
                        |
                        iff_ifbd_walk
                            |
                            expr_l2_ifbd_walk
                                |
                                expr_l2_ifbd_nh_add #EGRESS NH

ifrt_ifl_family_delete_vector
    |
    ifrt_ifl_family_deleter
        |
        pfe_ifl_family_detach
            |
            pfe_ifl_family_platform_detach
                |
                expr_port_family_detach
                    |
                    expr_port_l3_ifl_uninit
                        |
                        prds_if_l3_ifl_l2d_ht_del
                            |
                            jprds_if_l2d_ht_remove
                                |
                                jprds_if_l2d_ht_remove_multiple
                                    |
                                    jprds_chash_process_result
                                        |
                                        jprds_if_l2d_ht_chg_commit
                                            |
                                            jprds_encap_desc_update_l2d_ht_entry
                                                |
                                                jprds_encap_update_desc_bind
                                                    |
                                                    jprds_if_l2d_ht_entry_bind
                                                        |
                                                        list_get_next
                                                        tvp_watchdog

jprds_fdb_ht_ent_del
jprds_fdb_ht_ent_add
    |
    jprds_dlu_alpha_process_result
        |
        jprds_dlu_alpha_kht_process_result
            |
            jprds_dlu_alpha_kht_process_result_entry
                |
                jprds_dlu_alpha_kht_process_result_entry
                    |
                    jprds_fdb_common_chash_proc_res
                        |
                        jprds_fdb_hash_tbl_write
                            |
                            pechip_dlu_hash_tbl_rw

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_add_vector
            | #install egress descriptor
            ifrt_ifl_family_adder
            |   |
            |   bd_iff_attach
            |       |
            |       ifbd_add_internal_msg
            |           |
            |           ifbd_msg_handler
            |               |
            |               ifbd_create_msg
            |                   |
            |                   ifbd_create_if_msg
            |                       |
            |                       expr_l2_bd_ifbd_attach
            |                           |
            |                           expr_l2_sp_bd_ifbd_attach
            |                               |
            |                               expr_l2_common_bd_ifbd_attach
            |                                   |
            |                                   expr_l2_ifbd_nh_add is_ingress=TRUE #do nothing
            |                                   expr_l2_ifbd_nh_add is_ingress=FALSE
            |                                       |
            |                                       expr_nh_fwd_create_ifbd_descr
            |                                           |
            |                                           expr_nh_egress_ifbd_create_params
            |                                               |
            |                                               prds_encap_egress_add_vlan_sel #format select
            | #install TPID
            ifrt_ifd_ioctl_vector
                |
                pfe_ifd_ge_ioctl
                    |
                    pfe_ifd_ge_platform_ioctl
                        |
                        expr_l2_bridge_port_tpid_set
                            |
                            ifl_walk
                                |
                                expr_l2_config_ifd_tpid_set
                                    |
                                    expr_l2_update_ifbd_egr_desc
                                        |
                                        expr_l2_ifbd_walk
                                            |
                                            expr_l2_change_vlan_xlat
                                                |
                                                expr_l2_ifbd_nh_add
pepic_ifd_eth_attach
    |
    eth_net_attach
    ifgether_init
        |

expr_dfw_module_init
    |
    jam_expr_dfw_shim_init_handler_register
        |
        dfw_shim_init_handler_register
            |

ifrt_ifl_family_add_vector
    |
    ifrt_ifl_family_adder
        |
        pfe_ifl_family_attach
            |
            rt_iff_attach
                |
                expr_rt_iff_attach
                    |
                    expr_rt_iff_lo_attach
                        |
                        expr_dfw_lo0_implicit_flt_attach
                            |
                            dfw_pfe_term_filter_create
                                |
                                dfw_term_entry_create
ifrt_ifd_remove_vector
    |
    pfe_ifd_detach
        |
        pfe_fd_chip_detach
            |
            expr_port_uninit
                |
                expr_port_init_def
                    |
                    expr_port_init_def_eth
                    pechip_igp_sample_vec_set
                    expr_port_cpclass_init

ifrt_command_handler
    |
    ifrt_ifl_add_vector
        |
        pfe_ifl_attach
            |
            pfe_ifl_platform_attach
                |
                pfe_ifd_link_up
                    |
                    expr_if_ifd_stream_enable

ifrt_command_handler
    |
    ifrt_ifd_queue_stats_vector
        |
        expr_if_ifd_queue_stats_get


ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_family_change_vector
            |
            ifrt_ifl_family_changer
                |
                pfe_ifl_family_change
                    |
                    expr_port_l2_ifl_init
                        |
                        expr_port_add_tag_support
                            |
                            expr_nh_egress_add_etypes
                                |
                                jprds_encap_etype_tbl_install = etype_tbl_install
                                    |
                                    jprds_encap_gen_install
                                        | #jprds_encap_gen_write JPRDS_ENCAP_GEN_TBL_WRITE
                                        jprds_encap_vlan_etype_write
                                            |
                                            pechip_mem_write
                                                |
                                                pechip_edf_mem_write #pechp_irp_mem_write
                                                    |
                                                    pechip_edf_vlan_sel_tbl_write #pechip_irp_shadow_write_to_pe

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_config_encap_vector
            |
            pfe_iflconfig
                |
                zephyr_slu_regs_port_config1_table_set



ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ifl_add_vector
        |   |
        |   pfe_ifl_attach
        |       |
        |       pfe_ifl_platform_attach
        |           |
        |           jam_expr_pfe_ifl_platform_attach #jc_if_vec->pfe_ifl_platform_attach
        |               |
        |               pfe_ifl_chip_data_alloc
        |               expr_if_ifl_l2d_alloc
        |                   |
        |                   prds_if_ifl_l2d_alloc
        |                       |
        |                       jprds_if_l2d_id_alloc
        |               expr_if_l2d_pfe_int_alloc_inc
        |               pfe_ifl_local_l2d_set
        |               pfe_ifl_tpid_idx_set
        |               pfe_ifl_inner_tpid_idx_set
        |               jam_expr_pfe_ifd_updown
        |           expr_port_ifl_attach
        |               |
        |               prds_port_hw_wr_gport_id
        |                   |
        |                   expr_if_map_ifd_idx_gport
        |                       |
        |                       jprds_fdb_ht_ent_del #HW
        |                       jprds_fdb_ht_ent_add #HW
        |                           |
        |                           jprds_dlu_alpha_process_result
        |                               |...
        |                               jprds_fdb_hash_tbl_write
        |                                   |
        |                                   pechip_dlu_hash_tbl_rw
        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    pfe_ifl_family_change
                        |
                        expr_port_family_change
                            |
                            prds_port_family_get_pl2_iff
                                |
                                expr_port_ifl_attach
                                    |
                                    prds_port_hw_wr_gport_id
                                        |
                                        expr_if_map_ifd_idx_gport
                                            |
                                            jprds_fdb_ht_ent_del #HW
                                            jprds_fdb_ht_ent_add #HW

ifrt_msg_handler
    |
    ifrt_command_handler
        |
        ifrt_ge_mfilter_vector
            |
            pfe_ifd_mfilter_handler
                |
                pfe_ifd_mfilter_platform_add
                    |
                    expr_port_mfilter_add
                        |
                        expr_l2_mfilter_entry_set
                            |
                            expr_l2_mfilter_mymac_entry_set
                                |
                                prds_if_mymac_entry_add = expr_if_pf_vec->mymac_entry_add
                                    |
                                    jprds_mymac_ht_univ_mac_insert
                                        |
                                        jprds_mymac_ht_insert

        ifrt_ifl_family_add_vector
            |
            ifrt_ifl_family_adder
                |
                pfe_ifl_family_attach
                    |
                    rt_iff_attach
                    |   |
                    |   expr_rt_iff_attach
                    |       |
                    |       expr_rt_iff_lo_attach
                    |           |
                    |           expr_dfw_lo0_implicit_flt_attach
                    |               |
                    |               dfw_pfe_term_filter_create
                    |                   |
                    |                   dfw_term_entry_create
                    pfe_ifl_family_change
                        |
                        expr_port_family_change
                            |
                            expr_port_l3_ifl_init
                                |
                                expr_l2_mfilter_mymac_entry_set
                                    |
                                    prds_if_mymac_entry_add
                                        |
                                        jprds_mymac_ht_univ_mac_insert
                                            |
                                            jprds_mymac_ht_insert
t6e_cr_mymac_add
    |
    expr_if_mymac_entry_add
        |
        prds_if_mymac_entry_add = expr_if_pf_vec->mymac_entry_add
            |
            jprds_mymac_ht_univ_mac_insert
                |
                jprds_mymac_ht_insert

############ RT MSG HANDLER #########################
rt_msg_handler
    |
    rt_entry_delete_msg_proc
    |   |
    |   expr_rt_delete
    |       |
    |       prds_rt_update_layer2
    |           |
    |           prds_rt_update_l2
    |               |
    |               expr_update_route_l2mc
    |                   |
    |                   jprds_fdb_ht_ent_del
    |                       |...
    |                       jprds_fdb_hash_tbl_write
    |                           |
    |                           pechip_dlu_hash_tbl_rw # <*,G,Gl2D> route delete
    rt_entry_add_msg_proc
        |
        expr_rt_create
            |
            prds_rt_create_ipvx_ucast_route
                |
                prds_rt_create_fdb #JPRDS_FDB_KEY_TYPE_L3V_DIPV4
                    |
                    jprds_fdb_ht_ent_add
                        |
                        jprds_dlu_alpha_process_result
                            |
                            jprds_dlu_alpha_kht_process_result
                                |
                                jbwy_chash_process_result
                                    |
                                    zephyr_fdb_chash_proc_res
                                        |
                                        zephyr_hash_tbl_write
                                            |
                                            zephyr_dlu_hash_tbl_rw
                                                |
                                                zephyr_dlu_hash_tbl_sw_mem_rw #actual HW write

rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        topo_connect
        |   |
        |   topo_action
        |       |
        |       rt_entry_topo_handler
        |           |
        |           expr_rt_platform_topo_handler
        |               |
        |               expr_l2_platform_topo_handler
        expr_rt_create
            |
            expr_rt_can_hw_install
            prds_rt_update_layer2
                |
                prds_rt_update_l2 #disabled for ZH
                    |
                    expr_update_route_bd #HW (ZH flood route program - done)
                        |
                        expr_l2_fdb_set_fdbent_params
                        jprds_fdb_ht_ent_add
                            |
                            jprds_dlu_alpha_process_result
                                |...
                                zephyr_dlu_hash_tbl_rw
                                    |
                                    zephyr_dlu_hash_tbl_sw_mem_rw #Flood route HW prog
                    bd_meshgrp_snoop_add_token
                        |
                        bd_update_snoop_status
                            |
                            expr_mcast_snoop_enable_set
                                |
                                expr_l2_bd_change
                                    |
                                    expr_l2_bd_get_halp_data
                                    expr_bd_l2d_attr_set
                    prds_rt_update_l2mc
                        |
                        expr_update_route_l2mc #l2 multicast code flow
                            | #key_type = JPRDS_FDB_KEY_TYPE_GL2D_DIPV4
                            | #key_type = JPRDS_FDB_KEY_TYPE_GL2D_SIPV4_GIPV4
                            jprds_fdb_ht_ent_add
                                |
                                jprds_dlu_alpha_process_result
                                    |
                                    jprds_fdb_hash_tbl_write
                                        |
                                        pechip_dlu_hash_tbl_rw

####################### NH MSG HANDLING ###############################
#ADD NATIVE VLAN
nh_msg_handler
    |
    nh_change
        |
        nh_change_helper
            |
            nh_change_major
                |
                topo_migrate
                    |
                    topo_action
                        |
                        rt_entry_topo_handler
                            |
                            expr_rt_rebake
                                |
                                prds_rt_update_layer2
                                    |
                                    expr_update_route_bd
                                        |
                                        jprds_fdb_ht_ent_change
                                            |
#DELETE CASE
nh_msg_handler
    |
    nh_change
        |
        nh_change_helper
            |
            nh_change_major
                |
                nh_add_helper
                    |
                    nh_ucast_initialize
                        |
                        expr_nh_ucast_initialize
                            |
                    nh_ucast_add
                        |
                        nh_ucast_install
                            |
                            expr_nh_fwd_nh_install
    nh_add_helper
        |
        nh_ucast_add
            |
            ....jprds_encap_desc_add
        nh_composite_add
            |
            nh_composite_install
                |
                expr_nh_composite_install
                    |
                    expr_nh_mcast_composite_install
                        |
                        prds_nh_mcast_rep_desc_install
                            |
                            jprds_encap_desc_update
                                |
                                jprds_encap_desc_add
                                jprds_encap_desc_del_internal

#ADD CASE
nh_msg_handler
    |
    nh_add_helper #NHDB_MSG_ADD_NH
        |
        nh_ucast_initialize
        |   |
        |   expr_nh_ucast_initialize
        |       |
        |
        nh_ucast_add
        |   |
        |   nh_ucast_install
        |       |
        |       expr_nh_fwd_nh_install
        |           |
        |           expr_nh_fwd_create_egress_handles
        |               |
        |               expr_nh_fwd_update_ifbd_descr
        |                   |
        |                   expr_l2_ifbd_walk
        |                       |
        |                       expr_l2_ifbd_nh_add
        |                           |
        |                           expr_nh_fwd_create_ifbd_descr
        |                               |
        |                               expr_nh_egress_ifbd_create_params
        |                                   |
        |                                   prds_encap_egress_add_vlan_sel
        |                                       |
        |                                       expr_if_ifl_vtags_get
        |                                           |
        |                                           pfe_ether_ifl_vtags_get
        |                                       #set vlan_sel_app,
        |                                       prds_if_vlan_rw_op_idx_get
        |                               expr_nh_ifbd_token_to_flabel
        |                               jprds_encap_desc_add #jencap_vec.desc_add
        |                                   |
        |                                   jprds_egress_desc_prepare
        |                                       |
        |                                       jprds_egress_encaps_install
        |                                       jprds_encap_vlan_sel_get_app_idx
        |                                       jprds_edf_encode_dfv_vlan
        |                                       jprds_encap_vlan_sel_get_app_idx
        |                                   jprds_encap_add_tags
        |                                   jprds_add_p_next_dft
        |                                   jprds_encap_handle_alloc
        |                                   jprds_edf_flabel_chain_install
        |                                   jprds_encap_desc_init
        |                                   jprds_add_p_next_dft
        |                                   jprds_encap_desc_l2dtbl_bind
        |                                   jprds_edf_flabel_chain_install
        |                                   jprds_encap_desc_init
        nh_composite_add
            |
            nh_composite_install
                |
                expr_nh_composite_install
                    |
                    expr_nh_mcast_composite_install
                        |
                        prds_nh_mcast_rep_desc_install
                            |
                            jprds_encap_desc_add

nh_msg_handler
    |
    nh_add_helper
    |   |
    |   nh_ucast_add
    |   |   |
    |   |   nh_ucast_install
    |   |       |
    |   |       expr_nh_fwd_nh_install
    |   |           |
    |   |           expr_nh_fwd_create_egress_handles
    |   |               |
    |   |               expr_nh_fwd_create_all_descr
    |   |                   |
    |   |                   expr_nh_fwd_create_flabel_descr
    |   |                       |
    |   |                       jprds_encap_desc_add
    |   |                           |
    |   |                           jprds_edf_flabel_chain_install
    |   |                               |
    |   |                               jzphr_encap_flabel_install
    |   |                                   |
    |   |                                   jencap_mapid_ht_ent_add
    |   |                                       |
    |   |                                       jbwy_chash_process_result
    |   |                                           |
    |   |                                           jzphr_encap_mapid_chash_proc_res
    |   |                                               |
    |   |                                               zephyr_hash_tbl_write
    |   |                                                   |
    |   |                                                   zephyr_epp_mapid_hash_tbl_rw #actual HW write
    |   |
    |   nh_composite_add #(during l2 add)
    |       |
    |       nh_composite_install
    |           |
    |           expr_nh_composite_install
    |               |
    |               expr_nh_mcast_composite_install
    |                   |
    |                   expr_nh_mcast_composite_install_internal
    |                       | #ZH
    |                       nh_mcast_create_rep_entries
    |                       |   |
    |                       |   zh_nh_mcast_create_rep_entries
    |                       |       |
    |                       |       jmce_local_rep_create
    |                       |           |
    |                       |           jmce_get_one_blk_for_instr_buff
    |                       |               |
    |                       |               jmce_program_rep_tbl_blk
    |                       |                   |
    |                       |                   zephyr_mce_regs_cfg_rep_tbl_set
    |                       |           jmce_eg_nhid_table_set
    |                       |               |
    |                       |               zephyr_mce_regs_cfg_nhid_map_set #HW
    |                       | #PE
    |                       prds_rt_create_rep_tree
    |                       |   |
    |                       |   jprds_fdb_dirzn_ent_add
    |                       |       |
    |                       |       pechip_dlu_mem_rw
    |                       | #(ZH TBD)
    |                       jprds_edf_flabel_install
    |                       |   |
    |                       |   jprds_edf_flabel_init_stage_2
    |                       |       |
    |                       |       jprds_edf_chip_desc_mem_write
    |                       |           |
    |                       |           jprds_nh_write_block
    |                       |               |
    |                       |               pechip_irp_mem_write #HW
    |                       | #(ZH TBD)
    |                       prds_nh_mcast_rep_desc_install
    |                           |
    |                           jprds_encap_desc_add
    |                               |
    |                               jprds_edf_flabel_chain_install
    |                                   |
    |                                   jprds_edf_flabel_install
    |                                       |
    |                                       jprds_edf_flabel_init_stage_2
    |                                           |
    |                                           jprds_edf_chip_desc_mem_write
    |                                               |
    |                                               jprds_nh_write_block
    |                                                   |
    |                                                   pechip_irp_mem_write #HW
    nh_delete_helper
    |   |
    |   nh_composite_delete
    |       |
    |       expr_nh_composite_uninstall
    |           |
    |           expr_nh_mcast_composite_uninstall
    |               |
    |               expr_nh_mcast_composite_uninstall_internal
    |                   |
    |                   expr_nh_mcast_free_hdl
    |                       |
    |                       jprds_encap_desc_del
    |                           |
    |                           jprds_encap_read_desc_list_params
    |                           |   |
    |                           |   jprds_edf_chip_desc_mem_read
    |                           |       |
    |                           |       jprds_nh_read_block
    |                           |           |
    |                           |           pechip_irp_mem_read
    |                           jprds_encap_desc_del_internal
    |                               |
    |                               jprds_edf_flabel_uninstall
    |                                   |
    |                                   jprds_edf_chip_desc_mem_write
    |                                       |
    |                                       jprds_nh_write_block
    |                                           |
    |                                           pechip_irp_mem_write
    nh_change
        |
        nh_change_helper
            |
            nh_change_major
                |
                topo_migrate
                    |
                    topo_action
                        |
                        nh_topo_handler
                            |
                            nh_composite_change_platform
                                |
                                nh_composite_topo_child_change
                                    |
                                    nh_composite_change
                                        |
                                        topo_migrate
                                        |   |
                                        |   topo_action
                                        |       |
                                        |       rt_entry_topo_handler
                                        |           |
                                        |           expr_rt_rebake
                                        |               |
                                        |               expr_rt_can_hw_install
                                        |               prds_rt_update_layer2
                                        |                   |
                                        |                   prds_rt_update_l2
                                        |                       |
                                        |                       expr_update_route_bd
                                        |                           |
                                        |                           expr_l2_fdb_set_fdbent_params
                                        |                           jprds_fdb_ht_ent_change
                                        |                               |
                                        |                               zephyr_fdb_chash_proc_res
                                        |                                   |
                                        |                                   zephyr_fdb_htent_pack
                                        |                                       |
                                        |                                       zephyr_fdb_action_data_get
                                        |                                           |
                                        |                                           expr_nh_embed_nh_build
                                        |                                               |
                                        |                                               prds_nh_get_handle #get jnh_handle
                                        |                                                   |
                                        |                                                   expr_nh_ingress_get_handle
                                        |                                                       |
                                        |                                                       expr_nh_get_per_app_ptr
                                        |                                                           |
                                        |                                               jprds_nh_ext_format_get
                                        |                                                   |
                                        |                                                   jprds_nh_seq_ocm_install_internal
                                        |                                                       |
                                        |                                                       jprds_nh_onchip_install
                                        |                                                           |
                                        |                                                           jprds_nh_write_block
                                        |                                                               |
                                        |                                                               zephyr_irp_mem_write
                                        |                               jprds_fdb_hash_tbl_write
                                        |                                   |
                                        |                                   pechip_dlu_hash_tbl_rw PECHIP_FLT_MAX
                                        nh_add_helper #(during l2 delete)
                                            |
                                            nh_composite_add
                                                |
                                                nh_composite_install
                                                    |
                                                    expr_nh_composite_install
                                                        |
                                                        expr_nh_mcast_composite_install
                                                            |
                                                            expr_nh_mcast_composite_install_internal
                                                                | #ZH
                                                                nh_mcast_create_rep_entries
                                                                |   |
                                                                |   zh_nh_mcast_create_rep_entries
                                                                |       |
                                                                |       jmce_local_rep_create
                                                                |           |
                                                                |           jmce_eg_nhid_table_set
                                                                |               |
                                                                |               ephyr_mce_regs_cfg_nhid_map_set #HW
                                                                | #PE
                                                                prds_rt_create_rep_tree
                                                                    |
                                                                    ...
                                                            prds_nh_mcast_rep_desc_install
                                                                |
                                                                jprds_encap_desc_update
                                                                    |
                                                                    jprds_encap_read_desc_list_params
                                                                    |   |
                                                                    |   jprds_edf_chip_desc_mem_read
                                                                    |       |
                                                                    |       jprds_nh_read_block
                                                                    |           |
                                                                    |           pechip_irp_mem_read
                                                                    jprds_encap_desc_add
                                                                        |
                                                                        jprds_edf_flabel_chain_install
                                                                            |
                                                                            jprds_edf_flabel_install
                                                                                |
                                                                                jprds_edf_flabel_init_stage_2
                                                                                    |
                                                                                    jprds_desc_update
                                                                                        |
                                                                                        jprds_edf_priv_desc_mem_write
                                                                                            |
                                                                                            jprds_edf_chip_desc_mem_write
                                                                                                |
                                                                                                jprds_nh_write_block
                                                                                                    |
                                                                                                    pechip_irp_mem_write
nh_show_command
    |
    nh_show
        |
        expr_nh_composite_show
            |
            expr_nh_mcast_show
                |
                jprds_nh_seq_show_trace
                    |
                    jprds_nh_decode_descriptor
                        |
                        jprds_nh_ingress_desc_action_print
####################### BD and IFBD MSG HANDLING ###############################
bd_msg_handler
    |
    bd_handle_msg
        |
        bd_platform_setup
            |
            pfe_bcm_l2_bd_add_halp_data                                                         expr_l2_bd_add_halp_data
            pfe_bcm_l2_bd_add                                                                   expr_l2_bd_add
                |
                pfe_bcm_l2_get_bd_mode                                                          expr_l2_get_bd_mode
                pfe_bcm_l2_sp_bd_vlan_hw_program                                                expr_l2_sp_bd_hw_program
                    |
                    pfe_bcm_l2_common_vlan_hw_program               (opus/mojito)               expr_l2_common_bd_hw_program
                        |
                        bcm_vlan_create
                        brcm_mcast_vlan_vcp_tree_set  //V20
                        bcm_vlan_control_vlan_t_init
                        bcm_vlan_control_vlan_set
                        bcm_vlan_stg_set
                pfe_bcm_l2_ep_bd_vlan_hw_program                    (mojito)                    expr_l2_ep_bd_hw_program
                    |
                    pfe_bcm_l2_common_vlan_hw_program                                           expr_l2_common_bd_hw_program
                        |
                        bcm_vlan_create                                                         jprds_if_l2d_cfg_alloc //allocate l2domain config structure
                        brcm_mcast_vlan_vcp_tree_set  //V20
                        bcm_vlan_control_vlan_t_init
                        bcm_vlan_control_vlan_set
                        bcm_vlan_stg_set
                    pfe_bcm_l2_global_vlan_xlat_rule
                        |
                        pfe_bcm_l2_vlan_ing_xlat_table_entry_set
                            |
                            bcm_vlan_translate_action_add bcmVlanTranslateKeyPortOuter
                    pfe_bcm_l2_oam_filter_process
                    pfe_bcm_pvlan_process_bd_add
#                pfe_bcm_l2_ep_bd_add                                (opus)                      expr_l2_ep_bd_hw_program
#                    |                                                                               |
#                    brcm_virtual_bd_add                                                             expr_l2_common_bd_hw_program
#                    bcm_vlan_control_vlan_t_init                                                        |
#                    brcm_bcm_vlan_control_vlan_set                                                      jprds_if_l2d_cfg_alloc //allocate l2domain config structure
#                    brcm_vlan_proto_control_enable
#                    bcm_vlan_port_add
#                    brcm_vlan_ing_xlat_table_entry_set
#                    brcm_l2_bdvlan_unreg_mcast_fwd_clr
#                    brcm_mcast_vlan_vcp_tree_set
            pfe_bcm_bd_vlan_map_set                                                             expr_l2_bd_entry_set
                |
                vlan_id = bd_get_vlan_token(bd)                                                 gl2d_id = bd_get_vlan_token(bd)
                bd_id = bd_get_bd_id(bd)                                                        bd_id = bd_get_bd_id(bd)
                //Store bd_to_vlan & vlan_to_bd                                                 //Store gl2d_to_bd                                  DIFF
            dfw_ftf_add
            pfe_bcm_l2_bd_change                                                                expr_l2_bd_change
                |
                bd_get_vlan_token (bd->bd_vlan_token)                                           expr_l2_bd_get_halp_data (bd->bd_halp_user_data)
                NA                                                                              expr_bd_l2d_attr_set                                DIFF
bd_msg_handler
    |
    ifbd_msg_handler
        |
        ifbd_create_if_msg
            |
            expr_l2_common_bd_ifbd_attach
                |
                expr_l2_ifbd_lport_vid_add
                    |
                    expr_l2_l2d_ht_insert
                        |
                        jexpr_jif_l2d_ht_ent_insert
                            |
                            jexpr_if_l2d_ht_insert
                                |
                                jexpr_if_l2d_ht_insert_multiple
                                    |
                                    jbwy_chash_process_result
                                        |
                                        jexpr_if_l2d_ht_chg_commit
                                            |
                                            zephyr_slu_hash_tbl_rw
                                                |
                                                zephyr_slu_regs_l2_domain_hash_table_tbl_set


bd_msg_handler
    |
    bd_handle_msg
        |
        bd_platform_setup
            |
            expr_l2_bd_add
                |
                expr_l2_ep_bd_hw_program
                    |
                    expr_l2_common_bd_hw_program
                        |
                        jexpr_if_vlan_create #JEXPR_JIF_VECTORS.jexpr_jif_vlan_create
                            |
                            jexpr_if_l2d_id_alloc 2
                            jexpr_if_l2d_gl2d_map 3
                            jexpr_if_l2d_attr_reset 4
                                |
                                zephyr_set_slu_l2d_attr
                                    |
                                    zephyr_slu_regs_l2_domain_config1_table_get
                                    zephyr_slu_regs_l2_domain_config1_table_set
                                    zephyr_slu_regs_l2_domain_config0_table_get
                                    zephyr_slu_regs_l2_domain_config0_table_set
                            jexpr_if_gl2d_itable_entry_insert
                        jexpr_if_vlan_configure #JEXPR_JIF_VECTORS.jexpr_jif_vlan_configure
                            |
                            jexpr_if_l2domain_cfg_set
                                |
                                zephyr_set_l2d_cfg #jif_vec->asic_set_l2d_cfg
                                    |
                                    zephyr_set_slu_l2d_cfg0 5
                                    zephyr_set_slu_l2d_cfg1 6
                                        |
                                        zephyr_slu_regs_l2_domain_config1_table_set #l2
                                    zephyr_set_irw_l2d_cfg 7
                                    zephyr_slu_regs_l2_domain_config0_table_set #l2
                        expr_bd_l2d_attr_set
                            |
                            jexpr_if_l2d_attr_update
                                |
                                zephyr_set_slu_l2d_attr
                                    |
                                    zephyr_slu_regs_l2_domain_config1_table_set
                                    zephyr_slu_regs_l2_domain_config0_table_set

bd_msg_notify
    |
    l2alm_bd_add
        |
        l2alm_set_learning_cfg_in_hw
            |
            expr_l2_set_bd_learning
                |
                jexpr_jif_vlan_config_sa_learning
                    |
                    zephyr_set_l2d_cfg
                        |
                        zephyr_slu_regs_l2_domain_config0_table_set
                        zephyr_slu_regs_l2_domain_config1_table_set

bd_msg_handler
    |
    ifbd_msg_handler
        |
        ifbd_create_if_msg
        |   |
        |   bd_platform_ifbd_attach
        |   |   |
        |   |   expr_l2_bd_ifbd_attach
        |   |       |
        |   |       expr_l2_common_bd_ifbd_attach
        |   |           |
        |   |           expr_l2_ifbd_lport_vid_add
        |   |           |   |
        |   |           |   expr_l2_l2d_ht_insert
        |   |           |       |
        |   |           |       jprds_if_l2d_ht_insert
        |   |           |           |
        |   |           |           jprds_if_l2d_ht_insert_multiple
        |   |           |               |
        |   |           |               jprds_if_l2d_ht_chg_commit
        |   |           |                   |
        |   |           |                   jprds_chash_process_result
        |   |           |                       |
        |   |           |                       jprds_if_l2d_ht_chg_commit
        |   |           |                           |
        |   |           |                           pechip_slu_hash_tbl_write #HW
        |   |           expr_l2_ifbd_nh_add
        |   |               |
        |   |               expr_nh_fwd_create_ifbd_descr
        |   |                   |
        |   |                   jprds_encap_desc_add
        |   |                       |
        |   |                       jprds_edf_flabel_chain_install
        |   |                           |
        |   |                           jprds_edf_priv_desc_mem_write
        |   |                           |   |
        |   |                           |   jprds_edf_chip_desc_mem_write
        |   |                           |       |
        |   |                           |       jprds_nh_write_block
        |   |                           |           |
        |   |                           |           pechip_irp_mem_write #HW
        |   |                           jprds_edf_flabel_install
        |   |                               |
        |   |                               jprds_edf_flabel_init_stage_2
        |   |                                   |
        |   |                                   jprds_edf_chip_desc_mem_write
        |   |                                       |
        |   |                                       jprds_nh_write_block
        |   |                                           |
        |   |                                           pechip_irp_mem_write #HW
        |   expr_update_route_ifbd
        |       |
        |       jprds_fdb_ht_ent_add #HW
        |           |
        |           jprds_dlu_alpha_process_result
        |               | ....
        |               jprds_fdb_hash_tbl_write
        |                   |
        |                   pechip_dlu_hash_tbl_rw
        |
        |  #(ZH TBD)
        expr_l2_common_bd_ifbd_detach
            |
            expr_l2_ifbd_nh_del
                |
                expr_nh_free_ifbd_encap_handle
                    |
                    jprds_encap_desc_del
                        |
                        jprds_encap_read_desc_list_params
                            |
                            jprds_edf_chip_desc_mem_read
                                |
                                jprds_nh_read_block
                                    |
                                    pechip_irp_mem_read
                        jprds_encap_desc_del_internal
                            |
                            jprds_edf_flabel_uninstall
                                |
                                jprds_edf_chip_desc_mem_write
                                    |
                                    jprds_nh_write_block
                                        |
                                        pechip_irp_mem_write #HW
#############################################
test_mymac_debug_command
    |
    jprds_mymac_ht_insert
        |
        jprds_mymac_ht_hash_fn
            |
            test_mymac_get_key #hndl->key_fn
            jexpr_mymac_ht_get_hash_key
            zephyr_hash_mymac_hash_func #asic_mymac_hash_func
        jprds_chash_add
        jprds_chash_process_result
        jprds_chash_release_result


cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            cmqfx_zephyr_init
                |
                zephyr_init
                    |
                    zephyr_init_blocks
                        |
                        zephyr_block_init
                            |
                            zephyr_igp_block_init
                                |
                                zephyr_igp_regs_eth_ptgt_params_set
                            zephyr_slu_block_init
                                |

jprds_halp_asic_ready_notify
    |
    jprds_halp_pe_ready_notify
        |
        jprds_igp_init
            |
            jprds_etype_init
                |
                jprds_etype_idx_add
                    |
                    pechip_igp_etype_set
                    pechip_egp_etype_set
                pechip_igp_term_etype_rule_set
                pechip_egp_term_etype_rule_set
            pechip_igp_service_type_tbl_set

# STP CODE ###################################################################
stp_process_ifbd
    |
    stp_platform_ifbd_update_hw
        |
        expr_l2_stg_add_vlan_stg_entry
            |
            expr_l2_stg_port_stg_update_by_bd

stp_platform_ifbd_update_hw
    |
    expr_l2_stg_delete_vlan_stg_entry
        |
        expr_l2_stg_port_stg_update_by_bd
expr_l2_stg_update_by_ifbd
    |
    expr_l2_stg_port_stg_update_by_bd
expr_l2_stg_chg_port_state
    |
    expr_l2_stg_port_stg_update_by_bd
expr_l2_stg_mv_bd_port
    |
    expr_l2_stg_add_vlan_stg_entry
        |
        expr_l2_stg_port_stg_update_by_bd
expr_l2_stg_delete_vlan_stg_entry
    |
    expr_l2_stg_port_stg_update_by_bd


# Shadow memory handling

pechip_setup
    |
    pechip_alloc_shadow_mem (alloc for irp (shadow/mainmem), edf, erw

#IRP
pechip_lkup_type_hw_update
pechip_lkup_type_hw_init
pechip_irp_ntlu_attr_voq_offset_set
pechip_lkup_type_hw_update
pechip_lkup_type_hw_init
    |
    pechip_irp_ntlu_attr_mem_set
        |
        pechip_irp_shadow_write_to_pe

jprds_halp_pe_ready_notify
    |
    jprds_encap_hw_init
        |
        jprds_encap_vlan_sel_tbl_mem_init
            |
            pechip_mem_write
                |
                pechp_irp_mem_write
                    |
                    pechip_irp_shadow_write_to_pe

#jprds_nh_mem_test_cmd
    |
    jprds_nh_write_block
        |
        pechip_mem_write
            |
            pechip_irp_mem_write
                |
                pechip_irp_shadow_write_to_pe

#pechip_init_test_command
    |
    pechip_init
        |
        pechip_init_blocks
            |
            pechip_irp_init
                |
                pechip_irp_fault_handler
                    |
                    pechip_irp_write_from_shadow
                        |
                        pechip_irp_mainmem_write_from_shadow
                            |
                            pechip_irp_shadow_write_to_pe
                        pechip_irp_simple_write_from_shadow
                            |
                            pechip_irp_shadow_write_to_pe
                        pechip_irp_block_write_from_shadow
                            |
                            pechip_irp_shadow_write_to_pe
#pechip_irp_test_command
    |
    pechip_irp_vpfe_set
        |
        pechip_irp_shadow_write_to_pe
pechip_irp_servtype_attr_mem_set
pechip_irp_congest_mgmt_set
pechip_irp_storm_wd_thrsh_set
pechip_irp_vpfe_model_pcfg_set
pechip_irp_voq_tc2q_mem_set
    |
    pechip_irp_shadow_write_to_pe
pechip_irp_shadow_mem_info_get
pechip_irp_show_shadow_mem

#Others
pechip_simple_write_from_shadow
pechip_show_shadow_mem
pechip_dlu_write_plt_from_shadow
pechip_dlu_write_from_shadow
pechip_flt_whole_write_from_shado
pechip_flt_alpha_bft_rewrite_from
pechip_flt_cv_ptrn_rewrite_from_s
pechip_flt_cv_cv_rewrite_from_sha
pechip_flt_smi_rewrite_from_shado
pechip_flt_write_from_shadow

##############################################################
nh_msg_handler
    |
    nh_add_helper
        |
        nh_ucast_add
        |   |
        |   nh_ucast_install
        |       |
        |       expr_nh_fwd_nh_install
        |           |
        |           expr_nh_ucast_install
        |               | #install ingress JNH handle
        |               expr_nh_ucast_create_ingress_handles
        |                   |
        |                   expr_nh_fwd_update_ifbd_descr
        |                       |
        |                       expr_l2_ifbd_walk
        |                           |
        |                           expr_l2_add_vlan_xlat
        |                               |
        |                               expr_l2_ifbd_nh_add is_ingress=TRUE
        |                                   |
        |                                   expr_nh_ifbd_jnh_handle_create
        |               expr_nh_fwd_create_egress_handles
        |                   |
        |                   expr_nh_fwd_update_ifbd_descr
        |                       |
        |                       expr_l2_add_vlan_xlat #do nothing
        nh_unilist_add
            |
            expr_nh_unilist_install
                |
                expr_nh_agg_install
                    |
                    expr_nh_agg_ingress_install
                        |
                        expr_nh_ifbd_agg_ingress_update
                            |
                            expr_l2_agg_ifbd_walk
                                |
                                expr_l2_agg_ingress_nh_install
                                    |
                                    expr_l2_ifbd_nh_add_agg

#0  prds_encap_egress_add_vlan_sel (inst=3, ifl=0xa1aed9e8, nh=0x8aac3bf0, egress_params=0x8aac4118)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_utils_prds.c:849
#1  0x082eb8f9 in expr_nh_egress_create_params (inst=3, nh=0x8aac3bf0, l2rw_encaps_params=0x8a8de10c,
    flags=0, egress_params=0x8aac4118)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_egress.c:506
#2  0x0832c1dc in expr_nh_fwd_create_l2_descr (fwd_egress_descr=<optimized out>,
    tok_idx=<optimized out>, fe_id=<optimized out>, l2rw_encap_params=<optimized out>,
    nh=<optimized out>)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_ucast.c:2185
#3  expr_nh_fwd_create_all_descr (nh=0x8aac3bf0, l2rw_encap_params=0x8a8de10c, fe_id=3,
    fwd_egress_descr=0xa1a13754, tok_idx=0 '\000')
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_ucast.c:3593
#4  0x0832eddc in expr_nh_fwd_create_egress_handles (nh=0x8aac3bf0, l2rw_encaps_params=0x8a8de10c)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_ucast.c:4741
#5  0x08330bfe in expr_nh_ucast_install (l2rw_encap_params=<optimized out>, nh=<optimized out>)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_ucast.c:4920
#6  expr_nh_fwd_nh_install (nh=0x8aac3bf0, l2rw_encap_params=0x8a8de10c)
    at ../../../../../../../../../src/pfe/common/pfe-arch/express/applications/nh/nh_ucast.c:5128
#7  0x0824813e in nh_ucast_install (nh=0xa1aed9e8, l2rw_encap_params=0x3)
    at ../../../../../../../../src/pfe/common/applications/nh/hal/nh_ucast.c:772
#8  0x0824b8da in nh_ucast_add (nh_params=0x89d99574, nh=0x8aac3bf0)
    at ../../../../../../../../src/pfe/common/applications/nh/hal/nh_ucast.c:201
#9  0x081c4344 in nh_add_helper (nh_params=0x89d99574, ret_nh=0x0)
    at ../../../../../../../../src/pfe/common/applications/nh/hal/nh.c:885
#10 0x08210bd6 in nh_msg_handler (pipe=0x8a452420, msg=0x74df5600)
    at ../../../../../../../../src/pfe/common/applications/nh/hal/nh_ipc.c:2541
#11 0x08116697 in pfeman_session_manager (pipe=0x8a452420, msg=0x74df5600)
    at ../../../../src/pfe/common/applications/pfeman/pfeman_session.c:619
#12 0x08115174 in pfeman_rt_msg_handler (pipe=0x8a452420)
    at ../../../../src/pfe/common/applications/pfeman/pfeman_rt_csf.c:572
---Type <return> to continue, or q <return> to quit---
#13 pfeman_rt_thread () at ../../../../src/pfe/common/applications/pfeman/pfeman_rt_csf.c:1372
#14 0x08062020 in ?? () at ../../../../../../src/pfe/ukern/common/thread.c:465
#15 0x00000000 in ?? ()

_sess_read
    |
    _sess_process_packet
        |
        handle_snmp_packet
            |
            netsnmp_handle_request
                |
                handle_pdu
                    |
                    handle_getnext_loop
                        |
                        handle_var_requests
                            |
                            netsnmp_call_handlers
                                |
                                netsnmp_call_handler
                                    |
                                    nsm_legacy_handler
                                        |
                                        dot3adAggPortListEntry_next
                                            |
                                            snmpEntry_next_oev
                                                |
                                                snmpEntry_internal_next
                                                    |
                                                    snmpEntry_next_value
                                                        |
                                                        dot3adAggPortListEntry_get_value
###
##COS REWRITE
RTM_CHANGE => EGRESS  DESCRIPTOR
RTM_ADD    => INGRESS JNH_HANDLE

expr_l2_update_ifbd_egr_desc => RTM_CHANGE (ALWAYS FOR TPID)
    |
    expr_l2_ifbd_walk

nh_ucast_install
    |
    expr_nh_fwd_nh_install
        |
        expr_nh_fwd_create_egress_handles
            |
            expr_nh_fwd_update_ifbd_descr
                |
                expr_l2_ifbd_walk
                    |
                    expr_l2_ifbd_nh_add
                        |
                        expr_nh_fwd_create_ifbd_descr
                            |
                            expr_nh_egress_ifbd_create_params

#PECHIP INIT
pechip_module_init
    |
    pechip_driver_init
        |
        hw_initialized=FALSE
        pechip_lkup_type_db_init
            |
            pechip_service_type_db_init

pechip_setup
    |
    pechip_set_platform_params
    pechip_hostif_init
    jspec_pio_set_simulation_cookie
    pechip_pio_setup
    pechip_jspec_register
    pechip_get_jtag_id
    pechip_avago_serdes_register
    pechip_block_reset
    pechip_set_max_planes
    pechip_alloc_shadow_mem
    pechip_start_fast_inits
    pechip_fast_init_done
    pechip_epr_init1
    pechip_dlu_pre_init
    pechip_plat_specific_init

pechip_init_finish
    |
    hw_initialized=TRUE
    pechip_dlu_load_ucode
        |

#RPIO CONF
junos/bsd/etc/vqfx-rpio.conf
cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            get_rpio_chip_id

cmqfx_pechip_init
    |
    jprds_halp_asic_ready_notify
        |
        jprds_halp_pe_ready_notify
            |
            jprds_fdb_init
                |
                jprds_fdb_chash_init
                jprds_fdb_dirzn_init
                jprds_fdb_slowcnt_init
                pile_create
rt_msg_handler
    |
    rt_table_add_msg_proc
        |
        expr_rtt_create
            |
            prds_rtt_create_layer3
                |
                prds_rtt_mpls_create
                    |
                    prds_rt_alloc_stats_counters
                        |
                        jprds_fdb_slowcnt_alloc
                            |
####
0x0c74a000  pfem_data_hdr 108 (0x06c)
0x0c74a06c  pfem_sfi_info 316 (0x13c)
0x0c74a1a8  shared_mem_base
0x0c74a1a8  fxpc_ukern_mem_base
            kernel_heap_size = fxpc_ukern_mem_size = 0xffffe58=>268435032
0x0c74a1a8  heap_start
0x1c74a000  heap_end (heap_start + kernel_heap_size)

0x0c74a1a8  kernel_heap->free_regions[0].start
            kernel_heap->free_regions[0].size = 0xffffe58

ukern_main
    |
    hardware_basic_init
        |
        fxpc_platform_heap_init
            |
            fxpc_heap_mem_alloc #allocate memory
            fxpc_heap_init
                |
                heap_create
                    |
                    heap_region.start = 0xc74a1a8
                    heap_region.size  = 0xffffe58
                    heap_create_regions
                        |
                        heap_freelist_create
                heap_low_watermark_set

zhchip_jspec_v1_0_module_init
    |
    jspec_register_chip
        |

cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            cmqfx_create_asic_pio_handles
                |
                cmqfx_create_cosim_asic_pio_handles
                    |
                    rpio_pio_create
                        |
                        pio_create
                    trinity_pio_create
                        |
                        pio_create
                    event_setup
                        |
                        rpio_pio_create
                            |
                            pio_create
            cmqfx_zhchip_init
                |
                zhchip_init
                    |
                    zhchip_get_dev_cb
                    zephyr_set_pio_handle
                    zephyr_set_fabric_mode
                    zhchip_setup
                        |
                        zhchip_get_dev_cb
                        zhchip_set_platform_params
                        zhchip_hostif_init
                        jspec_pio_set_simulation_cookie
                        zhchip_pio_setup
                        zhchip_jspec_register
                        zephyr_set_jspec
                        zhchip_get_jtag_id
                        zhchip_avago_serdes_register
                        zhchip_block_reset
                        zhchip_set_max_planes
                        zhchip_alloc_shadow_mem #SHADOW
                        zhchip_fast_inits_start
                            |
                            zephyr_block_init_trigger
                        zhchip_fast_inits_done
                            |
                            zephyr_block_init_done
                        zhchip_dlu_pre_init
                        zhchip_plat_specific_init
                    toe_cfg.toe_init_func
                    zhchip_init_blocks
                        |
                        zephyr_block_init
                    zhchip_init_finish
                    zhchip_pio_setup
                        |
                        pio_create
                    zhchip_jspec_register
                        |
                        jspec_create
                            |
                            jspec_find_chip


zephyr_module_init
    |
    zephyr_block[i].hw_absent = TRUE;

zephyr_irp_init_done
    |
    zephyr_irp_init_done_value
    zephyr_get_pio_handle
zephyr_irp_intr_init
    |
    zephyr_get_reg_count

##############################################
in_ether_getrewrite
arp_rtclone
    |
    ARPL_SETREWRITE = in_ether_setrewrite
            |
            *hp++ = htons(vtag_itpid(vtag));
            *hp++ = htons(vtag_ivid(vtag));

if_pfe_ttp_output
    |
    cookie = ifd->ifd_getrewrite #in_ether_getrewrite ???
    if_pfe_ttp_send_packet


#IGMP
xeth_mpc_get_bdidx
xeth_mpc_set_iflidx
    |
xeth_mpc_get_iflidx

mxge_pic_ifd_op_handler
    |
    ifd->ifd_getrewrite     = drv_ether_getrewrite;
    ifd->ifd_setrewrite = drv_mxge_setrewrite
        |
        xeth_mpc_set_iflidx
        xeth_mpc_set_bdidx

drv_eth_mpc_if_per_pkt_set_bd_index
    |
    xeth_mpc_set_bdidx
l2rw_get_pic_cookie
    |
    xeth_mpc_set_iflidx
    xeth_mpc_set_bdidx



arp_rtrequest
    |
    ARPL_SETREWRITE

arpintr __P
    |
    send_raw_arp_to_app
    in_arpinput
        |
        ARPL_SETREWRITE = in_ether_setrewrite
            |
            *hp++ = htons(vtag_itpid(vtag));
            *hp++ = htons(vtag_ivid(vtag));

ttp_tx_thread
    |
    ttp_tx_process
        |
        ttp_tx_output
            |
            network_output_handler
                |
                pfe_output_ifd
                    |
                    routing_chip_output_packet
                        |
                        expr_tx_vlan_tag_update
                            |
                            expr_pkt_apply_flex_vlan_cfg
                        expr_packet_print_raw

expr_pkt_apply_flex_vlan_cfg
    |

# L3 flexible-vlan-tagging

prds_if_l3_ifl_l2d_ht_get_key

expr_port_init_def
prds_if_l3_ifd_init
expr_port_remove_tag_support
expr_port_add_tag_support
pfe_ifl_family_lsiflag_changer
expr_port_ifl_attach
expr_port_ifd_attach
expr_if_map_ifd_idx_gport
drv_ether_send_vlan_data
drv_ether_update_iflconfig
    |
    ifd_setrewrite # drv_mxge_setrewrite
        |
        xeth_mpc_set_iflidx
        xeth_mpc_set_bdidx

jnh_packet_get_host_headers_bypass
    |
    xeth_mpc_get_iflidx
    xeth_mpc_get_bdidx
    jnh_hostif_ifl_get_queue
    xeth_mpc_get_no_vlan_rw
    packet_start += XETH_MPC_COOKIE_LEN;
    packet_len   -= XETH_MPC_COOKIE_LEN;
    l2pd_modify_outbound_vlan_tags
        |
        l2pd_modify_vlan_tags

jnh_packet_transmit
    |
    jnh_packet_get_host_headers_bypass

jnh_packet_inject_host
    |
    jnh_packet_get_host_headers_bypass

#TTP INPUT RX
expr_pkt_rx_slow_proc
    |
    expr_cosim_pkt_handler
        |
        expr_parse_rx_pkt
            |
            expr_pkt_get_iif
            expr_rx_pkt_apply_flex_vlan_cfg
        pfe_notif_input
            |
            network_ip_input
                |
                ttp_rx_input

cmqfx_fp_proxy_thread
    |
    expr_pkt_ttp_rx_proc
        |
        ttp_rx_q_handler
            |
            ttp_rx_output
                |
                pfebm_rx_vc_ipc_packet #FIXME
                ttp_debug

#TTP OUTPUT TX
ttp_tx_thread
    |
    ttp_tx_process
        |
        ttp_tx_output
            |
            network_output_handler\
                |
                pfe_output_ifd
                    |
                    routing_chip_output_packet
                        |
                        expr_packet_get_host_headers_bypass


expr_inline_ka_session_cfg_internal
    |
    expr_packet_get_host_headers_bypass



-- add path
nh_msg_handler
    |
    nh_add_helper
        |
        nh_ucast_add
            |
            nh_ucast_install
                |
                expr_nh_fwd_nh_install
                    |
                    expr_nh_fwd_create_egress_handles
                        |
                        expr_nh_fwd_create_all_descr
                            |
                            expr_nh_fwd_create_l2_descr
                                |
                                jprds_encap_desc_add
                            expr_nh_fwd_create_lvl1_tag_descr
                                |
                                jprds_encap_desc_add
                            expr_nh_fwd_create_flabel_descr
                                |
                                jprds_encap_desc_add

gencfg_specific_handler
    |
    cos_gencfg_handler_wrapper
        |
        cos_gencfg_bind_classifier
            |
            cos_gencfg_handle_action
                |
                cos_classifier_do_bind_add_action
                    |
                    expr_cos_halpv_classifier_bind
                        |
                        expr_cos_classifier_ifl_attach_ba
                            |
                            expr_l2_l3ifl_baidx_set
                                |
                                expr_if_l3_ifl_get_l2d_ht
                                expr_if_ifl_l2d_ht_val_change
-- remove path
#HOSTPATH
pfe_output_ifd
    |
    routing_chip_output_packet
        |
        expr_tx_l2_process_pkt
            |
            expr_bridge_token_route_lookup
            expr_get_vlan_tag
        expr_tx_vlan_tag_update
            |
            expr_pkt_has_vlan_tag #2874
            pfe_if_vlan_tag_hwtoken_map_get
            expr_add_vlan_tag
            expr_remove_vlan_tag

routing_chip_output_packet (3346)
expr_tx_l2_process_pkt (3224)
expr_bridge_token_route_lookup (2781)
expr_tx_l2_process_pkt (3242) ifd_output 647 ifl_input 546 bd_id 3 vlan_tag 100
expr_get_tx_ifd (2138)
routing_chip_output_packet (3354) ifd xe-0/0/2 vlan 100 bypass 1
routing_chip_output_packet (3365)
expr_get_tx_ifd (2138)
routing_chip_output_packet (3375)
expr_tx_vlan_tag_update (3015)
expr_tx_vlan_tag_update (3016) ifd xe-0/0/2 vlan 100
expr_tx_vlan_tag_update (3038)
routing_chip_output_packet (3346)
expr_tx_l2_process_pkt (3224)
expr_bridge_token_route_lookup (2781)
expr_tx_l2_process_pkt (3242) ifd_output 647 ifl_input 546 bd_id 3 vlan_tag 100
expr_get_tx_ifd (2138)
routing_chip_output_packet (3354) ifd xe-0/0/2 vlan 100 bypass 1
routing_chip_output_packet (3365)
expr_get_tx_ifd (2138)
routing_chip_output_packet (3375)
expr_tx_vlan_tag_update (3015)
expr_tx_vlan_tag_update (3016) ifd xe-0/0/2 vlan 100
expr_tx_vlan_tag_update (3038)


#TIX PROGRAMMING
jprds_encap_port_tix_install
    |
    jprds_encap_port_tix_find
    jprds_encap_port_tix_alloc
    jprds_encap_port_tix_set
    jprds_encap_port_tix_write

##### DCD CODE FOR AE IFD SPEED ###
parse_init_ifd_default_table
    |
    parse_default_ifd_specific

dcd_parse_interface_obj
    |
    post_attr_parsing = dcd_config_read_interfaces_ether_802_3ad
        |
        get_pic_speed_from_ifd
    dcd_post_attr_parsing

dcd_process_unit
    |
    dcd_config_read_interfaces_ifl
        |
        dcd_config_read_interfaces_single_ifl
            |
            dcd_parse_partial_interface_obj
                |
                post_attr_parsing = dcd_config_read_interfaces_ether_802_3ad
                    |
                    get_pic_speed_from_ifd
dcd_dax_ifl_config_walk
    |
    dcd_ifl_config_read
        |
        dcd_handle_ifl_change
            |
            dcd_config_read_interfaces_single_ifl
                |
                dcd_parse_partial_interface_obj
                    |
                    post_attr_parsing = dcd_config_read_interfaces_ether_802_3ad
                        |
                        get_pic_speed_from_ifd


dcd_config_read_interfaces_ether_802_3ad
    |
    get_pic_speed_from_ifd

####
ch_tvp_init
    |
    ch_tvp_lacp_init

ch_tvp_chassis_init
    |
    ch_tvp_lacp_init

ch_tvp_lacp_sysid_reconfig_check
    |
    ch_tvp_lacp_init

ch_tvp_chassis_sno_macaddr_init
    |
    ch_tvp_lacp_init

ch_tvp_reconnect_expired
    |
    ch_tvp_lacp_init

ch_tvp_mcontrol_ipc_handler
    |
    ch_tvp_lacp_init

ch_tvp_init
    |
   ch_stp_init
ch_tvp_chassis_init
    |
    ch_stp_init
ch_tvp_lacp_sysid_reconfig_check
    |
    ch_stp_init
ch_tvp_vlan_mac_addr_sdl
    |
    ch_stp_init
#############
rt_msg_handler
    |
    rt_entry_delete_msg_proc
        |
        l2alm_rt_mac_delete
            |
            l2alm_process_mac
                |
                l2alm_mac_process_update_hardware_info
                    |
                    l2alm_update_hardware_info_for_re
                        |
                        l2alm_sync_entry_in_pfes
                            |
                            l2alm_hal_delete_from_hardware
                                |
                                l2alm_delete_sa_mac_table_entry
                                    |
                                    l2alm_expr_delete_mac_entry
                                        |
                                        expr_l2_fdb_mac_delete
                                            |
                                            expr_l2_sa_entry_delete
                                                |

rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        l2alm_process_mac
            |
            l2alm_mac_process_update_hardware_info
                |
                l2alm_update_hardware_info_for_re
                    |
                    l2alm_sync_hw_info_for_re
                        |
                        l2alm_sync_entry_in_pfes
                            |
                            l2alm_sync_static_entries_in_channel
                                |
                                l2alm_add_sa_mac_table_entry
                                    |
                                    l2alm_expr_add_mac_entry
                                        |
                                        l2alm_expr_add_mac_entry
                                            |
                                            expr_l2_fdb_mac_add
                                                |
                                                expr_l2_sa_entry_set

###########################################
pechip_igp_eth_ptpg_params_set
    |
    PE_IGP_MAIN_ETH_PTGT_PARAMS_GPORTID_SET

pechip_igp_port_gpid_set
    |
    PE_IGP_MAIN_ETH_PTGT_PARAMS_GPORTID_SET

pechip_igp_dflt_gport_set
    |
    PE_IGP_MAIN_ETH_PTGT_PARAMS_GPORTID_SET

#EDF UPDATE
nh_ucast_install
    |
    expr_nh_fwd_nh_install
        |
        expr_nh_fwd_create_egress_handles
            |
            expr_nh_fwd_update_ifbd_descr
                |
                expr_l2_ifbd_walk
                    |
                    expr_l2_ifbd_nh_add
                        |
                        expr_nh_fwd_create_ifbd_descr
                            |
                            expr_nh_egress_ifbd_create_params
                                |
                                prds_encap_egress_add_vlan_sel
                                    |
                                    expr_if_ifl_vtags_get
                                        |
                                        pfe_ether_ifl_vtags_get
                                    #set vlan_sel_app,
                                    prds_if_vlan_rw_op_idx_get
                            expr_nh_ifbd_token_to_flabel
                            jprds_encap_desc_add #jencap_vec.desc_add
                                |
                                jprds_egress_desc_prepare
                                    |
                                    jprds_egress_encaps_install
                                    jprds_encap_vlan_sel_get_app_idx
                                    jprds_edf_encode_dfv_vlan
                                    jprds_encap_vlan_sel_get_app_idx
                                jprds_encap_add_tags
                                jprds_add_p_next_dft
                                jprds_encap_handle_alloc
                                jprds_edf_flabel_chain_install
                                jprds_encap_desc_init
                                jprds_add_p_next_dft
                                jprds_encap_desc_l2dtbl_bind
                                jprds_edf_flabel_chain_install
                                jprds_encap_desc_init

expr_l2_common_bd_ifbd_attach
    |
    expr_l2_ifbd_lport_vid_add
        |
        expr_l2_l2d_ht_insert
            |
            jprds_if_l2d_ht_insert_multiple
                |
                jprds_chash_add
                    |
                    jprds_chash_lookup
                    jprds_chash_tbl_add
                        |
                        jprds_chash_tbl_add_entry
                        jprds_chash_tbl_move #if add fails
                    jprds_chash_list_merge(jprds_chash_result_list, &jprds_chash_temp_list);
                    jprds_chash_list_delete(&jprds_chash_temp_list);
                jprds_chash_process_result
                    |
                    jprds_if_l2d_ht_chg_commit
                        |
                        jprds_vmem_l2d_ht_idx_mv_precommit
                        jprds_if_l2d_ht_entry_get_entry
                        jprds_encap_desc_update_l2d_ht_entry
                            |
                            jprds_desc_update_hash_index
                                |
                                jprds_encap_update_desc_df_inplace
                                    |
                                    jprds_edf_desc_read
                        pechip_hash_tbl_write
                        jprds_vmem_l2d_ht_idx_mv_postcommit
                            |
                            jprds_bnd_chk_tbl_entry_vlan_mem_mv

#JCHASH CODE
jprds_if_l2d_ht_insert_multiple
    |
    jprds_chash_add
        |
        jprds_chash_lookup
        jprds_chash_tbl_add
            |
            jprds_chash_tbl_add_entry
            jprds_chash_tbl_move #if add is fail
        jprds_chash_list_merge(jprds_chash_result_list, &jprds_chash_temp_list);
        jprds_chash_list_delete(&jprds_chash_temp_list);
    jprds_chash_process_result
#### VMEM  TABLE UPDATE ###

jprds_if_l2d_ht_insert_by_index
    |
    jprds_chash_process_result
        |
        jprds_if_l2d_ht_chg_commit

jprds_if_l2d_ht_remove_multiple
    |
    jprds_chash_process_result
        |
        jprds_if_l2d_ht_chg_commit

jprds_if_l2d_ht_insert_multiple
    |
    jprds_chash_process_result
        |
        jprds_if_l2d_ht_chg_commit

jprds_if_l2d_ht_val_change
    |
    jprds_if_l2d_ht_chg_commit
        |
        jprds_l3bnd_l2d_ht_idx_mv_precommit
        jprds_if_l2d_ht_entry_get_entry
        jprds_encap_desc_update_l2d_ht_entry
        jprds_l3bnd_l2d_ht_idx_mv_postcommit

#############
jprds_edf_flabel_install
    |
    jprds_edf_seg_get
    jprds_edf_pgtbl_alloc
    jprds_edf_flabel_init_stage_2
        |
        jprds_edf_update_validity_and_ref_count
    jprds_edf_flabel_refcount_update

jprds_edf_flabel_install
    |
    jprds_edf_flabel_init_stage_2
        |
        jprds_edf_update_validity_and_ref_count

jprds_edf_flabel_init_stage_2
    |
    jprds_edf_flabel_uninstall
        |
        jprds_edf_update_validity_and_ref_count
jprds_encap_desc_del_internal
    |
    jprds_edf_flabel_uninstall
        |
        jprds_edf_update_validity_and_ref_count


##### L2D DEBUG ###
expr_port_family_change
    |
    expr_port_l2_ifl_init
        |
        expr_if_l2_ifl_add_lport_helper
            |
            jprds_if_lport_for_ifd_alloc
            jprds_if_port_dflt_lport_set
            #JPRDS_IF_LPORT_FLAGS_CAN_SHARE_VLAN_CTXT

expr_l2_ifbd_lport_vid_add
    |
    expr_if_l2_ifl_add_lport
        |
        expr_if_l2_ifl_add_lport_helper
            |
            jprds_if_lport_for_ifd_alloc
            jprds_if_port_dflt_lport_set
            #JPRDS_IF_LPORT_FLAGS_CAN_SHARE_VLAN_CTXT


#L2DHT & JENCAP PROGRAMMING
jprds_encap_update_desc_df_inplace
    |
    jprds_edf_desc_read
    jprds_desc_find_dft_value_offset
    jprds_desc_dft_value_update
    jprds_encap_decode_desc_word
    jprds_edf_chip_desc_mem_read
jprds_encap_desc_update_l2d_ht_entry
    |
    case JPRDS_IF_L2D_HT_MOVE:
    case JPRDS_IF_L2D_HT_DEL:
    jprds_desc_update_hash_index
        |
        jprds_encap_update_desc_df_inplace
    jprds_encap_update_desc_bind
    case JPRDS_IF_L2D_HT_ADD:
    jprds_encap_update_desc_df_inplace
    jprds_if_l2d_ht_entry_bind
    jprds_if_l2d_ht_entry_unbind

jprds_if_l2d_ht_val_change
    |
    jprds_if_l2d_ht_chg_commit
        |
        jprds_encap_desc_update_l2d_ht_entry

expr_l2_ifbd_hw_init
    |
    jprds_if_l2d_reserve_invalid_ent
        |
        jprds_if_l2d_ht_insert_by_index
            |
            jprds_if_l2d_ht_chg_commit

expr_l2_common_bd_ifbd_detach
    |
    expr_l2_ifbd_lport_vid_del
        |
        jprds_if_l2d_ht_remove
            |
            jprds_if_l2d_ht_remove_multiple
                |
                jprds_if_l2d_ht_chg_commit
                    |
                    jprds_encap_desc_update_l2d_ht_entry

expr_l2_common_bd_ifbd_attach
    |
    expr_l2_ifbd_lport_vid_add
        |
        jprds_if_l2d_ht_insert
            |
            jprds_if_l2d_ht_insert_multiple
                |
                jprds_if_l2d_ht_chg_commit
                    |
                    jprds_encap_desc_update_l2d_ht_entry
        expr_l2_ifbd_ifl_all_ifbd_hw_add
            |
            jprds_if_l2d_ht_insert_multiple
                |
                jprds_if_l2d_ht_chg_commit
                    |
                    jprds_encap_desc_update_l2d_ht_entry
            jprds_if_l2d_ht_mv_list_update_dep
                |
                jprds_encap_desc_update_l2d_ht_entry

#COS REEWRITE
rts_current_build
    |
    rts_current_build_ifd
        |
        rts_build_ether_params

dcd_config_read_interfaces_ether_switch_profile
    |
    read_tag_protocol_ids
        |
        parse_set_tpid_data

pfeman_rt_msg_handler
    |
    pfeman_session_manager
        |
        gencfg_msg_gen_handler
            |
            gencfg_specific_handler
                |
                cos_gencfg_handler_wrapper
                    |
                    cos_gencfg_bind_rewrite_table
                        |
                        cos_gencfg_handle_action
                            |
                            cos_rewrite_do_bind_add_action
                                |
                                halp_rewrite_bind
                                    |
                                    expr_cos_halpv_rewrite_bind
                                        |
                                        expr_nh_iff_update_cos
                                            |
                                            topo_action
                                                |
                                                nh_topo_handler
                                                    |
                                                    topo_action_walk
                                                    |   |
                                                    |   topo_action
                                                    |       |
                                                    |       nh_topo_handler
                                                    |           |
                                                    |           nh_unilist_change_platform
                                                    |               |
                                                    |               expr_nh_unilist_install
                                                    |                   |
                                                    |                   expr_nh_agg_install
                                                    |                       |
                                                    |                       expr_nh_agg_ingress_install
                                                    |                       |   |
                                                    |                       |   expr_nh_ifbd_agg_ingress_update
                                                    |                       |       |
                                                    |                       |       iff_ifbd_walk
                                                    |                       |           |
                                                    |                       |           expr_l2_agg_ifbd_walk
                                                    |                       |               |
                                                    |                       |               expr_l2_agg_ingress_nh_install
                                                    |                       |                   |
                                                    |                       |                   expr_l2_ifbd_nh_add_agg
                                                    |                       |                       |
                                                    |                       |                       expr_ifbd_agg_nh_create
                                                    |                       expr_nh_agg_egress_install #egress disabled for L2
                                                    |                           |
                                                    |                           expr_nh_fwd_create_egress_handles
                                                    |                           expr_nh_fwd_free_egress_handles #free the old why??
                                                    |                               |
                                                    |                               expr_nh_fwd_update_ifbd_descr
                                                    |                                   |
                                                    |                                   iff_ifbd_walk
                                                    |                                       |
                                                    |                                       expr_l2_ifbd_walk
                                                    |                                           |
                                                    |                                           expr_l2_ifbd_nh_add #EGRESS NH
                                                    nh_ucast_change_platform
                                                        |
                                                        expr_nh_reinit_l2params
                                                        nh_ucast_install
                                                            |
                                                            expr_nh_fwd_nh_install
                                                                |
                                                                expr_nh_ucast_install #disabled for AE child's
                                                                    |
                                                                    expr_nh_ucast_create_ingress_handles
                                                                        |
                                                                        expr_nh_fwd_update_ifbd_descr
                                                                    expr_nh_fwd_create_egress_handles
                                                                        |
                                                                        expr_nh_fwd_update_ifbd_descr
                                                                            |
                                                                            iff_ifbd_walk
                                                                                |
                                                                                expr_l2_ifbd_walk
                                                                                    |
                                                                                    expr_l2_ifbd_nh_add #EGRESS NH

nh_ucast_change
    |
    nh_ucast_change_major
        |
    nh_ucast_initialize
    nh_ucast_change_platform

nh_msg_handler
    |
    nh_add_helper
        |
        nh_ucast_initialize

nh_ucast_params_initialize

nh_composite_change_platform
    |
    nh_composite_topo_child_change

expr_l2_config_ifd_tpid_set
    |
    expr_l2_update_ifbd_egr_desc #Update Egress Desc
        |
        expr_l2_ifbd_walk
expr_nh_gre_entry_reinstall_one
    |
    expr_nh_fwd_create_egress_handles
        |
        expr_nh_fwd_update_ifbd_descr #updae EGRESS
            |
            expr_l2_ifbd_walk
expr_nh_agg_egress_install
    |
    expr_nh_fwd_create_egress_handles
        |
        expr_nh_fwd_update_ifbd_descr #update EGRESS
            |
            expr_l2_ifbd_walk
expr_nh_ucast_install
    |
    expr_nh_ucast_create_ingress_handles
        |
        expr_nh_fwd_update_ifbd_descr #Add Ingress JNH
            |
            expr_l2_ifbd_walk
    expr_nh_fwd_create_egress_handles
        |
        expr_nh_fwd_update_ifbd_descr #update EGRESS
            |
            expr_l2_ifbd_walk

expr_l2_ifbd_walk
    |
    expr_l2_change_vlan_xlat
        |
        expr_l2_ifbd_nh_add(Update Egress Desc)
    expr_l2_add_vlan_xlat
        |
        expr_l2_ifbd_nh_add (Add JNH Handle)



#OTHERS

#########################################
prds_if_ifd_tpid_add
    |
    pechip_igp_ai_etype_rule_set
    pechip_egp_ai_etype_rule_set

expr_if_lb_ifd_init
    |
    pechip_igp_ai_etype_rule_set

jprds_if_ai_install_rule
    |
    pechip_igp_ai_etype_rule_set

jprds_if_ai_test_and_install_rule
    |
    pechip_igp_ai_etype_rule_set

jprds_if_ai_etypes_set
    |
    pechip_igp_ai_etype_rule_set



show shim jfdb ht by_hash_idx 1 0 9283251

jprds_fdb_action_data_get

jprds_fdb_debug_command
    |
    jprds_fdb_ht_by_inst_show
        |
        jprds_chash_full_walk
            |
            jprds_fdb_ht_show_walk_edb0_cb
                |
                jprds_fdb_ht_ent_by_inst_show
                    |
                    jprds_fdb_chash_get_hash_idx
                        |
                        prds_ifvlan_get_fdb_ent_key

prds_ifvlan_add_fdb
    |
    prds_if_vlan_get_fdb_ent_key
        |
        prds_ifvlan_get_fdb_ent_key

prds_ifvlan_del_fdb
    |
    prds_if_vlan_get_fdb_ent_key
        |
        prds_ifvlan_get_fdb_ent_key































expr_if_pf_vec->ifcp_add_fdb = prds_ifcp_add_fdb;
expr_if_pf_vec->ifcp_change_fdb = prds_ifcp_change_fdb;
expr_if_pf_vec->ifd_channel_add        = prds_if_ifd_channel_add;

#####################################################################
pfe_bcm_l2_ing_vlanid_list_xlat_set

pfe_bcm_l2_sp_ing_vlan_xlat_unset

expr_l2_sp_bd_ifbd_attach
    |
    expr_l2_ing_vlanid_list_xlat_set



#ADD FDB ENTRY
expr_if_ifd_channel_add
    |
    prds_if_ifd_channel_add
        |
        expr_add_ifl_ifcp_table
            |
            prds_ifcp_add_fdb

prds_ifcp_init
    |

#######################################################################
#Flabel allocation in Kernel
mt_product_prop_init #platform.c
    |
    jpf->net->jpfnet_token_init    = sng_jpf_token_init;

ether_ifattach_junos
    |
    ifd->ifd_iffconfig = ether_iffconfig;

iff_request
    |
    ether_iffconfig #    ifd->ifd_iffconfig = ether_iffconfig;
        |
        case AF_VPLS:
        vpls_ether_iffconfig
            |
            iff_attach
            vpls_iff_aux_add_common_data
                |
                vpls_iff_aux_ifbd_attach
                    |
                    vpls_iff_aux_ifbd_create
                        |
                        ifbd_create_node
                            |
                            jpf_ifbd_token_alloc #ifbd->ifbd_hw_token

rts_ifbdmproc
    |
    vpls_ifbd_config
        |
        ifbd_create_node
            |
            jpf_ifbd_token_alloc #ifbd->ifbd_hw_token
    rts_ifbdmput
        |
        ifbdm->ifbdm_hw_token = ifbd->ifbd_hw_token;
        RTS_APPEND_MSG(mpp, m);

ifbd_pfe_update #IFSTATE_IFBD
    |
    //peer_send Send BD_IPC_MSG_IFBD_OBJECT


pdk.h
#define jpf_ifbd_token_alloc net->jpfnet_ifbd_token_alloc
#define jpf_token_init                  net->jpfnet_token_init

dcf_common_product_prop_init
    |
    PLATF_SET(net, jpfnet_token_init, prds_jpf_nh_token_init);
    PLATF_SET(net, jpfnet_ifbd_token_alloc, prds_jpf_ifbd_token_alloc);

prds_jpf_nh_token_init
    |
    prds_nh_token_alloc
        |
        prds_token_alloc
prds_jpf_ifbd_token_alloc
    |
    prds_ifbd_token_alloc
        |
        prds_token_alloc
prds_jpf_nh_token_change
    |
    prds_token_alloc
prds_derived_token_alloc
    |
    prds_token_alloc
#########################################################
#VLAN Trnaslation (L2DOMAIN CONFIG TABLE IRW)
prds_if_ifl_pechip_irw_setup (CR)
prds_if_packet_init (CR)

expr_l2_stg_port_stg_update_by_bd
    |
    expr_l2_stg_port_stp_tbl_n_l2d_cfg_update
        |
        expr_l2_bd_l2d_cfg_update
            |
            expr_bd_l2d_cfg_set
                |
                pechip_irw_l2domain_cfg_set

bd_platform_irb_ifl_attach_detach
    |
    expr_l2_bd_irb_attach_detach
        |
        expr_vlan_bdvlan_irb_associate
            |
            expr_vlan_interface_set
                |
                expr_l2_common_bd_hw_program (first time)
                    |
                    expr_bd_l2d_cfg_set
                        |
                        pechip_irw_l2domain_cfg_set

                expr_l2_bd_l2d_cfg_update (update)
                    |
                    expr_bd_l2d_cfg_set
                        |
                        pechip_irw_l2domain_cfg_set

bd_platform_setup
    |
    expr_l2_bd_add
        |
        expr_l2_sp_bd_hw_program
        expr_l2_ep_bd_hw_program
            |
            expr_l2_common_bd_hw_program
                |
                expr_bd_l2d_cfg_set
                    |
                    pechip_irw_l2domain_cfg_set

cmfxpc_asic_init
    |
    expr_if_lcpu_port_init
        |
        expr_if_init_hostbound_interface
            |
            pechip_irw_l2domain_cfg_set

expr_port_family_change
    case IF_IRB:
    expr_vlan_interface_set
        |
        expr_l2_common_bd_hw_program (first time)
            |
            expr_bd_l2d_cfg_set
                |
                pechip_irw_l2domain_cfg_set

        expr_l2_bd_l2d_cfg_update (update)
            |
            expr_bd_l2d_cfg_set
                |
                pechip_irw_l2domain_cfg_set
    case PROTO_L2_BRIDGE:
    expr_port_l2_ifl_init
        |

    case PROTO_IPV4:
    expr_port_l3_ifl_init
        |
        prds_if_l3_ifl_entry_set (first time)
        |   |
        |   prds_if_l3_ifl_l2d_cfg_set
        |       |
        |       pechip_irw_l2domain_cfg_set
        |
        |
        expr_if_l3_ifl_l2d_cfg_update (update)
            |
            prds_if_l3_ifl_l2d_cfg_set
                |
                pechip_irw_l2domain_cfg_set

expr_port_ifd_attach
    |
    prds_port_epr_setup
        |
        pechip_egp_transmit_port_set
            |


expr_l2_common_bd_ifbd_attach
    |
    expr_l2_ifbd_lport_vid_add
        |
        expr_l2_ifbd_ifl_all_ifbd_hw_add
            |
            iff_ifbd_walk
                |
                expr_l2_ifbd_ifl_ifbd_list_add
        jprds_if_lport_ifl_vctxt_alloc
        jprds_if_l2d_ht_insert
            |
            jprds_if_l2d_ht_insert_multiple
                |
                jprds_if_l2d_ht_hash_fn
                    |
                    expr_l2_ifbd_l2d_ht_get_key
                    jprds_hash_l2d_hash_func
                        |
                        jprds_hash_l2d_key_pack
                            |
                            //key=ovlan & ivlan
                        jprds_pe_hash
                            |

                jprds_if_l2d_ht_hash_fn
                    |
                    expr_l2_ifbd_l2d_ht_get_key
                    jprds_hash_l2d_hash_func
                        |
                        jprds_hash_l2d_key_pack
                        jprds_pe_hash
                            |
                jprds_chash_add
                jprds_chash_process_result
                    |
                    jprds_if_l2d_ht_chg_commit
                        |
                        expr_l2_ifbd_l2d_ht_get_key
                jprds_chash_release_result


#FLABEL
ifbd_pfe_update #IFSTATE_IFBD
    |
    msg->ifbdm_hw_token = ifbd->ifbd_hw_token;

ifbd_create_if_msg
    |
    ifbd->ifbd_hw_token = msg->ifbdm_hw_token;
    expr_l2_common_bd_ifbd_attach
        |
        ifbd->ifbd_hw_token
#L2D Bridge Domain
jprds_if_l2d_id_alloc

prds_if_ifl_l2d_free #expr_if_pf_vec->ifl_l2d_free
    |
    jprds_if_l2d_id_free

prds_if_l3_ifl_entry_unset
    |
    jprds_if_l2d_id_free

################ VLAN CTXT ##############

jprds_if_lport_ifd_vctxt_free
    |
    jprds_if_lport_vctxt_free

jprds_if_lport_ifl_vctxt_free
    |
    jprds_if_lport_vctxt_free


expr_port_uninit
    |
    expr_port_ifd_detach
        |
        prds_ifd_lport_free
            |
            jprds_if_lport_ifd_vctxt_free
                |
                jprds_if_lport_vctxt_free

ifbd_delete_msg
    |
    expr_l2_common_bd_ifbd_detach
        |
        expr_l2_ifbd_lport_vid_del
            |
            expr_l2_ifbd_vctxt_free_contemplate
                |
                jprds_if_lport_vctxt_free #child of ae xe-0/0/3

expr_l2_common_bd_ifbd_detach
    |
    expr_l2_ifbd_lport_vid_del
        |
        expr_l2_ifbd_vctxt_free_contemplate
            |
            jprds_if_lport_ifd_vctxt_free
                |
                jprds_if_lport_vctxt_free
expr_l2_ifbd_lport_vid_add
    |
    jprds_if_lport_ifd_vctxt_free
        |
        jprds_if_lport_vctxt_free
expr_l2_ifbd_lport_vid_add
    |
    jprds_if_lport_ifd_vctxt_free
        |
        jprds_if_lport_vctxt_free

#-- ADD --
expr_port_l3_ifl_init
    |
    jprds_if_l2d_ht_insert

prds_if_l3_ifd_init
    |
    jprds_if_lport_ifd_vctxt_alloc
        |
        jprds_if_lport_vctxt_assign

expr_l2_common_bd_ifbd_attach
    |
    expr_l2_ifbd_lport_vid_add
        |
        jprds_if_l2d_ht_insert
        jprds_if_lport_ifl_vctxt_alloc2
            |
            jprds_if_lport_vctxt_assign
        jprds_if_l2d_ht_insert

#-- REMOVE --
prds_if_l3_ifd_uninit
    |
    prds_if_l3_ifd_vctxt_free
expr_l2_ifbd_lport_vid_del
    |
    expr_l2_ifbd_vctxt_free_contemplate

expr_port_ifd_detach
    |
    prds_ifd_lport_free
#prds_if_l3_ifd_lport_free

expr_l2_ifbd_lport_vid_add
expr_l2_ifbd_lport_vid_add
    |
    jprds_if_lport_ifd_vctxt_free

expr_port_l3_ifl_uninit
    |
    jprds_if_l2d_ht_remove
        |
    prds_if_l3_ifd_uninit
        |
        jprds_if_lport_ifd_vctxt_free
            |
            jprds_if_lport_vctxt_free

expr_l2_common_bd_ifbd_detach
    |
    expr_l2_ifbd_lport_vid_del
        |
        jprds_if_l2d_ht_remove
        expr_l2_ifbd_vctxt_free_contemplate
            |
            jprds_if_lport_ifd_vctxt_free
                |
                jprds_if_lport_vctxt_free
#############################################################

expr_l2_ifbd_vctxt_free_contemplate
    |
    jprds_if_lport_ifl_vctxt_free
        |
        jprds_if_lport_vctxt_free


expr_port_lport_init
    |
    jprds_if_lport_ifd_vctxt_alloc
        |
        jprds_if_lport_vctxt_assign

expr_l2_common_bd_ifbd_attach
    |
    expr_l2_ifbd_lport_vid_add
        |
        expr_if_l2_ifl_add_lport
            |
            expr_if_l2_ifl_add_lport_helper
                |
                jprds_if_lport_for_ifd_alloc
        jprds_if_lport_ifd_vctxt_alloc
            |
            jprds_if_lport_vctxt_assign

#-----------------------------------------------------------------
expr_l2_sp_bd_ifbd_attach
expr_l2_ifl_maddr_config
    |
    expr_l2_sp_nni_update_ifbd_desc
        |
        expr_l2_update_ifbd_desc
            |
            expr_l2_update_ifbd_walk
                |


expr_nh_ucast_install
    |
    expr_nh_fwd_update_ifbd_descr
        |
        expr_nh_ucast_create_ingress_handles
        expr_nh_fwd_create_egress_handles
            |
            expr_l2_ifbd_walk

expr_l2_config_ifd_tpid_set
    |
    expr_l2_update_ifbd_egr_desc
        |
        expr_l2_ifbd_walk

#Pending APIs
pfe_bcm_vlan_translate_ingress_cntr_get (mukul)
pfe_bcm_vlan_translate_egress_cntr_get
pfe_bcm_l2_sp_ifl_cntr_get
pfe_bcm_l2_egr_xlat_entry_prepare (not used anywhere)

pfe_bcm_l2_bd_get_nni_l2ifl
pfe_bcm_l2_bd_get_uni_l2ifl


#CODE FLOW ELIT
expr_l2_bd_add
    |
    expr_l2_bd_entry_set
        |
        jprds_if_l2d_cfg_alloc
        jprds_if_l2d_id_alloc
        jprds_if_l2d_cfg_id_set
        jprds_if_l2d_gl2d_map
        expr_bd_l2d_cfg_set
        expr_bd_l2d_attr_set


#CODE FLOW OPUS/MOJITO
brcm_l2_module_init
    |
    brcm_brg_init
    brcm_vlan_init
    brcm_l2if_module_init
    l2_evt_port_classid_init = pfe_bcm_l2_evt_port_classid_init
    l2_cntr_module_init = pfe_bcm_cntr_module_init //used on opus/not used in mojito
pfe_bcm_l2_module_init
    |
    pfe_bcm_l2_evt_port_classid_init
        |
        pfe_bcm_l2_evt_port_classid_ifd_bmp_init
        pfe_bcm_l2_evt_vlan_xlat_itable_init

bridge_domain_t {
    expr_l2_bd_entry_t bd_halp_user_data pl2_bd {
        u_int32_t               pl2bd_flags
        jprds_if_l2d_cfg_t      pl2bd_jif_l2d_cfg[dev_num] {
           void                   *app_data; //bd
           jl2domainid_t           jifl2d_hw_idx[dev_num]; <== local l2d_id
           jprds_if_l2d_cfg_      *stp_tbl_user_next
        }
    }
}
gl2domain_id = vlan_hw_token = bd->bd_vlan_token
# dev_num global itables for gl2id
 l2d_id_gl2d_id_map[dev_num] <= global gl2d_id
# need to understand l2d bitmap alloc jprds_if_l2d_id_alloc
#
#######################################################
#########################################################
# ELIT FDB DLU ################################################################################################
#DELETE ROUTE
rt_msg_handler
    |
    rt_entry_delete_msg_proc
        |
        l2alm_rt_mac_delete
            |
            l2alm_process_mac
                |
                l2alm_mac_process_update_hardware_info
                    |
                    l3alm_sync_entry_in_pfes
                        |
                        l2alm_hal_delete_from_hardware
                            |
                            l2alm_expr_delete_mac_entry
                                |
                                expr_l2_fdb_mac_delete
                                    |
                                    expr_l2_sa_entry_delete
                                        |
                                        jprds_slu_sal_delete
                                            |
                                            jprds_chash_delete_by_index
                                                |
                                                jprds_chash_tbl_delete
                                    expr_l2_fdb_update_helper
                                        |
                                        jprds_fdb_ht_ent_del
                                            |
                                            jprds_chash_delete
                                                |
                                                jprds_chash_lookup
                                                jprds_chash_stash_delete
                                                jprds_chash_app_del_callback #jprds_chash->app_del_callback
                                                jprds_chash_tbl_delete (called)
                                                jprds_chash_app_del_callback #jprds_chash->app_del_callback (called)
                                                    |
                                                    jprds_dlu_alpha_bft_delete
                                                        |
                                                        jprds_dlu_alpha_bft_do_op #jprds_dlu_alpha_bft.c
                                            jprds_chash_process_result
                                            jprds_chash_release_result
#CHANGE ROUTE
rt_msg_handler
    |
    rt_entry_change_msg_proc
        |
        l2alm_rt_mac_change
            |
            l2alm_process_mac
                |
                l2alm_mac_process_update_hardware_info
                    |
                    l2alm_sync_hw_info_for_re
                        |
                        l2alm_sync_entry_in_pfes
                            |
                            l2alm_sync_static_entries_in_channel
                                |
                                l2alm_expr_add_mac_entry
                                    |
                                    expr_l2_fdb_mac_add
                                        |
                                        expr_l2_mac_tree_node_alloc
                                        expr_fdb_mac_entry_set
                                            |
                                            expr_l2_fdb_update_helper
                                                |
                                                jprds_fdb_ht_ent_add
                                                    |
rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        expr_rt_create
            |
            prds_rt_update_layer2
                |
                expr_update_route_bd
                    |
                    jprds_fdb_ht_ent_add
                        |
                        jprds_chash_process_result
                            |
                            jprds_fdb_chash_proc_res
                                |
                                jprds_fdb_common_chash_proc_res
                                    |
                                    jprds_fdb_htent_pack
                                        |
                                        jprds_fdb_action_data_get
                                            |
                                            expr_nh_embed_nh_build
                                                |
                                                expr_nh_ingress_get_ifbd_handle
                                                    |
                                                    expr_l2_ifbd_get_jnh_handle


rt_msg_handler
    |
    rt_entry_delete_msg_proc
        |
        expr_rt_delete
            |
            prds_rt_update_layer2
                |
                expr_update_route_bd
                    |
                    jprds_fdb_ht_ent_del
                        |
                        jprds_chash_delete
                            |
                            jprds_chash_app_del_callback
                        jprds_chash_process_result
                            |
                            jprds_fdb_chash_proc_res
#ADD ROUTE
rt_msg_handler
    |
    rt_entry_add_msg_proc
        |
        l2alm_rt_mac_add
            |
            l2alm_process_mac
                |
                l2alm_mac_process_update_hardware_info
                    |
                    l2alm_sync_hw_info_for_re
                        |
                        l2alm_sync_entry_in_pfes
                            |
                            l2alm_sync_static_entries_in_channel
                                |
                                l2alm_expr_add_mac_entry
                                    |
                                    expr_l3_fdb_mac_add
                                        |
                                        expr_fdb_mac_entry_set
                                            |
                                            expr_l2_fdb_update_helper
                                                |
                                                jprds_fdb_ht_ent_add
                                                    |
                                                    jprds_chash_add
                                                        |
                                                        jprds_chash_lookup
                                                        jprds_chash_tbl_add
                                                        jprds_chash_stash_add
                                                        jprds_chash_stash_repl
                                                        jprds_chash_update_entry_stats
                                                    jprds_chash_process_result
                                                    jprds_chash_release_result

#######################################################################################

jprds_if_tag_pattern_add (dev_num=0, port_num=119, pattern=0xc476b00)
|
jprds_if_ai_install_rule (chip_num=0, port_id=119, ai_rule_index=2688, ai_tgt_rule=0xc476930, num_tags=1 '\001', tmp_ecrs=0xc476788)


jprds_if_tag_pattern_add (dev_num=0, port_num=1, pattern=0xdb5b948)
|
jprds_if_ai_install_rule (chip_num=0, port_id=1, ai_rule_index=2640, ai_tgt_rule=0xdb5b7b0, num_tags=2 '\002', tmp_ecrs=0xdb5b608)


ethertypeCategory:2 = AMBIGUOUS_ETHERTYPE
portClass:3         =
ethertypeClass:2    =

AmbiguousEthertypeRuleset => 16bit token from current header x 2 = priority:4, vlanid:12
ambiguousParserTargetRulesetOffset:11(2tag=7bit) = portClass:3,ethertypeClass[0]:2, ethertypeClass[1]:2 = 7bit
ambiguousParserTargetRulesetOffset:7,ambiguousHeaderCount:3(=2)

jprds_if_ing_egr_pattern_t
    |
    jprds_if_tag_pattern_t ing_tag_pattern;
    jprds_if_tag_pattern_t egr_tag_pattern;
        |
        jprds_if_tag_t          tags[JBWY_TL_IGP_MAX_ETYPE_STACK];
            |
            l2l_ai_type             ai_type;    /* Tag type */
            u_int16_t               etype;      /* Ethertype */
            pe_parser_target_type   ptgt;       /* Target type could differ */
            boolean                 consume;    /* 1 to consume tag on egress */
            u_int8_t                etype_idx;  /* Etype index in CAM */
            u_int8_t                size;       /* Tag size */
        u_int8_t                num_tags;
        boolean                 stop_parsing;
        u_int8_t                trapcode;
        jprds_if_tags_type_t    type;

jprds_aipr_rule_t
    |
    pechip_igp_ai_ptgt_rule_t
        |
        boolean                         stop;
        u_int8_t                        trapcode;
        u_int16_t                       mask3;
        pe_parser_target_type           ptgt3;
        l2l_ai_type                     type3;
        u_int16_t                       mask2;
        pe_parser_target_type           ptgt2;
        l2l_ai_type                     type2;
        u_int16_t                       mask1;
        pe_parser_target_type           ptgt1;
        l2l_ai_type                     type1;
        u_int16_t                       mask0;
        pe_parser_target_type           ptgt0;
        l2l_ai_type                     type0;
    u_int32_t                       port_bmap[4]
    u_int32_t                       ref_count;

jprds_ai_etype_entry_t
    |
    pe_parser_target_type   ptgt;
    l2l_ai_type             ai_type;
    u_int16_t               etype;
    u_int16_t               mask;  /* Mask used for key, i.e. 0x0FFF for VLAN */
    boolean                 consume;
    u_int8_t                index; /* Internal use only */
    u_int8_t                cls;   /* class, internal use only */

jprds_ai_ecr_entry_t
    u_int16_t           etype;
    u_int8_t            portmap;
    u_int8_t            classes;
    jprds_ai_rule_dep_t ai_tag_rules_dep[JPRDS_IF_MAX_AI_RULES_PER_TAG=25];
        |
        u_int16_t           index;
        u_int8_t            pos;
    u_int8_t            cnt;




typedef enum {
    JPRDS_IF_RSVD_TAGS_TYPE     = 0,
    JPRDS_IF_UN_TAGS_TYPE       = 1,
    JPRDS_IF_UI_TAGS_TYPE       = 2,
    JPRDS_IF_AI_TAGS_TYPE       = 3
} jprds_if_tags_type_t;

typedef enum pe_parser_target_type { parserTargetId
    PE_PARSER_TARGET_TYPE_NONE  = 0,
    PE_PARSER_TARGET_TYPE_OVLAN = 1,
    PE_PARSER_TARGET_TYPE_IVLAN = 2,
    PE_PARSER_TARGET_TYPE_LPORT = 3,
    PE_PARSER_TARGET_TYPE_QCN   = 4,
    PE_PARSER_TARGET_TYPE_QFC   = 5,
    PE_PARSER_TARGET_TYPE_PTT   = 6,
    PE_PARSER_TARGET_TYPE_SRCID = 7,
    PE_PARSER_TARGET_TYPE_JST   = 8
} pe_parser_target_type;

typedef enum l2l_ai_type { vlanCatalogType
    L2L_AI_TYPE_OVLAN = 0,
    L2L_AI_TYPE_IVLAN = 1,
    L2L_AI_TYPE_SLI = 2,
    L2L_AI_TYPE_QCN = 3,
    L2L_AI_TYPE_RSVD4 = 4,
    L2L_AI_TYPE_JST = 5,
    L2L_AI_TYPE_PTT = 6,
    L2L_AI_TYPE_BTBKT = 7,
    L2L_AI_TYPE_RES0 = 8,
    L2L_AI_TYPE_RES1 = 9,
    L2L_AI_TYPE_RSVD10 = 10,
    L2L_AI_TYPE_RSVD11 = 11,
    L2L_AI_TYPE_RSVD12 = 12,
    L2L_AI_TYPE_RSVD13 = 13,
    L2L_AI_TYPE_RSVD14 = 14,
    L2L_AI_TYPE_RSVD15 = 15
} l2l_ai_type;

######
expr_nh_get_l2_hdr
    |
    pfe_ether_ifl_vtags_get

expr_if_ifl_vtags_get
    |
    pfe_ether_ifl_vtags_get

expr_if_ifl_get_vtags
    |
    expr_if_ifl_vtags_get


jprds_encap_template_init =  vectorp->template_init


expr_nh_ucast_initialize

expr_nh_fwd_nh_uninstall
    |
    expr_nh_ucast_uninstall
        |
        expr_nh_fwd_free_egress_handles
            |
            expr_nh_fwd_free_egress_encap_handles

expr_nh_fwd_nh_install
    |
    expr_nh_ucast_install
        |
        expr_nh_ucast_create_ingress_handles
            |
            expr_nh_ingress_app_alloc
            expr_nh_ingress_set_handle
            jnh_vec.nh_seq_alloc
            expr_nh_ingress_set_handle
            jnh_vec.nh_seq_alloc
            expr_nh_ingress_set_handle
            expr_nh_vec.nh_create_internal_handle
        expr_nh_fwd_create_egress_handles
            |
            expr_nh_fwd_update_ifbd_descr
                |
                iff_ifbd_walk
                    |
                    expr_l2_ifbd_walk
                        |
                        expr_l2_ifbd_nh_add
            expr_nh_fwd_create_all_descr
                |
                expr_nh_fwd_create_l2_descr
                expr_nh_fwd_create_lvl2_tag_descr
                expr_nh_fwd_create_lvl1_tag_descr
                expr_nh_fwd_create_flabel_descr
        halp_nh_oper_incr

#Arp packet handing in the kernel
vlan_input
    |


#VLAN select table code
(gdb) p *(jprds_encap_generic_tbl_t *)tbl_inst_db[0]
$35 = {gen_tbl = 0x15893430, ref_count_tbl = 0x15893c40,
    abm = 0x1563ce28, tbl_size = 96, abm_size = 3,
    ref_count_size = 96, entry_size = 21,
    hw_entry_size = 1, blk_info = 0x91ce360,
    mem_info = {
        name = PECHIP_EDF_MEM_VLAN_SEL_TBL,
        instance = 0 '\0',
        copy = 0 '\0',
        bank = 0 '\0',
        index = 11
    },
    debug_mask = 67108864, error_mask = 0,
    table_name = "VLAN_SEL_TBL", '\0' <repeats 17 times>,
    v_tbl = {
        jprds_encap_gen_alloc = 0x858f5d0 <jprds_encap_gen_alloc>,
        jprds_encap_gen_free = 0x858f430 <jprds_encap_gen_free>,
        jprds_encap_gen_get = 0x858e600 <jprds_encap_gen_get>,
        jprds_encap_gen_set = 0x858eda0 <jprds_encap_gen_set>,
        jprds_encap_gen_write = 0x859b890 <jprds_encap_vlan_sel_write>,
        jprds_encap_gen_cmp = 0x858ef50 <jprds_encap_gen_cmp>,
        jprds_encap_gen_tbl_find = 0x858ef80 <jprds_encap_gen_tbl_find>,
        jprds_encap_gen_install = 0x858ded0 <jprds_encap_gen_install>,
        jprds_encap_gen_clr = 0x858ec10 <jprds_encap_gen_clr>,
        jprds_encap_gen_uninstall = 0x858e790 <jprds_encap_gen_uninstall>,
        jprds_encap_gen_tbl_show = 0x859b150 <jprds_encap_vlan_sel_show>
    }
}

jprds_encap_vlan_sel_tbl_init
    |
    vlan_sel_vec_tbl.jprds_encap_gen_tbl_show = jprds_encap_vlan_sel_show
    vlan_sel_vec_tbl.jprds_encap_gen_write = jprds_encap_vlan_sel_write
    jprds_encap_gen_init

cmqfx_pseudo_init
    |
    cmfxpc_pic_hw_init
        |
        cmfxpc_asic_init
            |
            prds_if_vlan_sel_table_init
                |
                jprds_encap_vlan_sel_install
                    |
                    jprds_encap_gen_install
                        |
                        jprds_encap_gen_tbl_find
                            |
                            jprds_encap_gen_cmp
                        jprds_encap_vlan_sel_write = vlan_sel_vec_tbl.jprds_encap_gen_write
                            |
                            vlan_sel_entry_p = JPRDS_ENCAP_GEN_TBL_GET(tbl_inst_db, inst, idx);
                            jprds_encap_vlan_sel_fmt
                    jprds_vlan_sel_app_map[vlan_sel_app_idx] = table_index


cmfxpc_asic_init_pfe
    |
    cmsngfpc_pechip_init (gladiator)
        |
        prds_if_vlan_sel_table_init (if_vlan_rw_prds_cr.c)
            |
            #IRW
            prds_if_vlan_rw_params_get
                |
                prds_if_vlan_rw_vid_sel_get
                prds_if_vlan_rw_etype_from_vid_sel_get
                prds_if_vlan_rw_etype_sel_get
                prds_if_vlan_rw_pcp_from_vid_sel_get
                prds_if_vlan_rw_pcp_sel_get
            prds_if_vlan_rw_op_idx_get
            pechip_irw_vlan_sel_tbl_set
            #EDF
            prds_if_vlan_rw_params_get
                |
            prds_if_vlan_rw_op_idx_get
            jprds_encap_vlan_sel_install
    cmqfx_pechip_init (elit)
        |
        jprds_halp_asic_ready_notify
            |
            jprds_halp_pe_ready_notify
                |
                jprds_encap_hw_init
                    |
                    jprds_encap_vlan_sel_tbl_mem_init
                        |
                        jprds_encap_vlan_sel_fmt

        prds_if_vlan_sel_table_init (if_l3_qfx.c)
            |
            #IRW
            QFX_IRW_VLAN_SEL_INIT
            pechip_irw_vlan_sel_tbl_set
            #EDF (NOOP, OUTER_VLAN, OUTER_VLAN & 802.1p)
            QFX_IRW_VLAN_SEL_INIT
            jprds_encap_vlan_sel_install


expr_port_family_change
    |
    case PROTO_L2_BRIDGE:
    expr_port_l2_ifl_init
        |
        expr_port_add_tag_support
            |
            ...
    case PROTO_IPV4:
    expr_port_l3_ifl_init
        |
        prds_if_l3_ifd_init
            |
            expr_port_add_tag_support
                |
                expr_port_remove_tag_support
                jprds_set_ai_etype
                jprds_if_tag_pattern_add
                jprds_if_port_vlan_trust_set
                expr_nh_egress_add_etypes #add tpid
                jprds_if_port_drop_tag


cmsngfpc_gld_pfe_asic_pechip_init
    |
    cmsngfpc_pechip_init
        |
        cmsngfpc_post_pechip_init
            |
            expr_if_pg_xge_init
            pechip_ipw_nnwf_port_map_set
            pechip_igp_port_gp_set
            pechip_ipw_nnwf_port_map_set
            pechip_igp_port_gp_set
            pechip_ipw_resolution_sel_set
            pechip_slu_cp_lport_cfg_set
            pechip_slu_l2d_cpcfg_set
            expr_nh_egress_add_etypes
            expr_nh_egress_set_egp_etype_map
            pechip_plct_set_l2_adjust #SLU_L2DLP
            pechip_plct_set_l2_adjust #ERW_L2DLP


t5e_tr_ifdioctl
    |
    caser IF_MSG_IOCTL_ESW_TPID_DATA
    expr_if_ifd_tpid_config
        |
        expr_if_installed_tpid_get
        expr_if_ifd_tpid_pend_mask_bit_get
        expr_if_ifd_get_chan
        prds_if_tpid_install #expr_if_pf_vec->tpid_install
            |
            cmsngfpc_pechip_tpid_install
                |
                expr_nh_egress_add_etypes
                jprds_etype_idx_add
                pechip_igp_etype_rule_init
                pechip_egp_etype_rule_init
                expr_nh_egress_set_egp_etype_map
        expr_if_installed_tpid_set
        expr_if_ifd_tpid_add
        pic_get_tpid_chg_pend_mask
        expr_if_ifd_tpid_add


#Vlan related apis
#USE prds_encap_egress_add_vlan_sel api for set PUSH/POP/SWAP etc
halp_nh_init
    |
    expr_encap_vector_init
        |
        encap_vec->expr_encap_tal_descr_install = prds_encap_tal_descr_install;
        encap_vec->expr_encap_egress_add_vlan_sel = prds_encap_egress_add_vlan_sel;


expr_nh_egress_vlan_sel_install
    |
    jprds_encap_vlan_sel_install = vectorp->vlan_sel_install
        |
        jprds_encap_gen_install #jprds_encap_vlan_sel_tbl_db (table_name)
        jprds_encap_gen_install #JPRDS_ENCAP_GEN_TBL_INSTALL
            |
            jprds_encap_gen_tbl_find #JPRDS_ENCAP_GEN_TBL_FIND
            jprds_encap_gen_alloc   #JPRDS_ENCAP_GEN_TBL_ALLOC
            jprds_encap_gen_set     #JPRDS_ENCAP_GEN_TBL_SET
            jprds_encap_gen_free    #JPRDS_ENCAP_GEN_TBL_FREE
            jprds_encap_gen_write   #JPRDS_ENCAP_GEN_TBL_WRITE





#VTY: show jencap 0 vlan_sel_tbl app_idx 4
jprds_encap_vlan_sel_show_by_app_idx
    |
    pechip_edf_vlan_sel_tbl_rd

expr_nh_egress_create_params
expr_nh_egress_set_egp_etype_map
#pechip_edf_vlan_sel_tbl_rd
#expr_nh_egress_add_etypes
#pfe_ether_ifl_vtags_get

#IFBD HW TOKEN
rts_ifbd_ifstate_info
    |
    infop->ifbd_hw_token = ifbd->ifbd_hw_token

# GLADIATOR #########################
expr_if_ifd_channel_add
    |
    prds_if_ifd_channel_add //ifd_channel_add
        |
        prds_if_ifl_pechip_irw_setup
            |
            pechip_irw_l2domain_cfg_set


expr_l2_config_ifd_tpid_set


set groups ep_access_trunk interfaces xe-0/0/0 unit 0 family ethernet-switching interface-mode access
set groups ep_access_trunk interfaces xe-0/0/0 unit 0 family ethernet-switching vlan members v100
set groups ep_access_trunk interfaces xe-0/0/1 unit 0 family ethernet-switching interface-mode trunk
set groups ep_access_trunk interfaces xe-0/0/1 unit 0 family ethernet-switching vlan members v100
set groups ep_access_trunk vlans v100 vlan-id 100
set groups ep_trunk_trunk interfaces xe-0/0/0 unit 0 family ethernet-switching interface-mode trunk
set groups ep_trunk_trunk interfaces xe-0/0/0 unit 0 family ethernet-switching vlan members v100
set groups ep_trunk_trunk interfaces xe-0/0/1 unit 0 family ethernet-switching interface-mode trunk
set groups ep_trunk_trunk interfaces xe-0/0/1 unit 0 family ethernet-switching vlan members v100
set groups ep_trunk_trunk interfaces xe-0/0/2 unit 0 family ethernet-switching interface-mode trunk
set groups ep_trunk_trunk interfaces xe-0/0/2 unit 0 family ethernet-switching vlan members v100
set groups ep_trunk_trunk vlans v100 vlan-id 100
set groups ep_access_access interfaces xe-0/0/0 unit 0 family ethernet-switching interface-mode access
set groups ep_access_access interfaces xe-0/0/0 unit 0 family ethernet-switching vlan members v100
set groups ep_access_access interfaces xe-0/0/1 unit 0 family ethernet-switching interface-mode access
set groups ep_access_access interfaces xe-0/0/1 unit 0 family ethernet-switching vlan members v100
set groups ep_access_access vlans v100 vlan-id 100
set groups ep_l3_l3_traffic interfaces xe-0/0/0 unit 0 family inet address 80.80.80.1/24
set groups ep_l3_l3_traffic interfaces xe-0/0/1 unit 0 family inet address 200.200.200.1/24

set groups ep_irb_irb_traffic interfaces irb unit 100 family inet address 80.80.80.1/24
set groups ep_irb_irb_traffic interfaces irb unit 101 family inet address 200.200.200.1/24
set groups ep_irb_irb_traffic interfaces xe-0/0/0 unit 0 family ethernet-switching interface-mode trunk
set groups ep_irb_irb_traffic interfaces xe-0/0/0 unit 0 family ethernet-switching vlan members VLAN100
set groups ep_irb_irb_traffic interfaces xe-0/0/1 unit 0 family ethernet-switching interface-mode trunk
set groups ep_irb_irb_traffic interfaces xe-0/0/1 unit 0 family ethernet-switching vlan members VLAN101
set groups ep_irb_irb_traffic vlans VLAN100 vlan-id 100
set groups ep_irb_irb_traffic vlans VLAN100 l3-interface irb.100
set groups ep_irb_irb_traffic vlans VLAN101 vlan-id 101
set groups ep_irb_irb_traffic vlans VLAN101 l3-interface irb.101

set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/0 vlan-tagging
set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/0 unit 0 vlan-id 90
set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/0 unit 0 family inet address 90.90.90.1/24
set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/1 vlan-tagging
set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/1 unit 0 vlan-id 101
set groups ep_l3_l3_vlan_tagging interfaces xe-0/0/1 unit 0 family inet address 200.200.200.1/24

set groups sp_l2_swap_swap interfaces xe-0/0/0 flexible-vlan-tagging
set groups sp_l2_swap_swap interfaces xe-0/0/0 encapsulation extended-vlan-bridge
set groups sp_l2_swap_swap interfaces xe-0/0/0 ether-options ethernet-switch-profile tag-protocol-id 0x9200
set groups sp_l2_swap_swap interfaces xe-0/0/0 unit 0 vlan-id 100
set groups sp_l2_swap_swap interfaces xe-0/0/1 flexible-vlan-tagging
set groups sp_l2_swap_swap interfaces xe-0/0/1 encapsulation extended-vlan-bridge
set groups sp_l2_swap_swap interfaces xe-0/0/1 ether-options ethernet-switch-profile tag-protocol-id 0x9100
set groups sp_l2_swap_swap interfaces xe-0/0/1 unit 0 vlan-id 101
set groups sp_l2_swap_swap vlans vtest interface xe-0/0/1.0
set groups sp_l2_swap_swap vlans vtest interface xe-0/0/0.0
set groups sp_l2_push_swap interfaces xe-0/0/0 flexible-vlan-tagging
set groups sp_l2_push_swap interfaces xe-0/0/0 encapsulation extended-vlan-bridge
set groups sp_l2_push_swap interfaces xe-0/0/0 unit 0 vlan-id 100
set groups sp_l2_push_swap interfaces xe-0/0/0 unit 0 input-vlan-map push
set groups sp_l2_push_swap interfaces xe-0/0/0 unit 0 output-vlan-map pop
set groups sp_l2_push_swap interfaces xe-0/0/1 flexible-vlan-tagging
set groups sp_l2_push_swap interfaces xe-0/0/1 encapsulation extended-vlan-bridge
set groups sp_l2_push_swap interfaces xe-0/0/1 unit 0 vlan-id 101
set groups sp_l2_push_swap vlans vtest interface xe-0/0/1.0
set groups sp_l2_push_swap vlans vtest interface xe-0/0/0.0
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 flexible-vlan-tagging
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 unit 0 vlan-id 100
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 unit 0 family inet address 100.100.100.1/24
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 unit 100 vlan-tags outer 100
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 unit 100 vlan-tags inner 101
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/0 unit 100 family inet address 101.100.100.1/24
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/1 flexible-vlan-tagging
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/1 unit 0 vlan-id 200
set groups sp_l3_l3_fvlan_tagging interfaces xe-0/0/1 unit 0 family inet address 200.200.200.1/24
set groups sp_irb_irb_fvlan_tagging interfaces irb unit 100 family inet address 90.90.90.1/24
set groups sp_irb_irb_fvlan_tagging interfaces irb unit 101 family inet address 200.200.200.1/24
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/0 flexible-vlan-tagging
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/0 encapsulation extended-vlan-bridge
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/0 unit 100 vlan-id 90
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/1 flexible-vlan-tagging
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/1 encapsulation extended-vlan-bridge
set groups sp_irb_irb_fvlan_tagging interfaces xe-0/0/1 unit 101 vlan-id 101
set groups sp_irb_irb_fvlan_tagging vlans VLAN100 vlan-id 100
set groups sp_irb_irb_fvlan_tagging vlans VLAN100 interface xe-0/0/0.100
set groups sp_irb_irb_fvlan_tagging vlans VLAN100 l3-interface irb.100
set groups sp_irb_irb_fvlan_tagging vlans VLAN101 vlan-id 101
set groups sp_irb_irb_fvlan_tagging vlans VLAN101 interface xe-0/0/1.101
set groups sp_irb_irb_fvlan_tagging vlans VLAN101 l3-interface irb.101
set apply-groups sp_l3_l3_fvlan_tagging


############## ZH AFT IF ####################
AFT IF Code Flow

IfdAddMsgHandler:process        #IfdMsgHandler.cpp
    |
    createPlatIfd               #IfPlatExpr.cpp
        |
        IfdEtherExpr::create    #IfdEtherExpr.cpp
            |
            add(ifd)            #Ifd.cpp
            ifd->attach         #IfdEtherExpr.cpp
                |
                AftExprInputPort::create(index(), 0, _picPort, 1);

EmSandbox::receive  #engineman/src/EmSandbox.cpp
    |
    EmExprInputPort::bind   #engineman-expr/src/EmExprInputPort.cpp
        |
        JexprHandlePort::_create #applications/src/if/JexprHandlePort.cpp
            |
            jexprPfeApiPortInit #toolkits/src/JexprPfeApi.c
                |
                JexprCdaPortInit #toolkits/src/JexprCdaApi.cpp
                    |
                    cdaClient->ExprPortInitCfgSet

IfdDelMsgHandler::process
    |
    ifd->remove
        |


#################
— AFTMan
    ifrt_msg_handler # src/pfe/common/toolkits/if/ifrt.c
    ifrt_ifd_add_vector # src/pfe/common/toolkits/if/ifrt_ifd.c
    pfe_ifd_attach # src/pfe/common/toolkits/pfe/pfe_if.c
    pfe_ifd_chip_setup # src/pfe/common/toolkits/pfe/pfe_if_expr_argus.c


— AftServer
    jam_expr_pfe_ifd_chip_setup #src/pfe/common/pfe-arch/express/applications/if/jp_if_api_cr_tr.c
    expr_if_ifd_chip_setup #src/pfe/common/pfe-arch/express/applications/if/if_halp_cr_tr.c
    zphr_if_ifd_chip_setup #src/pfe/common/pfe-arch/express/applications/if/if_halp_zphr.c

— CDA
    zephyr_port_add #src/pfe/common/drivers/zephyr/common/zephyr_port_init.c
    zephyr_pfe_slu_add #src/pfe/common/drivers/zephyr/slu/zephyr_pfe_slu_init.c
    zephyr_slu_regs_portgroup_config_set #obj/pfe/common/drivers/zephyr/driver_auto_gen/gen//zephyr_slu_gen.c

#src/pfe/common/toolkits/if/ifrt_ifd.c
    |
    ifrt_ifd_add_callback
    ifrt_ifd_add_vector
    ifrt_ifd_remove_vector
    ifrt_ifd_ioctl_vector
    ifrt_ifd_picset_vector
    ifrt_ifd_pm_inst_vector
    ifrt_ifd_config_vector
    ifrt_ifd_stream_bulk_enable_vector
    ifrt_ifd_setup_vcp
    vc_remote_member_updown
    pfe_ifd_link_protect_failover
    vc_remote_ifl_up
    ifrt_ifd_sdid_vector
    ifd_create_internal
    ifd_destroy_internal

#src/pfe/common/toolkits/pfe/pfe_if.c
    |
    nh_lag_ifd_child_change
    pfe_dlci_ifl_update
    pfe_ifdconfig
    pfe_ifd_agg_config
    pfe_cntl_ifdconfig
    pfe_ifd_ge_ioctl
    pfe_iflconfig
    pfe_ifl_lsi_config
    pfe_ifl_agg_config
    ifd_mark_capability_flag
    ps_ifd_ioctl
    pfe_ifd_attach
    pfe_ifd_detach
    pfe_ifd_mfilter_handler
    pfe_st_ctl_ifl_change_handler
    pfe_st_ctl_ifl_agg_add_handler
    pfe_ifl_init_ifdspecific
    pfe_ifl_attach
    ifae_lite_destroy
    pfe_ifl_detach
    pfe_ifl_store_residue_stats
    ggsn_local_ifl_walk
    pfe_agg_stacked_ifl_child_cup
    pfe_agg_stacked_ifl_child_cdown
    pfe_ifl_cup
    pfe_ifl_cdown
    legacy_redirect_update_global_ifl_walk
    legacy_redirect_update_global_per_ifd
    ifl_gre_tun_info_attach
    pfe_ifl_family_attach
    pfe_ifl_family_lsiflag_changer
    pfe_ifl_family_change
    pfe_ifl_family_detach
    legacy_redirect_update_global_ifd_walk
    pfe_ifbd_irb_ifl_reroute
    pfe_frr_restore_ifl_walk
    pfe_reroute_propagate_ifl_up_down_helper
    pfe_reroute_propagate_ifl_up_down_walker
    pfe_reroute_propagate_ifl_up_down
    pfe_ifl_reroute
    pfe_ifd_reroute
    pfe_ifd_link_up_down
    pfe_redirect_update_global_start
    pfe_ifd_stats_from_ifls
    pfe_ifd_fc_stats_from_ifls
    pfe_agg_ifl_input_ttp_stats
    pfe_ifd_ifdstats
    pfe_ifd_fc_ifdstats
    pfe_ifd_mac_stats
    pfe_ifd_device_up
    pfe_ifd_device_down
    pfe_ifl_issu_stats_prepare
    pfe_ifd_aps_up
    pfe_ifd_aps_down
    pfe_ifd_fast_aps_updown
    pfe_ifl_mofrr_updown
    pfe_ifd_mofrr_updown
    pfe_ifd_ge_pad_min_frame_size_config
    pfe_ifl_issu_stats_restore
    pfe_ifl_in_out_issu_stats_prepare
    pfe_ifl_in_out_res_issu_stats_prepare
    pfe_ifl_in_out_issu_stats_restore
    pfe_ifl_in_out_res_issu_stats_restore
    pfe_ifd_issu_stats_prepare
    pfe_ifd_issu_stats_restore
    pfe_ifd_multipoint_atm_ci_channel_update
    pfe_ifd_precl_stats_get
    pfe_ifd_issu_precl_stats_store
    pfe_ifd_issu_precl_stats_restore
    pfe_ifd_mcast_stats_get
    pfe_ifl_mcast_stats_get
    pfe_ether_ifl_vtags_get
    pfe_set_media_flgs_chg_callbk
    pfe_get_agg_ifl_stats
    pfe_index_init
    ifrt_lag_enh_ifl_walk

#src/pfe/common/toolkits/pfe/pfe_if_expr_argus.c
    |
    pfe_ifd_get_chip_input_stream
    pfe_queue_if_operation
    pfe_ifl_family_platform_attach
    pfe_ifl_no_shim_layer
    pfe_ifl_family_platform_change
    pfe_ifl_family_platform_detach
    pfe_ifl_platform_attach
    pfe_ifl_platform_detach
    pfe_ifl_platform_encap_config
    pfe_ifl_updown
    pfe_ifd_chip_setup
    pfe_ifd_chip_detach
    pfe_ifd_mfilter_platform_add
    pfe_ifd_mfilter_platform_change
    pfe_ifd_mfilter_platform_delete
    pfe_ifd_link_up
    pfe_ifd_link_down
    pfe_ifl_iflstats
    pfe_get_layer2_overhead_bytes
    pfe_get_ifl_stats
    pfe_child_ifl_asic_setup
    pfe_ifl_agg_notfy_callback
    pfe_if_init
        |
        pfe_ifl_agg_notfy_callback
    pfe_init_interfaces
    pfe_if_gport_ifd_map_get
    pfe_if_gport_ifd_map_del
    pfe_ifd_get_local_oq_base
    zphr_get_loq_base_eg_grp

#src/pfe/common/pfe-arch/express/applications/if/if_halp_zphr.c
    expr_nh_egress_add_etypes
    expr_nh_egress_remove_etypes
    zphr_if_lport_id_get
    prds_if_ifl_l2d_ht_val_change
    prds_if_ifd_pechip_ipw_setup
    prds_if_ifd_pechip_iqm_setup
    prds_if_ifd_pechip_igp_setup
    prds_if_ifd_pechip_slu_setup
    prds_if_ifd_pechip_dlu_setup
    prds_if_ifd_pechip_irp_setup
    prds_if_ifd_pechip_egp_setup
    prds_if_ifd_pechip_edf_setup
    prds_if_ifd_pechip_epr_setup
    prds_if_ifd_pechip_irm_setup
    prds_if_ifd_pechip_erm_setup
    zphr_if_ifd_zephyr_igp_setup
    zphr_if_ifd_zephyr_slu_setup
    zphr_if_ifd_zephyr_dlu_setup
    zphr_if_ifd_zephyr_irp_setup
    zphr_if_ifd_zephyr_epp_setup
    zphr_if_ifd_chip_setup
    prds_if_ifd_chip_detach
    prds_if_ifd_stream_disable
    prds_if_ifd_stream_enable
    prds_if_lb_pechip_irm_setup
    prds_if_lb_aggr_pechip_rm_setup
    prds_if_dlb_ifd_pechip_setup
    prds_if_ifd_tpid_add
    prds_if_ifd_tpid_del
    prds_if_tpid_install
    zphr_base_voq_id_from_ifd_get
    prds_if_ifd_host_proc_stream_get
    prds_if_ifd_host_proc_chip_num_get
    prds_if_ifl_pechip_dlu_setup
    prds_if_ifl_pechip_slu_setup
    prds_if_ifl_pechip_irw_setup
    zphr_if_ifl_l2d_ht_del
    zphr_if_ifd_channel_add
    prds_if_ifl_l2d_mymac_lkup_enable
    prds_if_ifd_flow_control_set
    prds_if_ifd_media_flag_change
    prds_if_ifd_media_link_config
    prds_if_ifl_maddr_config
    prds_if_ifl_detach
    zphr_if_ifl_l2d_alloc
    zphr_if_ifl_l2d_ht_get_key
    prds_if_lb_stream_create
    prds_if_ilb_stream_pechip_setup
    prds_if_unused_lb_stream_pechip_setup
    prds_if_get_dlb_0_ifd
    prds_if_get_dlb_1_ifd
    prds_if_iff_config_src_lookup
    zphr_if_iff_proto_add
    zphr_if_iff_proto_del
    expr_rtt_mpls_insert_lsi_label_rt_proto
    expr_rtt_mpls_delete_lsi_label_rt_proto
    prds_if_lsi_iff_add
    prds_if_lsi_iff_del
    prds_lsi_ifl_idx_get
    prds_if_ifd_lport_stats_clear
    prds_if_ifl_l2d_stats_clear
    prds_if_ifd_lport_counter_get
    prds_if_ifl_l2d_counter_get
    prds_if_child_ifl_l2d_set
    prsd_if_ifl_chip_l2d_ht_get
    prds_if_ifl_encap_config
    prds_if_dlb_ifl_create
    prds_if_dlb_iff_create
    prds_if_remote_ifl_attach
    prds_if_remote_ifl_detach
    expr_if_platform_init
    expr_get_trapstats
    expr_get_nh_discards
    prds_shim_pfe_stats
    prds_if_stream_to_ifd_walk
    prds_shim_pfe_stats_discard
    prds_shim_pfe_stats_discard_all
    prds_shim_pfe_stats_discard_entry

###### ZH CODE ######################################################
expr_if_pf_vec_t
    |
    ifd_chip_setup
    ifd_chip_detach
    ifd_stream_disable
    ifd_stream_enable
    ifd_summary_show
    ifd_stream_disable_debug_show
    tpid_install
    ifd_tpid_add
    ifd_channel_add
    ifd_media_flag_change
    ifd_media_link_config
    ifd_flow_control_set
    ifd_global_dev_num_get
    ifd_foq_group_get
    ifd_queue_base_get
    ifd_first_voq_base_get
    ifd_host_proc_stream_get
    ifd_host_proc_chip_num_get
    if_iq_to_ifdname_show
    ifd_fwd_stats_get
    ifd_lport_counter_get
    ifd_queue_stats_get
    ifd_voq_stats_get
    ifl_voq_stats_get
    ifl_l2d_ht_add
    ifl_l2d_ht_del
    ifl_maddr_config
    ifl_l2d_ht_val_change
    ifl_l2d_alloc
    ifl_l2d_free
    ifl_l2d_counter_get
    child_ifl_l2d_set
    ifl_l2d_ht_check_show
    ifl_summary_show
    ifl_family_show
    ifl_detach
    remote_ifl_attach
    remote_ifl_detach
    ifl_encap_config
    ifl_foq_group_get
    ifl_queue_stats_get
    ifl_adaptive_stats_get
    iff_proto_add
    iff_proto_del
    iff_config_src_lookup
    lsi_iff_add
    lsi_iff_del
    lsi_ifl_show
    lsi_ifl_idx_get
    ifcp_module_init
    ifcp_get_fdb_ent_key
    ifcp_add_fdb
    ifcp_del_fdb
    ifcp_change_fdb
    mymac_app_init
    mymac_entry_add
    mymac_entry_chg
    mymac_entry_delete
    mymac_entry_show
    if_packet_init
    if_cp_init
    if_preclass_init
    if_lcpu_init
    if_lcpu_port_get
    if_dlb_ifl_create
    if_dlb_iff_create
    shim_pfe_stats
    shim_pfe_stats_discard_all
    shim_pfe_stats_discard_entry

jam_expr_pfe_if_vec_t
    |
    #ifd vecs
    pfe_ifd_get_lkup_chip_stream
    pfe_ifd_chip_setup
    pfe_ifd_chip_detach
    pfe_ifd_updown
    pfe_ifd_link_up
    pfe_ifd_link_down
    pfe_ifd_media_flag_change
    pfe_ifd_get_lport_stats
    #ifl vec's
    pfe_ifl_family_platform_attach
    pfe_ifl_family_platform_detach
    pfe_ifl_platform_attach
    pfe_ifl_platform_detach
    pfe_ifl_platform_encap_config
    pfe_ifl_updown
    pfe_child_ifl_asic_setup
    pfe_ifl_ingr_local_l2d_stats_get
    pfe_ifl_l2d_stats_get


expr_l2_common_bd_hw_program 1
    |
    jprds_if_l2d_id_alloc 2
    jprds_if_l2d_gl2d_map 3
    jprds_if_l2d_attr_reset 4
    expr_bd_l2d_cfg_set
        |
        pechip_slu_l2d_cfg0_set 5
        pechip_slu_l2d_cfg1_set 6
        pechip_irw_l2domain_cfg_set 7
    expr_bd_l2d_attr_set
        |
        expr_l2_get_local_l2d_id
        jprds_if_l2d_attr_update
            |
            pechip_dlu_l2dom_attr_get
            expr_l2d_attr_l2_get #(l2d_attr_hndl[type].cfg_get_fn
            jprds_if_map_l2d_flags_to_eth_cfg
            pechip_dlu_l2dom_attr_set
########### IF MSG HANDLER ###############
# jexpr_jif_port_get_vector_table()
#   $18 = {jexpr_jif_port_ifd_map_set = 0x87150b0 <jzphr_if_port_ifd_map>,
#   jexpr_jif_port_ifd_map_unset = 0x8715100 <jzphr_if_port_ifd_unmap>,
#   jexpr_jif_port_ifd_map_get = 0x8715140 <jzphr_if_port_map_get_ifd>,
#   jexpr_jif_port_dflt_lport_set = 0x8715210 <jzphr_if_port_dflt_lport_set>,
#   jexpr_jif_port_config_sa_learning = 0x87156c0 <jzphr_if_port_config_sa_learning>,
#   jexpr_jif_port_config_mac_limit = 0x8714fb0 <jzphr_if_port_config_mac_limit>,
#   jexpr_jif_port_ethrule_def_cfg = 0x8715750 <jzphr_if_port_eth_ruleset_def_cfg>,
#   jexpr_jif_port_eth_def_cfg = 0x8715310 <jzphr_if_port_eth_def_cfg>}
# jexpr_if_get_vec_tbl_handle()
#   $19 = {asic_get_max_port_num = 0x8718f70 <zephyr_get_max_port_num>,
#   asic_get_lcpu0_port_num = 0x8718f90 <zephyr_get_lcpu0_port_num>,
#   asic_get_lcpu1_port_num = 0x8718fa0 <zephyr_get_lcpu1_port_num>,
#   asic_get_hostif0_port_num = 0x8718fb0 <zephyr_get_hostif0_port_num>,
#   asic_get_hostif1_port_num = 0x8718fc0 <zephyr_get_hostif1_port_num>,
#   asic_get_lb_port_num = 0x8718fd0 <zephyr_get_lb_port_num>,
#   asic_get_ind_lb_port_num = 0x8718fe0 <zephyr_get_ind_lb_port_num>,
#   asic_set_dflt_lport = 0x871d3a0 <zephyr_set_dflt_lport>, asic_set_lport_cfg = 0x871ce00 <zephyr_set_lport_cfg>,
#   asic_set_dflt_vlan = 0x871c8d0 <zephyr_set_dflt_vlan>, asic_get_dflt_vlan = 0x871c460 <zephyr_get_dflt_vlan>,
#   asic_set_slu_port_cfg1 = 0x871c1d0 <zephyr_set_slu_port_cfg1>,
#   asic_set_slu_port_cfg2 = 0x871c560 <zephyr_set_slu_port_cfg2>,
#   asic_set_l3_vpn_cfg = 0x871bd70 <zephyr_set_slu_l3_vpn_lkup_tbl>,
#   asic_if_rtt_idx_to_l3vpn_alloc = 0x871bca0 <zephyr_if_rtt_idx_to_l3vpn_alloc>,
#   asic_if_rtt_idx_to_l3vpn_free = 0x871bae0 <zephyr_if_rtt_idx_to_l3vpn_free>,
#   asic_if_rtt_idx_to_l3vpn_get = 0x871baa0 <zephyr_if_rtt_idx_to_l3vpn_get>,
#   asic_set_l2d_cfg = 0x871b500 <zephyr_set_l2d_cfg>, asic_get_l2d_cfg = 0x8719e30 <zephyr_get_l2d_cfg>,
#   asic_set_l2d_attr = 0x871ac50 <zephyr_set_slu_l2d_attr>, asic_get_l2d_attr = 0x8719ab0 <zephyr_get_slu_l2d_attr>,
#   asic_port_add = 0x80df430 <zephyr_port_add>, asic_set_edf_port_cfg = 0x871a900 <zephyr_set_edf_port_cfg>,
#   asic_set_ingress_eth_type = 0x871e720 <zephyr_set_ingress_eth_type>,
#   asic_set_egress_eth_type = 0x871df10 <zephyr_set_egress_eth_type>,
#   asic_set_ingress_eth_rule = 0x871e1f0 <zephyr_set_ingress_eth_rule>,
#   asic_set_egress_eth_rule = 0x871dce0 <zephyr_set_egress_eth_rule>,
#   asic_set_igp_dflt_lport = 0x871a8d0 <zephyr_set_dflt_lport_id>,
#   asic_set_slu_serive_type_config_set = 0x871a470 <zephyr_slu_service_type_config_set>,
#   asic_set_cp_port_cfg = 0x871a2d0 <zephyr_set_cp_port_config>}

    _nodeMount.declare(aftSandbox, "AftExprNhFwd",   &EmExprNh::create);
